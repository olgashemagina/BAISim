<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>awplflib: C:/_alt/_proj/awplflib/src/lfcsboost.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">awplflib
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">lfcsboost.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="lfcsboost_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160; </div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="___l_f_8h.html">_LF.h</a>&quot;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160; </div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160; </div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using namespace </span>std; </div>
<div class="line"><a name="l00006"></a><span class="lineno"><a class="line" href="class_progress_meter.html">    6</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_progress_meter.html">ProgressMeter</a></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;{</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00009"></a><span class="lineno"><a class="line" href="class_progress_meter.html#a12b7218455754bfa62b7be8400b9fa05">    9</a></span>&#160;    <a class="code" href="class_progress_meter.html#a12b7218455754bfa62b7be8400b9fa05">ProgressMeter</a>():m_counter(0){}</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160; </div>
<div class="line"><a name="l00011"></a><span class="lineno"><a class="line" href="class_progress_meter.html#ac3902e5affdd16dcec5042d24e8c3512">   11</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="class_progress_meter.html#ac3902e5affdd16dcec5042d24e8c3512">Update</a>( )</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    {</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;        <span class="keywordflow">if</span> ( ++m_counter &gt;= m_sum )</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;        {</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;            m_sum += m_unit;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;        }</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    }</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160; </div>
<div class="line"><a name="l00021"></a><span class="lineno"><a class="line" href="class_progress_meter.html#a135acb682c55a6aed758d164aab5a0e7">   21</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_progress_meter.html#a135acb682c55a6aed758d164aab5a0e7">Init</a>( <span class="keywordtype">int</span> units, <span class="keywordtype">int</span> count )</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    {</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        m_counter = 0;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        m_unit = (double)count / (<span class="keywordtype">double</span>)units;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        m_sum = m_unit;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    }</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160; </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160; </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keywordtype">double</span>      m_sum;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordtype">double</span>      m_unit;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="keywordtype">int</span>         m_counter;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;};</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160; </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; </div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">//---------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#ac403ef7de3158bdc0e6e66d79a3bb4ce">   40</a></span>&#160;<a class="code" href="class_t_c_s_ada_boost.html#ac403ef7de3158bdc0e6e66d79a3bb4ce">TCSAdaBoost::TCSAdaBoost</a>()</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;{</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    m_strArtefactsBase = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    m_strObjectsbase   = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    m_widthBase = 24;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    m_heightBase = 24;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    m_nFeaturesCount = 200;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    m_FinishFar = 0.2;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    m_strOutName = <span class="stringliteral">&quot;cascade.dat&quot;</span>;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    m_nTestFaces = 0;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    m_nTestNonFaces = 0;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    m_nFaces = 0;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    m_nNonFaces = 0;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    m_pLog = NULL;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordtype">string</span> str = <span class="stringliteral">&quot;adaboost.log&quot;</span>;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keywordflow">if</span> (m_pLog == NULL)</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        m_pLog = <span class="keyword">new</span> ofstream(str.c_str());</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160; </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    m_CSFeature  = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    m_LBPFeature = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    m_HFeature = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    m_VFeature = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    m_DFeature = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    m_CFeature = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    m_HFeature = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    m_VFeature = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    m_DFeature = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    m_CFeature = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160; </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160; </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;}</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#ab5d528685a6021f53e41da19a8d33e20">   73</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_t_c_s_ada_boost.html#ab5d528685a6021f53e41da19a8d33e20">TCSAdaBoost::LoadSamples</a>()</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;{</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    this-&gt;m_TrainingSamples.Clear();</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="comment">//Загрузка образцов для обучения</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    DbgMsg( <span class="stringliteral">&quot;Loading training sets...\n&quot;</span> );</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">if</span> (!LoadSample( m_TrainingSamples, 0, m_strArtefactsBase ))</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    m_nNonFaces = m_TrainingSamples.GetCount();</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordflow">if</span> (!LoadSample( m_TrainingSamples, 1,  m_strObjectsbase))</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    m_nFaces = (int)m_TrainingSamples.GetCount( ) - m_nNonFaces;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    m_nTestFaces = m_nFaces;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    m_nTestNonFaces = m_nNonFaces;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;}</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#ac500ed623c8cc7661a59afdeabf1c754">   91</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_t_c_s_ada_boost.html#ac500ed623c8cc7661a59afdeabf1c754">TCSAdaBoost::Load</a> (TiXmlElement* node, <span class="keywordtype">int</span> cascade)</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;{</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    m_TrainingSamples.Clear();</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    TiXmlElement* pElem = NULL;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    pElem = node;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="comment">// создает новый файл протокола работы алгоритма  string str = pElem-&gt;Attribute(&quot;logfile&quot;);
    if (m_pLog == NULL)
        m_pLog = new ofstream(str.c_str());


    m_strArtefactsBase = pElem-&gt;Attribute(&quot;database0&quot;);
    m_strObjectsbase = pElem-&gt;Attribute(&quot;database1&quot;);


    //
    m_widthBase = 70;
    m_heightBase = 20;

    m_strOutName = &quot;&quot;;
    double ni = 5;
    pElem-&gt;Attribute(&quot;count_feat&quot;, &amp;ni);
    m_nFeaturesCount = (int)ni;

    // инициализация исходного массива признаков
   InitFeatures( );
    return true;

}

bool TCSAdaBoost::Load  (const char* lpFileName)
{
   TiXmlDocument doc(lpFileName);
   if (!doc.LoadFile())
    return false;
   TiXmlHandle hDoc(&amp;doc);
   TiXmlElement* pElem = NULL;
   pElem = hDoc.FirstChildElement().Element();
   if (!pElem)
      return false;
   const char* name = pElem-&gt;Value();
   if (strcmp(name, &quot;csboost&quot;) != 0)
      return false;
   return Load( pElem, 0);
}

bool TCSAdaBoost::Boost(int stage)
{
    // Начало накачки.
    double wf   = 0.5/m_nFaces;
    double wnf  = 0.5/m_nNonFaces;

    DbgMsg(&quot;\nBoosting started.\n&quot;);

    // Установка начальных весов для обучающего набора m_TrainingSet
    for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
    {
        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
        if (s-&gt;GetFlag() == 1)
            s-&gt;SetWeight(wf);
        else if (s-&gt;GetFlag() == 0)
            s-&gt;SetWeight(wnf);
        else
            continue;
    }

    ProgressMeter progress;
    progress.Init( 30, (int)m_TrainingSamples.GetCount( ) );

    m_ResultClass.Clear();
    m_trainData.clear();

    if (m_Features.GetCount() == 0)
    {
        DbgMsg(&quot;Error: features set is empty.\n&quot;);
        return false;
    }

    //Main loop;
    for ( int i = 0; i &lt; m_nFeaturesCount ; ++i )
    {

        DbgMsg( &quot;\nUpdating: &quot; );
        progress.Init( 30, m_Features.GetCount( ) );
        int count = 0;

//Update
#ifdef _OMP_
omp_set_num_threads(8);
#pragma omp parallel for reduction(+: count)
#endif 
        for ( int w = 0; w &lt; m_Features.GetCount(); ++w )
        {
            //printf(&quot;.&quot;);
            ++count;
            TCSWeakTraining* wcinfo = (TCSWeakTraining*)m_Features.Get(w);
            wcinfo-&gt;SetEpsilon(0);

            //Train section;
            wcinfo-&gt;StartTraining();
            for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
               TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
               wcinfo-&gt;AddSample(s, s-&gt;GetFlag(), s-&gt;GetWeight(), this-&gt;m_widthBase);
            }
            wcinfo-&gt;Train();

            //Calc error;
            for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
                TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

                double factor = (double)(s-&gt;GetImage()-&gt;sSizeX)/m_widthBase;
                wcinfo-&gt;Scale(factor);

                int res = wcinfo-&gt;Classify( s );

                if ( s-&gt;GetFlag() != res )
                {
                    wcinfo-&gt;SetEpsilon(wcinfo-&gt;GetEpsilon() + s-&gt;GetWeight());
                }
            }

            if ( progress.Update( ) )
                DbgMsg(&quot;&gt;&quot;);
        }

        DbgMsg( &quot;\n&quot; );
        printf( &quot;Count stage: %d \n&quot;, count );
        // выбор лучшего признака, по минимальной ошибке классификации на обучающем наборе.
        int bestWc = 0;
        for ( int w = 0; w &lt; m_Features.GetCount(); ++w )
        {
            TCSWeakTraining* best       = (TCSWeakTraining*)m_Features.Get(bestWc);
            TCSWeakTraining* current    = (TCSWeakTraining*)m_Features.Get(w);
            if ( best-&gt;GetEpsilon() &gt; current-&gt;GetEpsilon()  )
                bestWc = w;
        }
        TCSWeakTraining* pWc       = (TCSWeakTraining*)m_Features.Get(bestWc);
        pWc-&gt;SetWeight( pWc-&gt;GetEpsilon() );

        // если ошибка лучшего классификатора превысила критический уровень 50%
        // прекращаем процесс накачки.
        if ( pWc-&gt;Weight() &gt;= 0.5 ) break;


        //Update wc weight;
        double beta = pWc-&gt;Weight()/ (1 - pWc-&gt;Weight());
        double min_eps = pWc-&gt;Weight();
        pWc-&gt;SetWeight (log(1.0/beta));

        //Добавим &quot;слабый&quot; классификатор в &quot;комитет".
        m_ResultClass.AddWeak(new TCSWeak(pWc));

        // распечатка атрибутов классификатора
        DbgMsg( &quot;\nRound num = &quot; + TypeToStr(i + 1) +
            &quot;, min_eps = &quot; + TypeToStr(min_eps) +
            &quot;, beta = &quot; + TypeToStr( beta ) +
        &quot;, alpha = &quot;+ TypeToStr(pWc-&gt;Weight())+&quot;;\n&quot; );
    // распечатка атрибутов выбранного признака
    if ( pWc-&gt;Fetaure() != NULL )
            PrintFeature(pWc-&gt;Fetaure());

        //распечатка ошибки на тестовом наборе.
        double afrr = 100;
        double FARV = PrintStatistics( m_ResultClass, afrr );
        //DbgMsg(&quot;afrr =&quot; + TypeToStr(afrr) +&quot;\n&quot;);

        // завершаем процесс, если ошибка уменьшилась до порогового значения
        if (FARV &lt; m_FinishFar &amp;&amp; afrr &lt; 0.001)
        {
            //this-&gt;SaveFRRSamples(stage);
            return true;
        }

        // для каждого образца обновим веса
        double wt = 0;
        for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
        {
            TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

            int res = 0;
            double err = 0;
            double factor = (double)(s-&gt;GetImage()-&gt;sSizeX)/m_widthBase;
            pWc-&gt;Scale(factor);
            res = pWc-&gt;Classify( s );


            if ( res == s-&gt;GetFlag() )
                s-&gt;SetWeight(s-&gt;GetWeight()*beta);
            wt += s-&gt;GetWeight();
        }

        //Normalize;
        wt = 1.0/wt;

        for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
        {
            TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
            s-&gt;SetWeight(s-&gt;GetWeight()*wt);
        }

        //Удалим найденный признак из списка признаков
        m_Features.Delete(bestWc);

    }

    //this-&gt;SaveFRRSamples(stage);
    return true;
}

// распечатка сообщения на экране и в лог файле
void TCSAdaBoost::DbgMsg( std::string const&amp; msg)
{
    (*m_pLog) &lt;&lt; msg;
    cout &lt;&lt; msg;
    flush( *m_pLog );
}

std::string TCSAdaBoost::GetArtefactsBase()
{
    return m_strArtefactsBase;
}
void TCSAdaBoost::SetArtefactsBase(std::string str)
{
    m_strArtefactsBase = str;
}
std::string TCSAdaBoost::GetObjectsBase()
{
    return m_strObjectsbase;
}

void TCSAdaBoost::SetObjectsBase(std::string str)
{
    m_strObjectsbase = str;
}

// возвращает ширину и высоту изображений, которые используются
// для обучения
AWPWORD TCSAdaBoost::WidthBase()
{
    return m_widthBase;
}
void TCSAdaBoost::SetWidthBase(AWPWORD value)
{
    m_widthBase = value;
}
AWPWORD TCSAdaBoost::HeightBase()
{
    return m_heightBase;
}
void TCSAdaBoost::SetHeightBase(AWPWORD value)
{
    m_heightBase = value;
}
TErrTrainData&amp; TCSAdaBoost::GetTrainData()
{
    return m_trainData;
}

TCSStrong* TCSAdaBoost::GetClass()
{
    return &amp;m_ResultClass;
}
int TCSAdaBoost::GetFeaturesCount()
{
    return m_nFeaturesCount;
}
void TCSAdaBoost::SetFeaturesCount(int value)
{
    m_nFeaturesCount = value;
}

double TCSAdaBoost::GetFinishFar()
{
    return this-&gt;m_FinishFar;
}
void TCSAdaBoost::SetFinishFar(double value)
{
    this-&gt;m_FinishFar = value;
}

std::string TCSAdaBoost::GetPath()
{
    return this-&gt;m_strPath;
}

void TCSAdaBoost::SetPath(const char* lpPath)
{
    this-&gt;m_strPath = lpPath;
}

static bool _IsImageFile(std::string&amp; strFileName)
{
    std::string strExt = LFGetFileExt(strFileName);
    std::transform(strExt.begin(), strExt.end(), strExt.begin(), ::tolower);

    if (strExt == &quot;.awp&quot;)
        return true;
    if (strExt == &quot;.jpg&quot;)
        return true;
    if (strExt == &quot;.jpeg&quot;)
        return true;
    if (strExt == &quot;.png&quot;)
        return true;
    if (strExt == &quot;.bmp&quot;)
        return true;
    return false;
}

// загружает образцы для обучения из директории path и сохраняет их в списке объектов 
// SampleList. в зависимости от установленного флага flag образцы считаются образцами 
// объектов или образцами фонов. flag = 1 соответствует образцам объектов, flag = 0 - 
// соответствует образцам фонов.
bool TCSAdaBoost::LoadSample(TLFObjectList&amp; SampleList, int flag, std::string const&amp; path)
{
    DbgMsg( &quot;Loading samples from &quot; + path + &quot;... \n&quot; );
    int count = 0;
    TLFStrings names;
    if (!LFGetDirFiles(path.c_str(), names))
    {
        DbgMsg(&quot;Reading names failed.&quot;);
        return false;
    }
    if (names.size() == 0)
    {
        DbgMsg(&quot;Database is empty.&quot;);
        return false;
    }
    DbgMsg(&quot;Reading &quot; + TypeToStr(names.size()) + &quot; files.\n&quot;);
    for (int i = 0; i &lt; names.size(); i++)
    {
        string name = names[i];
        if (!_IsImageFile(name))
            continue;
        TCSSample* pSample = new TCSSample();
        //DbgMsg(name + &quot;\n&quot;);
        pSample-&gt;LoadFromFile((char*)name.c_str());
        double e = 0;
        if (pSample-&gt;GetImage()-&gt;sSizeX &lt; this-&gt;m_widthBase || pSample-&gt;GetImage()-&gt;sSizeY &lt; this-&gt;m_heightBase)
        {
            delete pSample;
            continue;
        }
        awpImage* img = pSample-&gt;GetIntegralImage();
        if (img == NULL)
            continue;
        pSample-&gt;GetSqIntegralImage();
        bool need_process = flag == 1 ? true : false;
        pSample-&gt;SetFlag(flag);
        SampleList.Add(pSample);
        ++count;
    }

    DbgMsg(TypeToStr(count) + &quot; ok\n&quot;);
    return count &gt; 0;

}
//
void TCSAdaBoost::InitFeatures()
{
   
    DbgMsg(&quot;AdaBoost: init features .... &quot;);
    srand(11);
    m_Features.Clear();

   int sx = 1;
   int sy = 1;
   int w = 3;
   int h = 3;
   for (h = m_heightBase; h &gt;= 3; h-=1)
   {
       for (w = m_widthBase; w &gt;= 3; w-=1)
       {
           for (sy = 0; sy &lt;= m_heightBase - h -3; sy++)
           {
               for (sx = 0; sx &lt;= m_widthBase - w -3; sx++)
               {
                   
                   bool skip = false;// (rand() % 10) &gt; 2;
                   if (skip)
                       continue;
                   TCSWeakTraining* wt = NULL;
                   TLFVFeature Sensor0(sx, sy, w/2, h);
                   wt = new TCSWeakTraining(&amp;Sensor0);
                   if (this-&gt;m_VFeature)
                       m_Features.Add(wt);
                   else
                       delete wt;
                   TLFHFeature Sensor1(sx, sy, w, h/2);
                   wt = new TCSWeakTraining(&amp;Sensor1);
                   if (this-&gt;m_HFeature)
                    m_Features.Add(wt);
                   else
                       delete wt;
                   TLFDFeature Sensor2(sx, sy, w / 2, h / 2);
                   wt = new TCSWeakTraining(&amp;Sensor2);
                   if (this-&gt;m_DFeature)
                    m_Features.Add(wt);
                   else
                       delete wt;
                   TLFCFeature Sensor3(sx, sy, w / 3, h / 3);
                   wt = new TCSWeakTraining(&amp;Sensor3);
                   if (this-&gt;m_CFeature)
                    m_Features.Add(wt);
                   else
                       delete wt;
                   TCSSensor Sensor4(sx, sy, w / 3, h / 3);
                   wt = new TCSWeakTraining(&amp;Sensor4);
                   if (this-&gt;m_CSFeature)
                    m_Features.Add(wt);
                   else
                       delete wt;
                   TLFLBPFeature Sensor5(sx, sy, w / 3, h / 3);
                   wt = new TCSWeakTraining(&amp;Sensor5);
                   if (this-&gt;m_LBPFeature)
                    m_Features.Add(wt);
                   else
                       delete wt;

                   TLFVAFeature Sensor6(sx, sy, w / 2, h);
                   wt = new TCSWeakTraining(&amp;Sensor6);
                   if (this-&gt;m_VAFeature)
                       m_Features.Add(wt);
                   else
                       delete wt;
                   TLFHAFeature Sensor7(sx, sy, w, h / 2);
                   wt = new TCSWeakTraining(&amp;Sensor7);
                   if (this-&gt;m_HAFeature)
                       m_Features.Add(wt);
                   else
                       delete wt;
                   TLFDAFeature Sensor8(sx, sy, w / 2, h / 2);
                   wt = new TCSWeakTraining(&amp;Sensor8);
                   if (this-&gt;m_DAFeature)
                       m_Features.Add(wt);
                   else
                       delete wt;
                   TLFCAFeature Sensor9(sx, sy, w / 3, h / 3);
                   wt = new TCSWeakTraining(&amp;Sensor9);
                   if (this-&gt;m_CAFeature)
                       m_Features.Add(wt);
                   else
                       delete wt;
                   //TLFColorSensor9Bit Sensor10(sx,sy,w,h);
                   //wt = new TCSWeakTraining(&amp;Sensor10);
                   //m_Features.Add(wt);
               }
           }
       }
   }
   DbgMsg(&quot; done .\n&quot;);
   DbgMsg( &quot;AdaBoost: Initiated &quot; + TypeToStr( m_Features.GetCount() )+&quot; features.\n&quot; );
}

void TCSAdaBoost::PrintFeature(ILFFeature* pSensor)
{
    DbgMsg( &quot;Found feature:&quot; + TypeToStr(pSensor-&gt;GetName()) + &quot; x = &quot; + TypeToStr( pSensor-&gt;sxBase() ) +
        &quot;, y = &quot; + TypeToStr( pSensor-&gt;syBase() ) +
        &quot;, width = &quot; + TypeToStr( pSensor-&gt;wUnitBase() ) +
        &quot;, height = &quot; + TypeToStr( pSensor-&gt;hUnitBase() ) + &quot;;\n&quot;);
}

double TCSAdaBoost::PrintStatistics(TCSStrong&amp; Class, double&amp; afrr)
{
    double          dFar = 0, dFrr = 0;
    double min_err = 100000;

    for (  int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
    {

        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

        double err = 0;
        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        Class.Setup(r, m_widthBase);

        Class.Classify(s, err );

        if ( s-&gt;GetFlag() == 1 )
        {
            if (err &lt; min_err)
                min_err = err;

            if ( err &lt; Class.GetThreshold() ) dFrr += 1.0;
        }
        else
        {
            if ( err &gt;= Class.GetThreshold() )
            {
                dFar += 1.0;
            }
        }


    }

    dFrr /= m_nTestFaces;
    dFar /= m_nTestNonFaces;

    DbgMsg( &quot;\nFAR = &quot; + TypeToStr( dFar ) +
            &quot;, FRR = &quot; + TypeToStr( dFrr ) +
            &quot;, threshold = &quot; + TypeToStr( Class.GetThreshold() )+ &quot;;\n&quot; );

    //todo:
    afrr = dFrr;
    
    TWclErrInfo err_info;
    err_info.m_far = dFar;
    err_info.m_frr = dFrr;
    err_info.m_thr = Class.GetThreshold();

    m_trainData.push_back(err_info);
    return dFar;

    double ff = 0;
    double dFar1 = 0;
    double dFrr1 = 0;

    for (  int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
    {

        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

        double err = 0;
        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        Class.Setup(r, m_widthBase);


        Class.Classify( s, err );

        if ( s-&gt;GetFlag() == 1 )
        {
            if (err &lt; min_err) dFrr1 += 1.0;
        }
        else
        {

            if ( err &gt;= min_err )
            {
                dFar1 += 1.0;
            }
        }


    }

    dFrr1 /= m_nTestFaces;
    dFar1 /= m_nTestNonFaces;
    afrr = dFrr1;

    DbgMsg( &quot;ro = &quot; + TypeToStr( min_err ) + &quot;\t frr = &quot; + TypeToStr( dFrr1 ) +
        &quot;,\t far = &quot; + TypeToStr( dFar1 ) + &quot;;\n&quot;);

    //TWclErrInfo err_info;
    err_info.m_far = dFar1;
    err_info.m_frr = dFrr1;
    err_info.m_thr = min_err;

    m_trainData.push_back(err_info);

    return dFar1;
}
int SampleCompare(void * Item1, void * Item2)
{
    TCSSample* s1 = (TCSSample*)Item1;
    TCSSample* s2 = (TCSSample*)Item2;
    if (s1-&gt;GetRating() &gt; s2-&gt;GetRating())
        return 1;
    else if (s1-&gt;GetRating() == s2-&gt;GetRating())
        return 0;
    else
        return -1;
}
void   TCSAdaBoost::SaveFRRSamples(int stage)
{
    if (stage &lt; 0)
        return;
    std::string strPath = this-&gt;m_strPath;
    strPath += &quot;\\frr\\&quot;;

    if (!LFDirExist(strPath.c_str()))
        LFCreateDir(strPath.c_str());

    char buf[32];
    sprintf(buf, &quot;stage%d&quot;, stage);
    strPath += buf;
    if (!LFDirExist(strPath.c_str()))
        LFCreateDir(strPath.c_str());

    //forming an array of positive examples for each settable rating received strong classifier
    TLFObjectList positiveSamples;
    for (int i = 0; i &lt; this-&gt;m_TrainingSamples.GetCount(); i++)
    {
        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
        if (s-&gt;GetFlag() == 1)
        {
            double err = 0;
            awpRect r; r.left =0; r.top = 0;
            r.right = s-&gt;GetImage()-&gt;sSizeX;
            r.bottom = s-&gt;GetImage()-&gt;sSizeY;

            this-&gt;m_ResultClass.Setup(r, m_widthBase);
            this-&gt;m_ResultClass.Classify(s, err);
            s-&gt;SetRating(err);
            
            positiveSamples.Add (new TCSSample(s));
        }
    }
    // sort the list
    positiveSamples.Sort(SampleCompare);
    // Save 1% of the list to disk
    std::string strFrrFileName = LFMakeFileName(strPath, &quot;frr&quot;, &quot;.txt&quot;);
    FILE* F = fopen(strFrrFileName.c_str(), &quot;w+t&quot;);
    if (F == NULL)
        return;
    fprintf (F, &quot;stage threshold = %f\n&quot;, this-&gt;m_ResultClass.GetThreshold());
    int numToSave = positiveSamples.GetCount() / 100;
    for (int i = 0; i &lt; numToSave; i++)
    {
        TCSSample* s = (TCSSample*)positiveSamples.Get(i);
        std::string strFileName = LFMakeFileName(strPath, TypeToStr(i), &quot;.jpg&quot;);
        double r = s-&gt;GetRating();
        fprintf (F, &quot;%s\t %f\n&quot;, strFileName.c_str(),  r);
        awpSaveImage(strFileName.c_str(), s-&gt;GetImage());
    }
    fclose(F);
}

void   TCSAdaBoost::SaveNegativeSamples(const char* lpPath)
{
    string path = lpPath;
    int total = 0;
    LFCreateDir(lpPath);
    for (int i = 0; i &lt; this-&gt;m_TrainingSamples.GetCount(); i++)
    {
        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
        if (s-&gt;GetFlag() == 0)
        {
            string filename = path;
            filename += TypeToStr(total);
            filename += &quot;.awp&quot;;
            total++;
            s-&gt;SaveToFile(filename.c_str());
        }
    }
}

////////////////////////////////////////////////////////////////////////////////
TCSAdaBoostSign::TCSAdaBoostSign()
{
    m_widthBase = 24;
    m_heightBase = 24;
    m_maxFeatures = 50;
    m_strBase1 = &quot;&quot;;
    m_strBase2 = &quot;&quot;;
    m_numSamplesBase1  = 0;
    m_numSamplesBase1  = 0;

    m_flog.open(&quot;log.txt&quot;);
}
bool TCSAdaBoostSign::Load(const char* lpConfigName)
{
   if (lpConfigName == NULL)
        return false;

   TiXmlDocument doc(lpConfigName);
   if (!doc.LoadFile())
    return false;

   TiXmlHandle hDoc(&amp;doc);
   TiXmlElement* pElem = NULL;
   pElem = hDoc.FirstChildElement().Element();

   if (!pElem)
      return false;
   const char* name = pElem-&gt;Value();
   if (strcmp(name, &quot;csboostsign&quot;) != 0)
      return false;
   return Load( pElem);
}

bool    TCSAdaBoostSign::Load (TiXmlElement* node)
{
   if (node == NULL)
    return false;
    m_TrainingSamples.Clear();
    m_TestingSamples.Clear();
    TiXmlElement* pElem = NULL;
    pElem = node-&gt;FirstChildElement();
    //Загрузка образцов для обучения
    DbgMsg( &quot;Loading training sets...\n&quot; );
    m_strBase2 = pElem-&gt;Attribute(&quot;database2&quot;);
    if (!LoadSamples( -1, m_strBase2 ))
        return false;
    m_numSamplesBase2 = m_TrainingSamples.GetCount();
    m_numSamplesTestBase2 = m_TestingSamples.GetCount();
    std::string m_strBase1 = pElem-&gt;Attribute(&quot;database1&quot;);
    if (!LoadSamples( 1,  m_strBase1))
        return false;
    m_numSamplesBase1 = (int)m_TrainingSamples.GetCount( ) - m_numSamplesBase2;
    m_numSamplesTestBase1 = (int)m_TestingSamples.GetCount( ) - m_numSamplesTestBase2;

    //
    double v;
    m_widthBase = 24;
    m_heightBase = 24;
    pElem-&gt;Attribute(&quot;w&quot;, &amp;v);
    m_widthBase = (int )v;
    pElem-&gt;Attribute(&quot;h&quot;, &amp;v);
    m_heightBase = (int )v;

    pElem = pElem-&gt;NextSiblingElement();
    double ni = 5;
    pElem-&gt;Attribute(&quot;maxi&quot;, &amp;ni);
    m_maxFeatures = (int)ni;


    DbgMsg( &quot;Samples to training for class 1 &quot; + TypeToStr(m_numSamplesBase1) +&quot;;\n&quot; );
    DbgMsg( &quot;Samples to training for class -1 &quot; + TypeToStr(m_numSamplesBase2) +&quot;;\n&quot; );
    DbgMsg( &quot;Samples to testing for class 1 &quot; + TypeToStr(m_numSamplesTestBase1) +&quot;;\n&quot; );
    DbgMsg( &quot;Samples to testing for class -1 &quot; + TypeToStr(m_numSamplesTestBase2) +&quot;;\n&quot; );

    // инициализация исходного массива признаков
   InitFeatures( );

    return true;
}

void TCSAdaBoostSign::SetLogName(char* lpLogName)
{
}

void TCSAdaBoostSign::SetLog1Name(char* lpLog1Name)
{
}


bool TCSAdaBoostSign::Boost()
{
    // Начало накачки.
    double wf   = 0.5/m_numSamplesBase1;
    double wnf = 0.5 / m_numSamplesBase2;

    DbgMsg(&quot;\nBoosting started.\n&quot;);

    // Установка начальных весов для обучающего набора m_TrainingSet
    for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
    {
        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
        if (s-&gt;GetFlag() == 1)
            s-&gt;SetWeight(wf);
        else if (s-&gt;GetFlag() == -1)
            s-&gt;SetWeight(wnf);
        else
            continue;
    }

    ProgressMeter progress;
    progress.Init( 30, (int)m_TrainingSamples.GetCount( ) );

    m_ResultClass.Clear();
    //m_trainData.clear();

    if ( m_Features.GetCount( ) == 0 ) return false;

    //Main loop;
    for ( int i = 0; i &lt; m_maxFeatures ; ++i )
    {

        DbgMsg( &quot;\nUpdating: &quot; );
        progress.Init( 30, m_Features.GetCount( ) );
        int count = 0;

//Update
#pragma omp parallel for reduction(+: count)
        for ( int w = 0; w &lt; m_Features.GetCount(); ++w )
        {
            ++count;
            TCSWeakSignTrainig* wcinfo = (TCSWeakSignTrainig*)m_Features.Get(w);
            wcinfo-&gt;SetEpsilon(0);

            //Train section;
            wcinfo-&gt;StartTraining();
            for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
               TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
               wcinfo-&gt;AddSample(s, s-&gt;GetFlag(), s-&gt;GetWeight());
            }
            wcinfo-&gt;Train();

            //Calc error;
            for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
                TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

                int res = wcinfo-&gt;Classify( s );

                if ( s-&gt;GetFlag() != res )
                {
                    wcinfo-&gt;SetEpsilon(wcinfo-&gt;GetEpsilon() + s-&gt;GetWeight());
                }
            }

            if ( progress.Update( ) )
                DbgMsg(&quot;&gt;&quot;);
        }

        DbgMsg( &quot;\n&quot; );
        printf( &quot;Count stage: %d \n&quot;, count );
        // выбор лучшего признака, по минимальной ошибке классификации на обучающем наборе.
        int bestWc = 0;
        for ( int w = 0; w &lt; m_Features.GetCount(); ++w )
        {
            TCSWeakSignTrainig* best       = (TCSWeakSignTrainig*)m_Features.Get(bestWc);
            TCSWeakSignTrainig* current    = (TCSWeakSignTrainig*)m_Features.Get(w);
            if ( best-&gt;GetEpsilon() &gt; current-&gt;GetEpsilon()  )
                bestWc = w;
        }
        TCSWeakSignTrainig* pWc       = (TCSWeakSignTrainig*)m_Features.Get(bestWc);
        pWc-&gt;SetWeight((double)pWc-&gt;GetEpsilon());

        // если ошибка лучшего классификатора превысила критический уровень 50%
        // прекращаем процесс накачки.
        if ( pWc-&gt;Weight() &gt; 0.49 ) break;


        //Update wc weight;
        double beta = pWc-&gt;Weight()/ (1 - pWc-&gt;Weight());
        double min_eps = pWc-&gt;Weight();
        pWc-&gt;SetWeight (log(1.0/beta));

        //Добавим &quot;слабый&quot; классификатор в &quot;комитет".
        m_ResultClass.AddWeak(pWc);
        
        // распечатка атрибутов классификатора
        DbgMsg( &quot;\nRound num = &quot; + TypeToStr(i + 1) +
            &quot;, min_eps = &quot; + TypeToStr(min_eps) +
            &quot;, beta = &quot; + TypeToStr( beta ) +
        &quot;, alpha = &quot;+ TypeToStr(pWc-&gt;Weight())+&quot;;\n&quot; );

        this-&gt;Statistics();
        // для каждого образца обновим веса
        double wt = 0;
        for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
        {
            TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

            int res = 0;
            double err = 0;
            res = pWc-&gt;Classify( s );

            if ( res == s-&gt;GetFlag() )
                s-&gt;SetWeight(s-&gt;GetWeight()*beta);
            wt += s-&gt;GetWeight();
        }

        //Normalize;
        wt = 1.0/wt;

        for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
        {
            TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
            s-&gt;SetWeight(s-&gt;GetWeight()*wt);
        }

        //Удалим найденный признак из списка признаков
        m_Features.Delete(bestWc);

    }
    //SaveROC();
    return true;
}
//
TCSStrongSign* TCSAdaBoostSign::GetResult()
{
  return &amp;m_ResultClass;
}

void    TCSAdaBoostSign::InitFeatures()
{
    m_Features.Clear();

   int sx = 1;
   int sy = 1;
   int w = 3;
   int h = 3;
   for (h = m_heightBase -3; h &gt;= 3; h-=3)
   {
       for (w = m_widthBase ; w &gt;= 3; w-=3)
       {
           for (sy = 1; sy &lt; m_heightBase - h - 1; sy++)
           {
               for (sx = 1; sx &lt; m_widthBase - w - 1; sx++)
               {
                   TCSSensor Sensor(sx, sy, w / 3, h / 3);
                   TCSWeakSignTrainig* wt = new TCSWeakSignTrainig(Sensor);
                   m_Features.Add(wt);
               }
           }
       }
   }
}

bool    TCSAdaBoostSign::LoadSamples(int flag, std::string const&amp; path)
{
    DbgMsg( &quot;Loading samples from &quot; + path + &quot;... &quot; );

    int count = 0;
    srand( (unsigned)time( NULL ) );
    int RANGE_MIN = 0;
    int RANGE_MAX = 3;

#ifdef WIN32
    intptr_t handle = 0;
    _finddata_t filesInfo;
    if ( (handle = _findfirst( (char*)((path+&quot;*.jpg&quot;).c_str()), &amp;filesInfo)) != -1 )
    {
        do
        {
           string name = path + filesInfo.name;
        
            TCSSample* pSample = new TCSSample();
            pSample-&gt;LoadFromFile((char*)name.c_str());

    //        if (pSample-&gt;Process())
            {
                pSample-&gt;SetFlag(flag);
                int r = (int)(((double) rand() / (double) RAND_MAX) * RANGE_MAX + RANGE_MIN);

                //int  r = rand(0);
                if (r &gt; 0)
                    m_TrainingSamples.Add(pSample);
                else
                    m_TestingSamples.Add(pSample);

                ++count;
            }
//            else
//printf( &quot;Can&#39;t load image %s.\n&quot;, name.c_str( ) );
        }while(!_findnext( handle, &amp;filesInfo ));


    }
    _findclose( handle );

#else

//    struct dirent** namelist;
//    if(( count = scandir( path.c_str(), &amp;namelist, jpg_filter, alphasort )) &lt; 0 )
//            return 0;

//    for( int i=0; i&lt;count; i++ )
//    {
//            string name = path + namelist[i]-&gt;d_name;

//            TCSSample* pSample = new TCSSample();
//            pSample-&gt;LoadImage((char*)name.c_str());


//                pSample-&gt;SetFlag(flag);
//              int r = (((double) rand() / (double) RAND_MAX) * RANGE_MAX + RANGE_MIN);

//                //int  r = rand(0);
//                if (r &gt; 0)
//                    m_TrainingSamples.Add(pSample);
//                else
//                    m_TestingSamples.Add(pSample);

//    }

#endif

    DbgMsg( TypeToStr( count ) + &quot; ok\n&quot; );
    return count &gt; 0;
}
void    TCSAdaBoostSign::DbgMsg( std::string const&amp; msg)
{
    std::cout&lt;&lt; msg;  
#ifdef WIN32
    m_flog &lt;&lt; msg;
    m_flog.flush();
#endif
}

void    TCSAdaBoostSign::Statistics()
{
    double errt[2] = {0,0};
    double err1[2] = { 0, 0 };
    double err2[2] = { 0, 0 };
    double erru[2] = { 0, 0 };
    for (  int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
    {

        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

        double err = 0;
        //double factor = (double)(s-&gt;GetImage()-&gt;sSizeX)/24.0;
        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        m_ResultClass.Setup(r, m_widthBase);

        int res = m_ResultClass.Classify( s-&gt;GetIntegralImage(), err );
        if (res != s-&gt;GetFlag())
        {
              errt[0]++;
              if (res == 0)
                erru[0]++;
              if (res == 1)
                err2[0]++;
              if (res == -1)
                err1[0]++;
        }
    }
    errt[0] /= m_TrainingSamples.GetCount();
    errt[0] *= 100;

    err1[0] /= (m_numSamplesBase1);
    err1[0] *= 100;

    err2[0] /= (m_numSamplesBase2);
    err2[0] *= 100;

    erru[0] /= m_TrainingSamples.GetCount();
    erru[0] *= 100;
    for (  int i = 0; i &lt; m_TestingSamples.GetCount(); i++ )
    {

        TCSSample* s = (TCSSample*)m_TestingSamples.Get(i);

        double err = 0;
        //double factor = (double)(s-&gt;GetImage()-&gt;sSizeX)/24.0;
        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        m_ResultClass.Setup(r, m_widthBase);

        int res = m_ResultClass.Classify( s-&gt;GetIntegralImage(), err );
        if (res != s-&gt;GetFlag())
        {
              errt[1]++;
              if (res == 0)
                erru[1]++;
              if (res == 1)
                err2[1]++;
              if (res == -1)
                err1[1]++;
        }
    }
    if (m_TestingSamples.GetCount() &gt; 0)
    {
    errt[1] /= m_TestingSamples.GetCount();
    errt[1] *= 100;

    err1[1] /= (m_numSamplesTestBase1);
    err1[1] *= 100;
    err2[1] /= (m_numSamplesTestBase2);
    err2[1] *= 100;


    erru[1] /= m_TestingSamples.GetCount();
    erru[1] *= 100;
    }

    DbgMsg( &quot;errt = &quot; + TypeToStr( errt[0] ) + &quot; % &quot; + TypeToStr( errt[1] ) + &quot;%;\n&quot; );
    DbgMsg( &quot;err1 = &quot; + TypeToStr( err1[0] ) + &quot; % &quot; + TypeToStr( err1[1] ) + &quot;%;\n&quot; );
    DbgMsg( &quot;err2 = &quot; + TypeToStr( err2[0] ) + &quot; % &quot; + TypeToStr( err2[1] ) + &quot;%;\n&quot;  );
    DbgMsg( &quot;erru = &quot; + TypeToStr( erru[0] ) + &quot; % &quot; + TypeToStr( erru[1] ) + &quot;%;\n&quot; );
}


struct roc_entry
{
    double far1;
    double frr1;
    double far2;
    double frr2;
};
void TCSAdaBoostSign::SaveROC(char*lpName)
{
 //
    double* fSourceClass1 = NULL;
    double* fSourceClass2 = NULL;
    roc_entry roc[100];
    memset(roc,0, sizeof(roc));
    fSourceClass1 = (double*)malloc(m_numSamplesTestBase1*sizeof(double));
    fSourceClass2 = (double*)malloc(m_numSamplesTestBase2*sizeof(double));
    memset(fSourceClass1, 0, m_numSamplesTestBase1*sizeof(double));
    memset(fSourceClass2, 0, m_numSamplesTestBase2*sizeof(double));
    int nc1 =0;
    int nc2 =0;

    for (int i = 0; i &lt; m_TestingSamples.GetCount(); i++)
    {
        TCSSample* s = (TCSSample*)m_TestingSamples.Get(i);

        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        m_ResultClass.Setup(r, m_widthBase);
        double err = 0;
        m_ResultClass.Classify( s-&gt;GetIntegralImage(), err );
        if (s-&gt;GetFlag() == 1)
        {
            fSourceClass1[nc1] = err;
            nc1++;
        }
        else
        {
            fSourceClass2[nc2] = err;
            nc2++;
        }
    }

    double tau = m_ResultClass.GetSumWeakWeight();

    DbgMsg( TypeToStr( tau ) + &quot;\n&quot; );

    double delta = tau / 50.f;
    double stau = -tau;
    int c = 0;
    while(stau &lt; tau)
    {
        for (int i=0; i&lt; nc1; i++)
        {
            if (fSourceClass1[i] &lt; stau)
                roc[c].frr1++;
            if (fSourceClass1[i] &lt; stau)
                roc[c].far2++;
        }
        for (int i=0; i&lt; nc2; i++)
        {
            if (fSourceClass2[i] &gt; stau)
                roc[c].far1++;
            if (fSourceClass2[i] &gt; stau)
                roc[c].frr2++;
        }

        stau += delta;
        c++;
    }
    DbgMsg( TypeToStr( c ) + &quot;\n&quot; );
    for (int i = 0; i &lt; 100; i++)
    {
        roc[i].far1 = 100.f*roc[i].far1/nc2;
        roc[i].frr1 = 100.f*roc[i].frr1/nc1;
        roc[i].far2 = 100.f*roc[i].far2/nc1;
        roc[i].frr2 = 100.f*roc[i].frr2/nc2;
    }
//  std::ostream*       f;
//  f = new ofstream(&quot;roc.txt&quot;);
//  for (int i = 0; i &lt; 100; i++)
//      (*f) &lt;&lt; roc[i].far1 &lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr1&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].far2&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr2 &lt;&lt;&quot;\n&quot;;
//  delete f;
    FILE* f = fopen (lpName, &quot;w+t&quot;);
    for (int i = 0; i &lt; 100; i++)
    {
//      fprintf(f, &quot;%f\n&quot;, roc[i].far1);
        fprintf(f, &quot;%f\t%f\t%f\t%f\n&quot;, roc[i].far1, roc[i].frr1, roc[i].far2,roc[i].frr2);
    }
    //  (*f) &lt;&lt; roc[i].far1 &lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr1&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].far2&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr2 &lt;&lt;&quot;\n&quot;;
    fclose(f);
    free(fSourceClass1);
    free(fSourceClass2);
}

TIEFSAdaBoost::TIEFSAdaBoost()
{
    m_numIFS = 0;
    m_numEFS = 0;
    m_strSourceFile = &quot;&quot;;
    m_pLog = NULL;
}

bool TIEFSAdaBoost::Load(const char* lpFileName)
{
    /*попытка открыть файл конфигурации*/
    TiXmlDocument doc(lpFileName);
    if (!doc.LoadFile())
        return false;
    TiXmlElement* e = doc.FirstChildElement(&quot;IEFSBoost&quot;);
    if (e == NULL)
        return false;
    m_strSourceFile = e-&gt;Attribute(&quot;file&quot;);
    string str = e-&gt;Attribute(&quot;log&quot;);

    if (m_pLog == NULL)
        m_pLog = new ofstream(str.c_str());

    return LoadSamples();
}
// распечатка сообщения на экране и в лог файле
void TIEFSAdaBoost::DbgMsg(std::string const&amp; msg)
{
    (*m_pLog) &lt;&lt; msg;
    cout &lt;&lt; msg;
    flush(*m_pLog);
}

bool TIEFSAdaBoost::Boost()
{
    // Начало накачки.
    double wf  = 0.5 / this-&gt;m_numIFS;
    double wnf = 0.5 / this-&gt;m_numEFS;

    DbgMsg(&quot;\nBoosting started.\n&quot;);

    // Установка начальных весов для обучающего набора m_TrainingSet
    for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
    {
        TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
        if (s-&gt;GetFlag() == 1)
            s-&gt;SetWeight(wf);
        else if (s-&gt;GetFlag() == 0)
            s-&gt;SetWeight(wnf);
        else
            continue;
    }

    ProgressMeter progress;
    progress.Init(30, (int)m_TrainingSamples.GetCount());
    // result class 
    m_ResultClass.Clear();

    if (m_Features.GetCount() == 0)
        return false;

    //Main loop;
    //for (int i = 0; i &lt; this-&gt;m_Features.GetCount(); ++i)
    int i = 0;
    while (this-&gt;m_Features.GetCount() &gt; 0)
    {
        i++;
        DbgMsg(&quot;\nUpdating: &quot;);
        progress.Init(30, m_Features.GetCount());
        int count = 0;

        //Update
#pragma omp parallel for reduction(+: count)
        for (int w = 1; w &lt; m_Features.GetCount(); ++w)
        {
            ++count;
            TIEFSWeak2* wcinfo = (TIEFSWeak2*)m_Features.Get(w);
            if (!wcinfo-&gt;IsFree())
                continue;
            wcinfo-&gt;SetEpsilon(0);

            //Train section;
            wcinfo-&gt;StartTraining();
            for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
                TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
                wcinfo-&gt;AddSample(s);
            }
            wcinfo-&gt;Train();

            //Calc error;
            for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
                TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);

                int res = wcinfo-&gt;Classify(s-&gt;GetValue(w));

                if (s-&gt;GetFlag() != res)
                {
                    wcinfo-&gt;SetEpsilon(wcinfo-&gt;GetEpsilon() + s-&gt;GetWeight());
                }
            }

            if (progress.Update())
                DbgMsg(&quot;&gt;&quot;);
        }

        DbgMsg(&quot;\n&quot;);
        DbgMsg(&quot;Count stage: %d \n&quot; + TypeToStr(count));
        // выбор лучшего признака, по минимальной ошибке классификации на обучающем наборе.
        int bestWc = 1;
        while (!((TIEFSWeak2*)m_Features.Get(bestWc))-&gt;IsFree())
            bestWc++;
        for (int w = bestWc +1; w &lt; m_Features.GetCount(); ++w)
        {
            
            TIEFSWeak2* best = (TIEFSWeak2*)m_Features.Get(bestWc);
            TIEFSWeak2* current = (TIEFSWeak2*)m_Features.Get(w);
            if (!current-&gt;IsFree())
                continue;
            if (best-&gt;GetEpsilon() &gt; current-&gt;GetEpsilon())
                bestWc = w;
        }
        TIEFSWeak* pWc = (TIEFSWeak*)m_Features.Get(bestWc);
        pWc-&gt;SetWeight(pWc-&gt;GetEpsilon());

        // если ошибка лучшего классификатора превысила критический уровень 50%
        // прекращаем процесс накачки.
        if (pWc-&gt;GetWeight() &gt;= 0.5)
        {
        
            DbgMsg(&quot;\n Min eps = 0.5. Break.\n&quot;);
            break;
        }


        //Update wc weight;
        double beta = pWc-&gt;GetWeight() / (1 - pWc-&gt;GetWeight());
        double min_eps = pWc-&gt;GetWeight();
        pWc-&gt;SetWeight(log(1.0 / beta)); 

        //Добавим &quot;слабый&quot; классификатор в &quot;комитет".
        //result class  
        m_ResultClass.Add(pWc-&gt;Clone());
        m_ResultClass.SetThreshold(m_ResultClass.GetSumWeakWeight() / 2);
        pWc-&gt;Lock();
        // распечатка атрибутов классификатора
        DbgMsg(&quot;\nRound num = &quot; + TypeToStr(i + 1) +
            &quot;, min_eps = &quot; + TypeToStr(min_eps) +
            &quot;, beta = &quot; + TypeToStr(beta) +
            &quot;, alpha = &quot; + TypeToStr(pWc-&gt;GetWeight()) + &quot;;\n&quot;);
        // распечатка атрибутов выбранного признака
        DbgMsg(&quot;Feature num = &quot; + TypeToStr(pWc-&gt;GetIndex()) + &quot;\n&quot; );

        //распечатка ошибки на тестовом наборе.
        PrintStatistics();


        // для каждого образца обновим веса
        double wt = 0;
        for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
        {
            TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);

            int res = 0;

            res = pWc-&gt;Classify(s-&gt;GetValue(pWc-&gt;GetIndex()));

            if (res == s-&gt;GetFlag())
            {
                s-&gt;SetWeight(s-&gt;GetWeight()*beta);
            }
            wt += s-&gt;GetWeight();
        }

        //Normalize;
        wt = 1.0 / wt;
        double sum = 0;
        for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
        {
            TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
            s-&gt;SetWeight(s-&gt;GetWeight()*wt);
            sum += s-&gt;GetWeight();
        }
        DbgMsg(&quot;sum  = &quot; + TypeToStr(sum) + &quot;\n&quot;);
        //Удалим найденный признак из списка признаков
      //m_Features.Delete(bestWc);

    }

    this-&gt;m_ResultClass.SaveXML(&quot;IEFSclass.xml&quot;);
    if (this-&gt;m_ResultClass.LoadXML(&quot;IEFSclass.xml&quot;))
    {
        DbgMsg(&quot;Work done.\n\n&quot;);
        this-&gt;PrintStatistics();
        DbgMsg(&quot;Bye!\n&quot;);
        return true;
    }
    else
        return false;
}
double  TIEFSAdaBoost::PrintStatistics()
{
    double          dFar = 0, dFrr = 0;

    for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
    {
        TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
        double err = m_ResultClass.Raiting(s);
        if (s-&gt;GetFlag() == 1)
        {
            if (err &lt; m_ResultClass.GetThreshold()) dFrr += 1.0;
        }
        else
        {
            if (err &gt;= m_ResultClass.GetThreshold())
            {
                dFar += 1.0;
            }
        }
    }

    dFrr /= this-&gt;m_numIFS;
    dFar /= this-&gt;m_numEFS;

    DbgMsg(&quot;\nFAR = &quot; + TypeToStr(dFar) +
        &quot;, FRR = &quot; + TypeToStr(dFrr) +
        &quot;, threshold = &quot; + TypeToStr(m_ResultClass.GetThreshold()) + &quot;;\n&quot;);

    return 0;
}

bool TIEFSAdaBoost::InitFeatures(int num)
{
    if (num &lt;= 0)
    {
        DbgMsg(&quot;Invalid num features: num = &quot; +TypeToStr (num) + &quot;\n&quot;);
        return false;
    }
    for (int i = 0; i &lt; num; i++)
    {
        TIEFSWeak2* w = new TIEFSWeak2(i);
        this-&gt;m_Features.Add(w);
    }
    DbgMsg(TypeToStr(num) + &quot;features created.\n&quot;);
    return true;
}
bool TIEFSAdaBoost::LoadSamples()
{
    DbgMsg(&quot;Loading samples...\n&quot;);
    awpImage* img = NULL;
    if (awpLoadImage(this-&gt;m_strSourceFile.c_str(), &amp;img) != AWP_OK)
    {
        DbgMsg(&quot;Cannot load featues from &quot; + m_strSourceFile + &quot;\n&quot;);
        return false;
    }
    int num = img-&gt;sSizeX - 1;
    double* diff = (double*)malloc(num*sizeof(double));
    if (!this-&gt;InitFeatures(num))
    {
        awpReleaseImage(&amp;img);
        free(diff);
        return false;
    }
    double* d = (double*)img-&gt;pPixels;
    int ifs_count = 0;
    int efs_count = 0;
    for (int i = 0; i &lt; img-&gt;sSizeY; i++)
    {
        int id1 = (int)d[i*img-&gt;sSizeX];
        for (int j = i + 1; j &lt; img-&gt;sSizeY; j++)
        {
            int id2 = (int)d[j*img-&gt;sSizeX];
            int flag = id1 == id2 ? 1 : 0;
            if (!flag &amp;&amp; efs_count &gt; 730000)
                continue;
            if (flag)
                ifs_count++;
            else
                efs_count++;

            for (int k = 1; k &lt;= num; k++)
            {
                diff[k-1] = fabs(d[i*img-&gt;sSizeX + k] - d[j*img-&gt;sSizeX + k]);
            }
            TIEFSSample* s = new TIEFSSample(diff, num, flag);
            this-&gt;m_TrainingSamples.Add(s);
        }
    }
    this-&gt;m_numIFS = ifs_count;
    this-&gt;m_numEFS = efs_count;

    awpReleaseImage(&amp;img);
    free(diff);
    DbgMsg(&quot;IFS samples loaded = &quot; + TypeToStr(m_numIFS) + &quot;\n&quot;);
    DbgMsg(&quot;EFS samples loaded = &quot; + TypeToStr(m_numEFS) + &quot;\n&quot;);
    return true;
}
</span> </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keywordtype">string</span> str = pElem-&gt;Attribute(<span class="stringliteral">&quot;logfile&quot;</span>);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keywordflow">if</span> (m_pLog == NULL)</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        m_pLog = <span class="keyword">new</span> ofstream(str.c_str());</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160; </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    m_strArtefactsBase = pElem-&gt;Attribute(<span class="stringliteral">&quot;database0&quot;</span>);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    m_strObjectsbase = pElem-&gt;Attribute(<span class="stringliteral">&quot;database1&quot;</span>);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    m_widthBase = 70;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    m_heightBase = 20;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    m_strOutName = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordtype">double</span> ni = 5;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    pElem-&gt;Attribute(<span class="stringliteral">&quot;count_feat&quot;</span>, &amp;ni);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    m_nFeaturesCount = (int)ni;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160; </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="comment">// инициализация исходного массива признаков    InitFeatures( );
    return true;

}

bool TCSAdaBoost::Load  (const char* lpFileName)
{
   TiXmlDocument doc(lpFileName);
   if (!doc.LoadFile())
    return false;
   TiXmlHandle hDoc(&amp;doc);
   TiXmlElement* pElem = NULL;
   pElem = hDoc.FirstChildElement().Element();
   if (!pElem)
      return false;
   const char* name = pElem-&gt;Value();
   if (strcmp(name, &quot;csboost&quot;) != 0)
      return false;
   return Load( pElem, 0);
}

bool TCSAdaBoost::Boost(int stage)
{
    // Начало накачки.
    double wf   = 0.5/m_nFaces;
    double wnf  = 0.5/m_nNonFaces;

    DbgMsg(&quot;\nBoosting started.\n&quot;);

    // Установка начальных весов для обучающего набора m_TrainingSet
    for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
    {
        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
        if (s-&gt;GetFlag() == 1)
            s-&gt;SetWeight(wf);
        else if (s-&gt;GetFlag() == 0)
            s-&gt;SetWeight(wnf);
        else
            continue;
    }

    ProgressMeter progress;
    progress.Init( 30, (int)m_TrainingSamples.GetCount( ) );

    m_ResultClass.Clear();
    m_trainData.clear();

    if (m_Features.GetCount() == 0)
    {
        DbgMsg(&quot;Error: features set is empty.\n&quot;);
        return false;
    }

    //Main loop;
    for ( int i = 0; i &lt; m_nFeaturesCount ; ++i )
    {

        DbgMsg( &quot;\nUpdating: &quot; );
        progress.Init( 30, m_Features.GetCount( ) );
        int count = 0;

//Update
#ifdef _OMP_
omp_set_num_threads(8);
#pragma omp parallel for reduction(+: count)
#endif 
        for ( int w = 0; w &lt; m_Features.GetCount(); ++w )
        {
            //printf(&quot;.&quot;);
            ++count;
            TCSWeakTraining* wcinfo = (TCSWeakTraining*)m_Features.Get(w);
            wcinfo-&gt;SetEpsilon(0);

            //Train section;
            wcinfo-&gt;StartTraining();
            for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
               TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
               wcinfo-&gt;AddSample(s, s-&gt;GetFlag(), s-&gt;GetWeight(), this-&gt;m_widthBase);
            }
            wcinfo-&gt;Train();

            //Calc error;
            for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
                TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

                double factor = (double)(s-&gt;GetImage()-&gt;sSizeX)/m_widthBase;
                wcinfo-&gt;Scale(factor);

                int res = wcinfo-&gt;Classify( s );

                if ( s-&gt;GetFlag() != res )
                {
                    wcinfo-&gt;SetEpsilon(wcinfo-&gt;GetEpsilon() + s-&gt;GetWeight());
                }
            }

            if ( progress.Update( ) )
                DbgMsg(&quot;&gt;&quot;);
        }

        DbgMsg( &quot;\n&quot; );
        printf( &quot;Count stage: %d \n&quot;, count );
        // выбор лучшего признака, по минимальной ошибке классификации на обучающем наборе.
        int bestWc = 0;
        for ( int w = 0; w &lt; m_Features.GetCount(); ++w )
        {
            TCSWeakTraining* best       = (TCSWeakTraining*)m_Features.Get(bestWc);
            TCSWeakTraining* current    = (TCSWeakTraining*)m_Features.Get(w);
            if ( best-&gt;GetEpsilon() &gt; current-&gt;GetEpsilon()  )
                bestWc = w;
        }
        TCSWeakTraining* pWc       = (TCSWeakTraining*)m_Features.Get(bestWc);
        pWc-&gt;SetWeight( pWc-&gt;GetEpsilon() );

        // если ошибка лучшего классификатора превысила критический уровень 50%
        // прекращаем процесс накачки.
        if ( pWc-&gt;Weight() &gt;= 0.5 ) break;


        //Update wc weight;
        double beta = pWc-&gt;Weight()/ (1 - pWc-&gt;Weight());
        double min_eps = pWc-&gt;Weight();
        pWc-&gt;SetWeight (log(1.0/beta));

        //Добавим &quot;слабый&quot; классификатор в &quot;комитет".
        m_ResultClass.AddWeak(new TCSWeak(pWc));

        // распечатка атрибутов классификатора
        DbgMsg( &quot;\nRound num = &quot; + TypeToStr(i + 1) +
            &quot;, min_eps = &quot; + TypeToStr(min_eps) +
            &quot;, beta = &quot; + TypeToStr( beta ) +
        &quot;, alpha = &quot;+ TypeToStr(pWc-&gt;Weight())+&quot;;\n&quot; );
    // распечатка атрибутов выбранного признака
    if ( pWc-&gt;Fetaure() != NULL )
            PrintFeature(pWc-&gt;Fetaure());

        //распечатка ошибки на тестовом наборе.
        double afrr = 100;
        double FARV = PrintStatistics( m_ResultClass, afrr );
        //DbgMsg(&quot;afrr =&quot; + TypeToStr(afrr) +&quot;\n&quot;);

        // завершаем процесс, если ошибка уменьшилась до порогового значения
        if (FARV &lt; m_FinishFar &amp;&amp; afrr &lt; 0.001)
        {
            //this-&gt;SaveFRRSamples(stage);
            return true;
        }

        // для каждого образца обновим веса
        double wt = 0;
        for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
        {
            TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

            int res = 0;
            double err = 0;
            double factor = (double)(s-&gt;GetImage()-&gt;sSizeX)/m_widthBase;
            pWc-&gt;Scale(factor);
            res = pWc-&gt;Classify( s );


            if ( res == s-&gt;GetFlag() )
                s-&gt;SetWeight(s-&gt;GetWeight()*beta);
            wt += s-&gt;GetWeight();
        }

        //Normalize;
        wt = 1.0/wt;

        for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
        {
            TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
            s-&gt;SetWeight(s-&gt;GetWeight()*wt);
        }

        //Удалим найденный признак из списка признаков
        m_Features.Delete(bestWc);

    }

    //this-&gt;SaveFRRSamples(stage);
    return true;
}

// распечатка сообщения на экране и в лог файле
void TCSAdaBoost::DbgMsg( std::string const&amp; msg)
{
    (*m_pLog) &lt;&lt; msg;
    cout &lt;&lt; msg;
    flush( *m_pLog );
}

std::string TCSAdaBoost::GetArtefactsBase()
{
    return m_strArtefactsBase;
}
void TCSAdaBoost::SetArtefactsBase(std::string str)
{
    m_strArtefactsBase = str;
}
std::string TCSAdaBoost::GetObjectsBase()
{
    return m_strObjectsbase;
}

void TCSAdaBoost::SetObjectsBase(std::string str)
{
    m_strObjectsbase = str;
}

// возвращает ширину и высоту изображений, которые используются
// для обучения
AWPWORD TCSAdaBoost::WidthBase()
{
    return m_widthBase;
}
void TCSAdaBoost::SetWidthBase(AWPWORD value)
{
    m_widthBase = value;
}
AWPWORD TCSAdaBoost::HeightBase()
{
    return m_heightBase;
}
void TCSAdaBoost::SetHeightBase(AWPWORD value)
{
    m_heightBase = value;
}
TErrTrainData&amp; TCSAdaBoost::GetTrainData()
{
    return m_trainData;
}

TCSStrong* TCSAdaBoost::GetClass()
{
    return &amp;m_ResultClass;
}
int TCSAdaBoost::GetFeaturesCount()
{
    return m_nFeaturesCount;
}
void TCSAdaBoost::SetFeaturesCount(int value)
{
    m_nFeaturesCount = value;
}

double TCSAdaBoost::GetFinishFar()
{
    return this-&gt;m_FinishFar;
}
void TCSAdaBoost::SetFinishFar(double value)
{
    this-&gt;m_FinishFar = value;
}

std::string TCSAdaBoost::GetPath()
{
    return this-&gt;m_strPath;
}

void TCSAdaBoost::SetPath(const char* lpPath)
{
    this-&gt;m_strPath = lpPath;
}

static bool _IsImageFile(std::string&amp; strFileName)
{
    std::string strExt = LFGetFileExt(strFileName);
    std::transform(strExt.begin(), strExt.end(), strExt.begin(), ::tolower);

    if (strExt == &quot;.awp&quot;)
        return true;
    if (strExt == &quot;.jpg&quot;)
        return true;
    if (strExt == &quot;.jpeg&quot;)
        return true;
    if (strExt == &quot;.png&quot;)
        return true;
    if (strExt == &quot;.bmp&quot;)
        return true;
    return false;
}

// загружает образцы для обучения из директории path и сохраняет их в списке объектов 
// SampleList. в зависимости от установленного флага flag образцы считаются образцами 
// объектов или образцами фонов. flag = 1 соответствует образцам объектов, flag = 0 - 
// соответствует образцам фонов.
bool TCSAdaBoost::LoadSample(TLFObjectList&amp; SampleList, int flag, std::string const&amp; path)
{
    DbgMsg( &quot;Loading samples from &quot; + path + &quot;... \n&quot; );
    int count = 0;
    TLFStrings names;
    if (!LFGetDirFiles(path.c_str(), names))
    {
        DbgMsg(&quot;Reading names failed.&quot;);
        return false;
    }
    if (names.size() == 0)
    {
        DbgMsg(&quot;Database is empty.&quot;);
        return false;
    }
    DbgMsg(&quot;Reading &quot; + TypeToStr(names.size()) + &quot; files.\n&quot;);
    for (int i = 0; i &lt; names.size(); i++)
    {
        string name = names[i];
        if (!_IsImageFile(name))
            continue;
        TCSSample* pSample = new TCSSample();
        //DbgMsg(name + &quot;\n&quot;);
        pSample-&gt;LoadFromFile((char*)name.c_str());
        double e = 0;
        if (pSample-&gt;GetImage()-&gt;sSizeX &lt; this-&gt;m_widthBase || pSample-&gt;GetImage()-&gt;sSizeY &lt; this-&gt;m_heightBase)
        {
            delete pSample;
            continue;
        }
        awpImage* img = pSample-&gt;GetIntegralImage();
        if (img == NULL)
            continue;
        pSample-&gt;GetSqIntegralImage();
        bool need_process = flag == 1 ? true : false;
        pSample-&gt;SetFlag(flag);
        SampleList.Add(pSample);
        ++count;
    }

    DbgMsg(TypeToStr(count) + &quot; ok\n&quot;);
    return count &gt; 0;

}
//
void TCSAdaBoost::InitFeatures()
{
   
    DbgMsg(&quot;AdaBoost: init features .... &quot;);
    srand(11);
    m_Features.Clear();

   int sx = 1;
   int sy = 1;
   int w = 3;
   int h = 3;
   for (h = m_heightBase; h &gt;= 3; h-=1)
   {
       for (w = m_widthBase; w &gt;= 3; w-=1)
       {
           for (sy = 0; sy &lt;= m_heightBase - h -3; sy++)
           {
               for (sx = 0; sx &lt;= m_widthBase - w -3; sx++)
               {
                   
                   bool skip = false;// (rand() % 10) &gt; 2;
                   if (skip)
                       continue;
                   TCSWeakTraining* wt = NULL;
                   TLFVFeature Sensor0(sx, sy, w/2, h);
                   wt = new TCSWeakTraining(&amp;Sensor0);
                   if (this-&gt;m_VFeature)
                       m_Features.Add(wt);
                   else
                       delete wt;
                   TLFHFeature Sensor1(sx, sy, w, h/2);
                   wt = new TCSWeakTraining(&amp;Sensor1);
                   if (this-&gt;m_HFeature)
                    m_Features.Add(wt);
                   else
                       delete wt;
                   TLFDFeature Sensor2(sx, sy, w / 2, h / 2);
                   wt = new TCSWeakTraining(&amp;Sensor2);
                   if (this-&gt;m_DFeature)
                    m_Features.Add(wt);
                   else
                       delete wt;
                   TLFCFeature Sensor3(sx, sy, w / 3, h / 3);
                   wt = new TCSWeakTraining(&amp;Sensor3);
                   if (this-&gt;m_CFeature)
                    m_Features.Add(wt);
                   else
                       delete wt;
                   TCSSensor Sensor4(sx, sy, w / 3, h / 3);
                   wt = new TCSWeakTraining(&amp;Sensor4);
                   if (this-&gt;m_CSFeature)
                    m_Features.Add(wt);
                   else
                       delete wt;
                   TLFLBPFeature Sensor5(sx, sy, w / 3, h / 3);
                   wt = new TCSWeakTraining(&amp;Sensor5);
                   if (this-&gt;m_LBPFeature)
                    m_Features.Add(wt);
                   else
                       delete wt;

                   TLFVAFeature Sensor6(sx, sy, w / 2, h);
                   wt = new TCSWeakTraining(&amp;Sensor6);
                   if (this-&gt;m_VAFeature)
                       m_Features.Add(wt);
                   else
                       delete wt;
                   TLFHAFeature Sensor7(sx, sy, w, h / 2);
                   wt = new TCSWeakTraining(&amp;Sensor7);
                   if (this-&gt;m_HAFeature)
                       m_Features.Add(wt);
                   else
                       delete wt;
                   TLFDAFeature Sensor8(sx, sy, w / 2, h / 2);
                   wt = new TCSWeakTraining(&amp;Sensor8);
                   if (this-&gt;m_DAFeature)
                       m_Features.Add(wt);
                   else
                       delete wt;
                   TLFCAFeature Sensor9(sx, sy, w / 3, h / 3);
                   wt = new TCSWeakTraining(&amp;Sensor9);
                   if (this-&gt;m_CAFeature)
                       m_Features.Add(wt);
                   else
                       delete wt;
                   //TLFColorSensor9Bit Sensor10(sx,sy,w,h);
                   //wt = new TCSWeakTraining(&amp;Sensor10);
                   //m_Features.Add(wt);
               }
           }
       }
   }
   DbgMsg(&quot; done .\n&quot;);
   DbgMsg( &quot;AdaBoost: Initiated &quot; + TypeToStr( m_Features.GetCount() )+&quot; features.\n&quot; );
}

void TCSAdaBoost::PrintFeature(ILFFeature* pSensor)
{
    DbgMsg( &quot;Found feature:&quot; + TypeToStr(pSensor-&gt;GetName()) + &quot; x = &quot; + TypeToStr( pSensor-&gt;sxBase() ) +
        &quot;, y = &quot; + TypeToStr( pSensor-&gt;syBase() ) +
        &quot;, width = &quot; + TypeToStr( pSensor-&gt;wUnitBase() ) +
        &quot;, height = &quot; + TypeToStr( pSensor-&gt;hUnitBase() ) + &quot;;\n&quot;);
}

double TCSAdaBoost::PrintStatistics(TCSStrong&amp; Class, double&amp; afrr)
{
    double          dFar = 0, dFrr = 0;
    double min_err = 100000;

    for (  int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
    {

        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

        double err = 0;
        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        Class.Setup(r, m_widthBase);

        Class.Classify(s, err );

        if ( s-&gt;GetFlag() == 1 )
        {
            if (err &lt; min_err)
                min_err = err;

            if ( err &lt; Class.GetThreshold() ) dFrr += 1.0;
        }
        else
        {
            if ( err &gt;= Class.GetThreshold() )
            {
                dFar += 1.0;
            }
        }


    }

    dFrr /= m_nTestFaces;
    dFar /= m_nTestNonFaces;

    DbgMsg( &quot;\nFAR = &quot; + TypeToStr( dFar ) +
            &quot;, FRR = &quot; + TypeToStr( dFrr ) +
            &quot;, threshold = &quot; + TypeToStr( Class.GetThreshold() )+ &quot;;\n&quot; );

    //todo:
    afrr = dFrr;
    
    TWclErrInfo err_info;
    err_info.m_far = dFar;
    err_info.m_frr = dFrr;
    err_info.m_thr = Class.GetThreshold();

    m_trainData.push_back(err_info);
    return dFar;

    double ff = 0;
    double dFar1 = 0;
    double dFrr1 = 0;

    for (  int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
    {

        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

        double err = 0;
        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        Class.Setup(r, m_widthBase);


        Class.Classify( s, err );

        if ( s-&gt;GetFlag() == 1 )
        {
            if (err &lt; min_err) dFrr1 += 1.0;
        }
        else
        {

            if ( err &gt;= min_err )
            {
                dFar1 += 1.0;
            }
        }


    }

    dFrr1 /= m_nTestFaces;
    dFar1 /= m_nTestNonFaces;
    afrr = dFrr1;

    DbgMsg( &quot;ro = &quot; + TypeToStr( min_err ) + &quot;\t frr = &quot; + TypeToStr( dFrr1 ) +
        &quot;,\t far = &quot; + TypeToStr( dFar1 ) + &quot;;\n&quot;);

    //TWclErrInfo err_info;
    err_info.m_far = dFar1;
    err_info.m_frr = dFrr1;
    err_info.m_thr = min_err;

    m_trainData.push_back(err_info);

    return dFar1;
}
int SampleCompare(void * Item1, void * Item2)
{
    TCSSample* s1 = (TCSSample*)Item1;
    TCSSample* s2 = (TCSSample*)Item2;
    if (s1-&gt;GetRating() &gt; s2-&gt;GetRating())
        return 1;
    else if (s1-&gt;GetRating() == s2-&gt;GetRating())
        return 0;
    else
        return -1;
}
void   TCSAdaBoost::SaveFRRSamples(int stage)
{
    if (stage &lt; 0)
        return;
    std::string strPath = this-&gt;m_strPath;
    strPath += &quot;\\frr\\&quot;;

    if (!LFDirExist(strPath.c_str()))
        LFCreateDir(strPath.c_str());

    char buf[32];
    sprintf(buf, &quot;stage%d&quot;, stage);
    strPath += buf;
    if (!LFDirExist(strPath.c_str()))
        LFCreateDir(strPath.c_str());

    //forming an array of positive examples for each settable rating received strong classifier
    TLFObjectList positiveSamples;
    for (int i = 0; i &lt; this-&gt;m_TrainingSamples.GetCount(); i++)
    {
        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
        if (s-&gt;GetFlag() == 1)
        {
            double err = 0;
            awpRect r; r.left =0; r.top = 0;
            r.right = s-&gt;GetImage()-&gt;sSizeX;
            r.bottom = s-&gt;GetImage()-&gt;sSizeY;

            this-&gt;m_ResultClass.Setup(r, m_widthBase);
            this-&gt;m_ResultClass.Classify(s, err);
            s-&gt;SetRating(err);
            
            positiveSamples.Add (new TCSSample(s));
        }
    }
    // sort the list
    positiveSamples.Sort(SampleCompare);
    // Save 1% of the list to disk
    std::string strFrrFileName = LFMakeFileName(strPath, &quot;frr&quot;, &quot;.txt&quot;);
    FILE* F = fopen(strFrrFileName.c_str(), &quot;w+t&quot;);
    if (F == NULL)
        return;
    fprintf (F, &quot;stage threshold = %f\n&quot;, this-&gt;m_ResultClass.GetThreshold());
    int numToSave = positiveSamples.GetCount() / 100;
    for (int i = 0; i &lt; numToSave; i++)
    {
        TCSSample* s = (TCSSample*)positiveSamples.Get(i);
        std::string strFileName = LFMakeFileName(strPath, TypeToStr(i), &quot;.jpg&quot;);
        double r = s-&gt;GetRating();
        fprintf (F, &quot;%s\t %f\n&quot;, strFileName.c_str(),  r);
        awpSaveImage(strFileName.c_str(), s-&gt;GetImage());
    }
    fclose(F);
}

void   TCSAdaBoost::SaveNegativeSamples(const char* lpPath)
{
    string path = lpPath;
    int total = 0;
    LFCreateDir(lpPath);
    for (int i = 0; i &lt; this-&gt;m_TrainingSamples.GetCount(); i++)
    {
        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
        if (s-&gt;GetFlag() == 0)
        {
            string filename = path;
            filename += TypeToStr(total);
            filename += &quot;.awp&quot;;
            total++;
            s-&gt;SaveToFile(filename.c_str());
        }
    }
}

////////////////////////////////////////////////////////////////////////////////
TCSAdaBoostSign::TCSAdaBoostSign()
{
    m_widthBase = 24;
    m_heightBase = 24;
    m_maxFeatures = 50;
    m_strBase1 = &quot;&quot;;
    m_strBase2 = &quot;&quot;;
    m_numSamplesBase1  = 0;
    m_numSamplesBase1  = 0;

    m_flog.open(&quot;log.txt&quot;);
}
bool TCSAdaBoostSign::Load(const char* lpConfigName)
{
   if (lpConfigName == NULL)
        return false;

   TiXmlDocument doc(lpConfigName);
   if (!doc.LoadFile())
    return false;

   TiXmlHandle hDoc(&amp;doc);
   TiXmlElement* pElem = NULL;
   pElem = hDoc.FirstChildElement().Element();

   if (!pElem)
      return false;
   const char* name = pElem-&gt;Value();
   if (strcmp(name, &quot;csboostsign&quot;) != 0)
      return false;
   return Load( pElem);
}

bool    TCSAdaBoostSign::Load (TiXmlElement* node)
{
   if (node == NULL)
    return false;
    m_TrainingSamples.Clear();
    m_TestingSamples.Clear();
    TiXmlElement* pElem = NULL;
    pElem = node-&gt;FirstChildElement();
    //Загрузка образцов для обучения
    DbgMsg( &quot;Loading training sets...\n&quot; );
    m_strBase2 = pElem-&gt;Attribute(&quot;database2&quot;);
    if (!LoadSamples( -1, m_strBase2 ))
        return false;
    m_numSamplesBase2 = m_TrainingSamples.GetCount();
    m_numSamplesTestBase2 = m_TestingSamples.GetCount();
    std::string m_strBase1 = pElem-&gt;Attribute(&quot;database1&quot;);
    if (!LoadSamples( 1,  m_strBase1))
        return false;
    m_numSamplesBase1 = (int)m_TrainingSamples.GetCount( ) - m_numSamplesBase2;
    m_numSamplesTestBase1 = (int)m_TestingSamples.GetCount( ) - m_numSamplesTestBase2;

    //
    double v;
    m_widthBase = 24;
    m_heightBase = 24;
    pElem-&gt;Attribute(&quot;w&quot;, &amp;v);
    m_widthBase = (int )v;
    pElem-&gt;Attribute(&quot;h&quot;, &amp;v);
    m_heightBase = (int )v;

    pElem = pElem-&gt;NextSiblingElement();
    double ni = 5;
    pElem-&gt;Attribute(&quot;maxi&quot;, &amp;ni);
    m_maxFeatures = (int)ni;


    DbgMsg( &quot;Samples to training for class 1 &quot; + TypeToStr(m_numSamplesBase1) +&quot;;\n&quot; );
    DbgMsg( &quot;Samples to training for class -1 &quot; + TypeToStr(m_numSamplesBase2) +&quot;;\n&quot; );
    DbgMsg( &quot;Samples to testing for class 1 &quot; + TypeToStr(m_numSamplesTestBase1) +&quot;;\n&quot; );
    DbgMsg( &quot;Samples to testing for class -1 &quot; + TypeToStr(m_numSamplesTestBase2) +&quot;;\n&quot; );

    // инициализация исходного массива признаков
   InitFeatures( );

    return true;
}

void TCSAdaBoostSign::SetLogName(char* lpLogName)
{
}

void TCSAdaBoostSign::SetLog1Name(char* lpLog1Name)
{
}


bool TCSAdaBoostSign::Boost()
{
    // Начало накачки.
    double wf   = 0.5/m_numSamplesBase1;
    double wnf = 0.5 / m_numSamplesBase2;

    DbgMsg(&quot;\nBoosting started.\n&quot;);

    // Установка начальных весов для обучающего набора m_TrainingSet
    for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
    {
        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
        if (s-&gt;GetFlag() == 1)
            s-&gt;SetWeight(wf);
        else if (s-&gt;GetFlag() == -1)
            s-&gt;SetWeight(wnf);
        else
            continue;
    }

    ProgressMeter progress;
    progress.Init( 30, (int)m_TrainingSamples.GetCount( ) );

    m_ResultClass.Clear();
    //m_trainData.clear();

    if ( m_Features.GetCount( ) == 0 ) return false;

    //Main loop;
    for ( int i = 0; i &lt; m_maxFeatures ; ++i )
    {

        DbgMsg( &quot;\nUpdating: &quot; );
        progress.Init( 30, m_Features.GetCount( ) );
        int count = 0;

//Update
#pragma omp parallel for reduction(+: count)
        for ( int w = 0; w &lt; m_Features.GetCount(); ++w )
        {
            ++count;
            TCSWeakSignTrainig* wcinfo = (TCSWeakSignTrainig*)m_Features.Get(w);
            wcinfo-&gt;SetEpsilon(0);

            //Train section;
            wcinfo-&gt;StartTraining();
            for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
               TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
               wcinfo-&gt;AddSample(s, s-&gt;GetFlag(), s-&gt;GetWeight());
            }
            wcinfo-&gt;Train();

            //Calc error;
            for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
                TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

                int res = wcinfo-&gt;Classify( s );

                if ( s-&gt;GetFlag() != res )
                {
                    wcinfo-&gt;SetEpsilon(wcinfo-&gt;GetEpsilon() + s-&gt;GetWeight());
                }
            }

            if ( progress.Update( ) )
                DbgMsg(&quot;&gt;&quot;);
        }

        DbgMsg( &quot;\n&quot; );
        printf( &quot;Count stage: %d \n&quot;, count );
        // выбор лучшего признака, по минимальной ошибке классификации на обучающем наборе.
        int bestWc = 0;
        for ( int w = 0; w &lt; m_Features.GetCount(); ++w )
        {
            TCSWeakSignTrainig* best       = (TCSWeakSignTrainig*)m_Features.Get(bestWc);
            TCSWeakSignTrainig* current    = (TCSWeakSignTrainig*)m_Features.Get(w);
            if ( best-&gt;GetEpsilon() &gt; current-&gt;GetEpsilon()  )
                bestWc = w;
        }
        TCSWeakSignTrainig* pWc       = (TCSWeakSignTrainig*)m_Features.Get(bestWc);
        pWc-&gt;SetWeight((double)pWc-&gt;GetEpsilon());

        // если ошибка лучшего классификатора превысила критический уровень 50%
        // прекращаем процесс накачки.
        if ( pWc-&gt;Weight() &gt; 0.49 ) break;


        //Update wc weight;
        double beta = pWc-&gt;Weight()/ (1 - pWc-&gt;Weight());
        double min_eps = pWc-&gt;Weight();
        pWc-&gt;SetWeight (log(1.0/beta));

        //Добавим &quot;слабый&quot; классификатор в &quot;комитет".
        m_ResultClass.AddWeak(pWc);
        
        // распечатка атрибутов классификатора
        DbgMsg( &quot;\nRound num = &quot; + TypeToStr(i + 1) +
            &quot;, min_eps = &quot; + TypeToStr(min_eps) +
            &quot;, beta = &quot; + TypeToStr( beta ) +
        &quot;, alpha = &quot;+ TypeToStr(pWc-&gt;Weight())+&quot;;\n&quot; );

        this-&gt;Statistics();
        // для каждого образца обновим веса
        double wt = 0;
        for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
        {
            TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

            int res = 0;
            double err = 0;
            res = pWc-&gt;Classify( s );

            if ( res == s-&gt;GetFlag() )
                s-&gt;SetWeight(s-&gt;GetWeight()*beta);
            wt += s-&gt;GetWeight();
        }

        //Normalize;
        wt = 1.0/wt;

        for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
        {
            TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
            s-&gt;SetWeight(s-&gt;GetWeight()*wt);
        }

        //Удалим найденный признак из списка признаков
        m_Features.Delete(bestWc);

    }
    //SaveROC();
    return true;
}
//
TCSStrongSign* TCSAdaBoostSign::GetResult()
{
  return &amp;m_ResultClass;
}

void    TCSAdaBoostSign::InitFeatures()
{
    m_Features.Clear();

   int sx = 1;
   int sy = 1;
   int w = 3;
   int h = 3;
   for (h = m_heightBase -3; h &gt;= 3; h-=3)
   {
       for (w = m_widthBase ; w &gt;= 3; w-=3)
       {
           for (sy = 1; sy &lt; m_heightBase - h - 1; sy++)
           {
               for (sx = 1; sx &lt; m_widthBase - w - 1; sx++)
               {
                   TCSSensor Sensor(sx, sy, w / 3, h / 3);
                   TCSWeakSignTrainig* wt = new TCSWeakSignTrainig(Sensor);
                   m_Features.Add(wt);
               }
           }
       }
   }
}

bool    TCSAdaBoostSign::LoadSamples(int flag, std::string const&amp; path)
{
    DbgMsg( &quot;Loading samples from &quot; + path + &quot;... &quot; );

    int count = 0;
    srand( (unsigned)time( NULL ) );
    int RANGE_MIN = 0;
    int RANGE_MAX = 3;

#ifdef WIN32
    intptr_t handle = 0;
    _finddata_t filesInfo;
    if ( (handle = _findfirst( (char*)((path+&quot;*.jpg&quot;).c_str()), &amp;filesInfo)) != -1 )
    {
        do
        {
           string name = path + filesInfo.name;
        
            TCSSample* pSample = new TCSSample();
            pSample-&gt;LoadFromFile((char*)name.c_str());

    //        if (pSample-&gt;Process())
            {
                pSample-&gt;SetFlag(flag);
                int r = (int)(((double) rand() / (double) RAND_MAX) * RANGE_MAX + RANGE_MIN);

                //int  r = rand(0);
                if (r &gt; 0)
                    m_TrainingSamples.Add(pSample);
                else
                    m_TestingSamples.Add(pSample);

                ++count;
            }
//            else
//printf( &quot;Can&#39;t load image %s.\n&quot;, name.c_str( ) );
        }while(!_findnext( handle, &amp;filesInfo ));


    }
    _findclose( handle );

#else

//    struct dirent** namelist;
//    if(( count = scandir( path.c_str(), &amp;namelist, jpg_filter, alphasort )) &lt; 0 )
//            return 0;

//    for( int i=0; i&lt;count; i++ )
//    {
//            string name = path + namelist[i]-&gt;d_name;

//            TCSSample* pSample = new TCSSample();
//            pSample-&gt;LoadImage((char*)name.c_str());


//                pSample-&gt;SetFlag(flag);
//              int r = (((double) rand() / (double) RAND_MAX) * RANGE_MAX + RANGE_MIN);

//                //int  r = rand(0);
//                if (r &gt; 0)
//                    m_TrainingSamples.Add(pSample);
//                else
//                    m_TestingSamples.Add(pSample);

//    }

#endif

    DbgMsg( TypeToStr( count ) + &quot; ok\n&quot; );
    return count &gt; 0;
}
void    TCSAdaBoostSign::DbgMsg( std::string const&amp; msg)
{
    std::cout&lt;&lt; msg;  
#ifdef WIN32
    m_flog &lt;&lt; msg;
    m_flog.flush();
#endif
}

void    TCSAdaBoostSign::Statistics()
{
    double errt[2] = {0,0};
    double err1[2] = { 0, 0 };
    double err2[2] = { 0, 0 };
    double erru[2] = { 0, 0 };
    for (  int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
    {

        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

        double err = 0;
        //double factor = (double)(s-&gt;GetImage()-&gt;sSizeX)/24.0;
        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        m_ResultClass.Setup(r, m_widthBase);

        int res = m_ResultClass.Classify( s-&gt;GetIntegralImage(), err );
        if (res != s-&gt;GetFlag())
        {
              errt[0]++;
              if (res == 0)
                erru[0]++;
              if (res == 1)
                err2[0]++;
              if (res == -1)
                err1[0]++;
        }
    }
    errt[0] /= m_TrainingSamples.GetCount();
    errt[0] *= 100;

    err1[0] /= (m_numSamplesBase1);
    err1[0] *= 100;

    err2[0] /= (m_numSamplesBase2);
    err2[0] *= 100;

    erru[0] /= m_TrainingSamples.GetCount();
    erru[0] *= 100;
    for (  int i = 0; i &lt; m_TestingSamples.GetCount(); i++ )
    {

        TCSSample* s = (TCSSample*)m_TestingSamples.Get(i);

        double err = 0;
        //double factor = (double)(s-&gt;GetImage()-&gt;sSizeX)/24.0;
        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        m_ResultClass.Setup(r, m_widthBase);

        int res = m_ResultClass.Classify( s-&gt;GetIntegralImage(), err );
        if (res != s-&gt;GetFlag())
        {
              errt[1]++;
              if (res == 0)
                erru[1]++;
              if (res == 1)
                err2[1]++;
              if (res == -1)
                err1[1]++;
        }
    }
    if (m_TestingSamples.GetCount() &gt; 0)
    {
    errt[1] /= m_TestingSamples.GetCount();
    errt[1] *= 100;

    err1[1] /= (m_numSamplesTestBase1);
    err1[1] *= 100;
    err2[1] /= (m_numSamplesTestBase2);
    err2[1] *= 100;


    erru[1] /= m_TestingSamples.GetCount();
    erru[1] *= 100;
    }

    DbgMsg( &quot;errt = &quot; + TypeToStr( errt[0] ) + &quot; % &quot; + TypeToStr( errt[1] ) + &quot;%;\n&quot; );
    DbgMsg( &quot;err1 = &quot; + TypeToStr( err1[0] ) + &quot; % &quot; + TypeToStr( err1[1] ) + &quot;%;\n&quot; );
    DbgMsg( &quot;err2 = &quot; + TypeToStr( err2[0] ) + &quot; % &quot; + TypeToStr( err2[1] ) + &quot;%;\n&quot;  );
    DbgMsg( &quot;erru = &quot; + TypeToStr( erru[0] ) + &quot; % &quot; + TypeToStr( erru[1] ) + &quot;%;\n&quot; );
}


struct roc_entry
{
    double far1;
    double frr1;
    double far2;
    double frr2;
};
void TCSAdaBoostSign::SaveROC(char*lpName)
{
 //
    double* fSourceClass1 = NULL;
    double* fSourceClass2 = NULL;
    roc_entry roc[100];
    memset(roc,0, sizeof(roc));
    fSourceClass1 = (double*)malloc(m_numSamplesTestBase1*sizeof(double));
    fSourceClass2 = (double*)malloc(m_numSamplesTestBase2*sizeof(double));
    memset(fSourceClass1, 0, m_numSamplesTestBase1*sizeof(double));
    memset(fSourceClass2, 0, m_numSamplesTestBase2*sizeof(double));
    int nc1 =0;
    int nc2 =0;

    for (int i = 0; i &lt; m_TestingSamples.GetCount(); i++)
    {
        TCSSample* s = (TCSSample*)m_TestingSamples.Get(i);

        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        m_ResultClass.Setup(r, m_widthBase);
        double err = 0;
        m_ResultClass.Classify( s-&gt;GetIntegralImage(), err );
        if (s-&gt;GetFlag() == 1)
        {
            fSourceClass1[nc1] = err;
            nc1++;
        }
        else
        {
            fSourceClass2[nc2] = err;
            nc2++;
        }
    }

    double tau = m_ResultClass.GetSumWeakWeight();

    DbgMsg( TypeToStr( tau ) + &quot;\n&quot; );

    double delta = tau / 50.f;
    double stau = -tau;
    int c = 0;
    while(stau &lt; tau)
    {
        for (int i=0; i&lt; nc1; i++)
        {
            if (fSourceClass1[i] &lt; stau)
                roc[c].frr1++;
            if (fSourceClass1[i] &lt; stau)
                roc[c].far2++;
        }
        for (int i=0; i&lt; nc2; i++)
        {
            if (fSourceClass2[i] &gt; stau)
                roc[c].far1++;
            if (fSourceClass2[i] &gt; stau)
                roc[c].frr2++;
        }

        stau += delta;
        c++;
    }
    DbgMsg( TypeToStr( c ) + &quot;\n&quot; );
    for (int i = 0; i &lt; 100; i++)
    {
        roc[i].far1 = 100.f*roc[i].far1/nc2;
        roc[i].frr1 = 100.f*roc[i].frr1/nc1;
        roc[i].far2 = 100.f*roc[i].far2/nc1;
        roc[i].frr2 = 100.f*roc[i].frr2/nc2;
    }
//  std::ostream*       f;
//  f = new ofstream(&quot;roc.txt&quot;);
//  for (int i = 0; i &lt; 100; i++)
//      (*f) &lt;&lt; roc[i].far1 &lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr1&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].far2&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr2 &lt;&lt;&quot;\n&quot;;
//  delete f;
    FILE* f = fopen (lpName, &quot;w+t&quot;);
    for (int i = 0; i &lt; 100; i++)
    {
//      fprintf(f, &quot;%f\n&quot;, roc[i].far1);
        fprintf(f, &quot;%f\t%f\t%f\t%f\n&quot;, roc[i].far1, roc[i].frr1, roc[i].far2,roc[i].frr2);
    }
    //  (*f) &lt;&lt; roc[i].far1 &lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr1&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].far2&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr2 &lt;&lt;&quot;\n&quot;;
    fclose(f);
    free(fSourceClass1);
    free(fSourceClass2);
}

TIEFSAdaBoost::TIEFSAdaBoost()
{
    m_numIFS = 0;
    m_numEFS = 0;
    m_strSourceFile = &quot;&quot;;
    m_pLog = NULL;
}

bool TIEFSAdaBoost::Load(const char* lpFileName)
{
    /*попытка открыть файл конфигурации*/
    TiXmlDocument doc(lpFileName);
    if (!doc.LoadFile())
        return false;
    TiXmlElement* e = doc.FirstChildElement(&quot;IEFSBoost&quot;);
    if (e == NULL)
        return false;
    m_strSourceFile = e-&gt;Attribute(&quot;file&quot;);
    string str = e-&gt;Attribute(&quot;log&quot;);

    if (m_pLog == NULL)
        m_pLog = new ofstream(str.c_str());

    return LoadSamples();
}
// распечатка сообщения на экране и в лог файле
void TIEFSAdaBoost::DbgMsg(std::string const&amp; msg)
{
    (*m_pLog) &lt;&lt; msg;
    cout &lt;&lt; msg;
    flush(*m_pLog);
}

bool TIEFSAdaBoost::Boost()
{
    // Начало накачки.
    double wf  = 0.5 / this-&gt;m_numIFS;
    double wnf = 0.5 / this-&gt;m_numEFS;

    DbgMsg(&quot;\nBoosting started.\n&quot;);

    // Установка начальных весов для обучающего набора m_TrainingSet
    for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
    {
        TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
        if (s-&gt;GetFlag() == 1)
            s-&gt;SetWeight(wf);
        else if (s-&gt;GetFlag() == 0)
            s-&gt;SetWeight(wnf);
        else
            continue;
    }

    ProgressMeter progress;
    progress.Init(30, (int)m_TrainingSamples.GetCount());
    // result class 
    m_ResultClass.Clear();

    if (m_Features.GetCount() == 0)
        return false;

    //Main loop;
    //for (int i = 0; i &lt; this-&gt;m_Features.GetCount(); ++i)
    int i = 0;
    while (this-&gt;m_Features.GetCount() &gt; 0)
    {
        i++;
        DbgMsg(&quot;\nUpdating: &quot;);
        progress.Init(30, m_Features.GetCount());
        int count = 0;

        //Update
#pragma omp parallel for reduction(+: count)
        for (int w = 1; w &lt; m_Features.GetCount(); ++w)
        {
            ++count;
            TIEFSWeak2* wcinfo = (TIEFSWeak2*)m_Features.Get(w);
            if (!wcinfo-&gt;IsFree())
                continue;
            wcinfo-&gt;SetEpsilon(0);

            //Train section;
            wcinfo-&gt;StartTraining();
            for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
                TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
                wcinfo-&gt;AddSample(s);
            }
            wcinfo-&gt;Train();

            //Calc error;
            for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
                TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);

                int res = wcinfo-&gt;Classify(s-&gt;GetValue(w));

                if (s-&gt;GetFlag() != res)
                {
                    wcinfo-&gt;SetEpsilon(wcinfo-&gt;GetEpsilon() + s-&gt;GetWeight());
                }
            }

            if (progress.Update())
                DbgMsg(&quot;&gt;&quot;);
        }

        DbgMsg(&quot;\n&quot;);
        DbgMsg(&quot;Count stage: %d \n&quot; + TypeToStr(count));
        // выбор лучшего признака, по минимальной ошибке классификации на обучающем наборе.
        int bestWc = 1;
        while (!((TIEFSWeak2*)m_Features.Get(bestWc))-&gt;IsFree())
            bestWc++;
        for (int w = bestWc +1; w &lt; m_Features.GetCount(); ++w)
        {
            
            TIEFSWeak2* best = (TIEFSWeak2*)m_Features.Get(bestWc);
            TIEFSWeak2* current = (TIEFSWeak2*)m_Features.Get(w);
            if (!current-&gt;IsFree())
                continue;
            if (best-&gt;GetEpsilon() &gt; current-&gt;GetEpsilon())
                bestWc = w;
        }
        TIEFSWeak* pWc = (TIEFSWeak*)m_Features.Get(bestWc);
        pWc-&gt;SetWeight(pWc-&gt;GetEpsilon());

        // если ошибка лучшего классификатора превысила критический уровень 50%
        // прекращаем процесс накачки.
        if (pWc-&gt;GetWeight() &gt;= 0.5)
        {
        
            DbgMsg(&quot;\n Min eps = 0.5. Break.\n&quot;);
            break;
        }


        //Update wc weight;
        double beta = pWc-&gt;GetWeight() / (1 - pWc-&gt;GetWeight());
        double min_eps = pWc-&gt;GetWeight();
        pWc-&gt;SetWeight(log(1.0 / beta)); 

        //Добавим &quot;слабый&quot; классификатор в &quot;комитет".
        //result class  
        m_ResultClass.Add(pWc-&gt;Clone());
        m_ResultClass.SetThreshold(m_ResultClass.GetSumWeakWeight() / 2);
        pWc-&gt;Lock();
        // распечатка атрибутов классификатора
        DbgMsg(&quot;\nRound num = &quot; + TypeToStr(i + 1) +
            &quot;, min_eps = &quot; + TypeToStr(min_eps) +
            &quot;, beta = &quot; + TypeToStr(beta) +
            &quot;, alpha = &quot; + TypeToStr(pWc-&gt;GetWeight()) + &quot;;\n&quot;);
        // распечатка атрибутов выбранного признака
        DbgMsg(&quot;Feature num = &quot; + TypeToStr(pWc-&gt;GetIndex()) + &quot;\n&quot; );

        //распечатка ошибки на тестовом наборе.
        PrintStatistics();


        // для каждого образца обновим веса
        double wt = 0;
        for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
        {
            TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);

            int res = 0;

            res = pWc-&gt;Classify(s-&gt;GetValue(pWc-&gt;GetIndex()));

            if (res == s-&gt;GetFlag())
            {
                s-&gt;SetWeight(s-&gt;GetWeight()*beta);
            }
            wt += s-&gt;GetWeight();
        }

        //Normalize;
        wt = 1.0 / wt;
        double sum = 0;
        for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
        {
            TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
            s-&gt;SetWeight(s-&gt;GetWeight()*wt);
            sum += s-&gt;GetWeight();
        }
        DbgMsg(&quot;sum  = &quot; + TypeToStr(sum) + &quot;\n&quot;);
        //Удалим найденный признак из списка признаков
      //m_Features.Delete(bestWc);

    }

    this-&gt;m_ResultClass.SaveXML(&quot;IEFSclass.xml&quot;);
    if (this-&gt;m_ResultClass.LoadXML(&quot;IEFSclass.xml&quot;))
    {
        DbgMsg(&quot;Work done.\n\n&quot;);
        this-&gt;PrintStatistics();
        DbgMsg(&quot;Bye!\n&quot;);
        return true;
    }
    else
        return false;
}
double  TIEFSAdaBoost::PrintStatistics()
{
    double          dFar = 0, dFrr = 0;

    for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
    {
        TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
        double err = m_ResultClass.Raiting(s);
        if (s-&gt;GetFlag() == 1)
        {
            if (err &lt; m_ResultClass.GetThreshold()) dFrr += 1.0;
        }
        else
        {
            if (err &gt;= m_ResultClass.GetThreshold())
            {
                dFar += 1.0;
            }
        }
    }

    dFrr /= this-&gt;m_numIFS;
    dFar /= this-&gt;m_numEFS;

    DbgMsg(&quot;\nFAR = &quot; + TypeToStr(dFar) +
        &quot;, FRR = &quot; + TypeToStr(dFrr) +
        &quot;, threshold = &quot; + TypeToStr(m_ResultClass.GetThreshold()) + &quot;;\n&quot;);

    return 0;
}

bool TIEFSAdaBoost::InitFeatures(int num)
{
    if (num &lt;= 0)
    {
        DbgMsg(&quot;Invalid num features: num = &quot; +TypeToStr (num) + &quot;\n&quot;);
        return false;
    }
    for (int i = 0; i &lt; num; i++)
    {
        TIEFSWeak2* w = new TIEFSWeak2(i);
        this-&gt;m_Features.Add(w);
    }
    DbgMsg(TypeToStr(num) + &quot;features created.\n&quot;);
    return true;
}
bool TIEFSAdaBoost::LoadSamples()
{
    DbgMsg(&quot;Loading samples...\n&quot;);
    awpImage* img = NULL;
    if (awpLoadImage(this-&gt;m_strSourceFile.c_str(), &amp;img) != AWP_OK)
    {
        DbgMsg(&quot;Cannot load featues from &quot; + m_strSourceFile + &quot;\n&quot;);
        return false;
    }
    int num = img-&gt;sSizeX - 1;
    double* diff = (double*)malloc(num*sizeof(double));
    if (!this-&gt;InitFeatures(num))
    {
        awpReleaseImage(&amp;img);
        free(diff);
        return false;
    }
    double* d = (double*)img-&gt;pPixels;
    int ifs_count = 0;
    int efs_count = 0;
    for (int i = 0; i &lt; img-&gt;sSizeY; i++)
    {
        int id1 = (int)d[i*img-&gt;sSizeX];
        for (int j = i + 1; j &lt; img-&gt;sSizeY; j++)
        {
            int id2 = (int)d[j*img-&gt;sSizeX];
            int flag = id1 == id2 ? 1 : 0;
            if (!flag &amp;&amp; efs_count &gt; 730000)
                continue;
            if (flag)
                ifs_count++;
            else
                efs_count++;

            for (int k = 1; k &lt;= num; k++)
            {
                diff[k-1] = fabs(d[i*img-&gt;sSizeX + k] - d[j*img-&gt;sSizeX + k]);
            }
            TIEFSSample* s = new TIEFSSample(diff, num, flag);
            this-&gt;m_TrainingSamples.Add(s);
        }
    }
    this-&gt;m_numIFS = ifs_count;
    this-&gt;m_numEFS = efs_count;

    awpReleaseImage(&amp;img);
    free(diff);
    DbgMsg(&quot;IFS samples loaded = &quot; + TypeToStr(m_numIFS) + &quot;\n&quot;);
    DbgMsg(&quot;EFS samples loaded = &quot; + TypeToStr(m_numEFS) + &quot;\n&quot;);
    return true;
}
</span> </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    InitFeatures( );</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160; </div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;}</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160; </div>
<div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#add4d5899fa63cf7523214ab3cb681771">  121</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_t_c_s_ada_boost.html#ac500ed623c8cc7661a59afdeabf1c754">TCSAdaBoost::Load</a>  (<span class="keyword">const</span> <span class="keywordtype">char</span>* lpFileName)</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;{</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;   TiXmlDocument doc(lpFileName);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;   <span class="keywordflow">if</span> (!doc.LoadFile())</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;   TiXmlHandle hDoc(&amp;doc);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;   TiXmlElement* pElem = NULL;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;   pElem = hDoc.FirstChildElement().Element();</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;   <span class="keywordflow">if</span> (!pElem)</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span>* name = pElem-&gt;Value();</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;   <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;csboost&quot;</span>) != 0)</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;   <span class="keywordflow">return</span> Load( pElem, 0);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;}</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160; </div>
<div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#a20ff9fb59b04b96039699aea4a92e3fa">  137</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_t_c_s_ada_boost.html#a20ff9fb59b04b96039699aea4a92e3fa">TCSAdaBoost::Boost</a>(<span class="keywordtype">int</span> stage)</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;{</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">// Начало накачки.</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordtype">double</span> wf   = 0.5/m_nFaces;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordtype">double</span> wnf  = 0.5/m_nNonFaces;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    DbgMsg(<span class="stringliteral">&quot;\nBoosting started.\n&quot;</span>);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="comment">// Установка начальных весов для обучающего набора m_TrainingSet</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; m_TrainingSamples.GetCount(); i++)</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    {</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <a class="code" href="class_t_c_s_sample.html">TCSSample</a>* s = (<a class="code" href="class_t_c_s_sample.html">TCSSample</a>*)m_TrainingSamples.Get(i);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="keywordflow">if</span> (s-&gt;<a class="code" href="class_t_c_s_sample.html#a54a7b60e35ab30d59b750f7eb31ddfb4">GetFlag</a>() == 1)</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            s-&gt;<a class="code" href="class_t_c_s_sample.html#aac3b6bc5757dfeaf4c0bff242932f4d8">SetWeight</a>(wf);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s-&gt;<a class="code" href="class_t_c_s_sample.html#a54a7b60e35ab30d59b750f7eb31ddfb4">GetFlag</a>() == 0)</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            s-&gt;<a class="code" href="class_t_c_s_sample.html#aac3b6bc5757dfeaf4c0bff242932f4d8">SetWeight</a>(wnf);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160; </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <a class="code" href="class_progress_meter.html">ProgressMeter</a> progress;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    progress.<a class="code" href="class_progress_meter.html#a135acb682c55a6aed758d164aab5a0e7">Init</a>( 30, (<span class="keywordtype">int</span>)m_TrainingSamples.GetCount( ) );</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    m_ResultClass.Clear();</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    m_trainData.clear();</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160; </div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keywordflow">if</span> (m_Features.GetCount() == 0)</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        DbgMsg(<span class="stringliteral">&quot;Error: features set is empty.\n&quot;</span>);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    }</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160; </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment">//Main loop;</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; m_nFeaturesCount ; ++i )</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        DbgMsg( <span class="stringliteral">&quot;\nUpdating: &quot;</span> );</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        progress.<a class="code" href="class_progress_meter.html#a135acb682c55a6aed758d164aab5a0e7">Init</a>( 30, m_Features.GetCount( ) );</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="keywordtype">int</span> count = 0;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160; </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">//Update</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="preprocessor">#ifdef _OMP_</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;omp_set_num_threads(8);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="preprocessor">#pragma omp parallel for reduction(+: count)</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="preprocessor">#endif </span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> w = 0; w &lt; m_Features.GetCount(); ++w )</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            <span class="comment">//printf(&quot;.&quot;);</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            ++count;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            <a class="code" href="class_t_c_s_weak_training.html">TCSWeakTraining</a>* wcinfo = (<a class="code" href="class_t_c_s_weak_training.html">TCSWeakTraining</a>*)m_Features.Get(w);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            wcinfo-&gt;<a class="code" href="class_t_c_s_weak_training.html#afa782ffb7650d4ace9be2ed9de346d5f">SetEpsilon</a>(0);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160; </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            <span class="comment">//Train section;</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            wcinfo-&gt;<a class="code" href="class_t_c_s_weak_training.html#a51719fa17b282b074995c3edb10fc064">StartTraining</a>();</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; m_TrainingSamples.GetCount(); i++)</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            {</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;               <a class="code" href="class_t_c_s_sample.html">TCSSample</a>* s = (<a class="code" href="class_t_c_s_sample.html">TCSSample</a>*)m_TrainingSamples.Get(i);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;               wcinfo-&gt;<a class="code" href="class_t_c_s_weak_training.html#aaff42488f164ce6826118f121f0ef183">AddSample</a>(s, s-&gt;<a class="code" href="class_t_c_s_sample.html#a54a7b60e35ab30d59b750f7eb31ddfb4">GetFlag</a>(), s-&gt;<a class="code" href="class_t_c_s_sample.html#a8df9cbf13871bff310a0cb94e8e37ebe">GetWeight</a>(), this-&gt;m_widthBase);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            }</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            wcinfo-&gt;<a class="code" href="class_t_c_s_weak_training.html#ab6cf6f6b550d24e3503a413e3124bac4">Train</a>();</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            <span class="comment">//Calc error;</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; m_TrainingSamples.GetCount(); i++)</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            {</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                <a class="code" href="class_t_c_s_sample.html">TCSSample</a>* s = (<a class="code" href="class_t_c_s_sample.html">TCSSample</a>*)m_TrainingSamples.Get(i);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160; </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                <span class="keywordtype">double</span> factor = (double)(s-&gt;<a class="code" href="class_t_l_f_image.html#a5a44ea86ac3f94f530665d047f95cc69">GetImage</a>()-&gt;sSizeX)/m_widthBase;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                wcinfo-&gt;<a class="code" href="class_t_c_s_weak.html#a02d5c744e71bfc6e3f4aaa211d9afb37">Scale</a>(factor);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                <span class="keywordtype">int</span> res = wcinfo-&gt;<a class="code" href="class_t_c_s_weak.html#aa957a2444fad37c0e35c95c858ed9565">Classify</a>( s );</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                <span class="keywordflow">if</span> ( s-&gt;<a class="code" href="class_t_c_s_sample.html#a54a7b60e35ab30d59b750f7eb31ddfb4">GetFlag</a>() != res )</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                    wcinfo-&gt;<a class="code" href="class_t_c_s_weak_training.html#afa782ffb7650d4ace9be2ed9de346d5f">SetEpsilon</a>(wcinfo-&gt;<a class="code" href="class_t_c_s_weak_training.html#a937a3f22607056153e70249cb0afd743">GetEpsilon</a>() + s-&gt;<a class="code" href="class_t_c_s_sample.html#a8df9cbf13871bff310a0cb94e8e37ebe">GetWeight</a>());</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            }</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            <span class="keywordflow">if</span> ( progress.<a class="code" href="class_progress_meter.html#ac3902e5affdd16dcec5042d24e8c3512">Update</a>( ) )</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                DbgMsg(<span class="stringliteral">&quot;&gt;&quot;</span>);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        DbgMsg( <span class="stringliteral">&quot;\n&quot;</span> );</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        printf( <span class="stringliteral">&quot;Count stage: %d \n&quot;</span>, count );</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="comment">// выбор лучшего признака, по минимальной ошибке классификации на обучающем наборе.</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <span class="keywordtype">int</span> bestWc = 0;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> w = 0; w &lt; m_Features.GetCount(); ++w )</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            <a class="code" href="class_t_c_s_weak_training.html">TCSWeakTraining</a>* best       = (<a class="code" href="class_t_c_s_weak_training.html">TCSWeakTraining</a>*)m_Features.Get(bestWc);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <a class="code" href="class_t_c_s_weak_training.html">TCSWeakTraining</a>* current    = (<a class="code" href="class_t_c_s_weak_training.html">TCSWeakTraining</a>*)m_Features.Get(w);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="keywordflow">if</span> ( best-&gt;<a class="code" href="class_t_c_s_weak_training.html#a937a3f22607056153e70249cb0afd743">GetEpsilon</a>() &gt; current-&gt;<a class="code" href="class_t_c_s_weak_training.html#a937a3f22607056153e70249cb0afd743">GetEpsilon</a>()  )</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                bestWc = w;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        }</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <a class="code" href="class_t_c_s_weak_training.html">TCSWeakTraining</a>* pWc       = (<a class="code" href="class_t_c_s_weak_training.html">TCSWeakTraining</a>*)m_Features.Get(bestWc);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        pWc-&gt;<a class="code" href="class_i_l_f_weak.html#a02d5241b95e5fe950c7703c22e31fa26">SetWeight</a>( pWc-&gt;<a class="code" href="class_t_c_s_weak_training.html#a937a3f22607056153e70249cb0afd743">GetEpsilon</a>() );</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160; </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="comment">// если ошибка лучшего классификатора превысила критический уровень 50%</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="comment">// прекращаем процесс накачки.</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keywordflow">if</span> ( pWc-&gt;<a class="code" href="class_i_l_f_weak.html#ac4b6b8d3a7fec9566ffc92f69631768c">Weight</a>() &gt;= 0.5 ) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160; </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <span class="comment">//Update wc weight;</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="keywordtype">double</span> beta = pWc-&gt;<a class="code" href="class_i_l_f_weak.html#ac4b6b8d3a7fec9566ffc92f69631768c">Weight</a>()/ (1 - pWc-&gt;<a class="code" href="class_i_l_f_weak.html#ac4b6b8d3a7fec9566ffc92f69631768c">Weight</a>());</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="keywordtype">double</span> min_eps = pWc-&gt;<a class="code" href="class_i_l_f_weak.html#ac4b6b8d3a7fec9566ffc92f69631768c">Weight</a>();</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        pWc-&gt;<a class="code" href="class_i_l_f_weak.html#a02d5241b95e5fe950c7703c22e31fa26">SetWeight</a> (log(1.0/beta));</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160; </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="comment">//Добавим &quot;слабый&quot; классификатор в &quot;комитет".</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        m_ResultClass.AddWeak(<span class="keyword">new</span> <a class="code" href="class_t_c_s_weak.html">TCSWeak</a>(pWc));</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="comment">// распечатка атрибутов классификатора</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        DbgMsg( <span class="stringliteral">&quot;\nRound num = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(i + 1) +</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            <span class="stringliteral">&quot;, min_eps = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(min_eps) +</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            <span class="stringliteral">&quot;, beta = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>( beta ) +</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="stringliteral">&quot;, alpha = &quot;</span>+ <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(pWc-&gt;<a class="code" href="class_i_l_f_weak.html#ac4b6b8d3a7fec9566ffc92f69631768c">Weight</a>())+<span class="stringliteral">&quot;;\n&quot;</span> );</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="comment">// распечатка атрибутов выбранного признака</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keywordflow">if</span> ( pWc-&gt;<a class="code" href="class_i_l_f_weak.html#a5d93bb48c8aee520695bda7af663b706">Fetaure</a>() != NULL )</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            PrintFeature(pWc-&gt;<a class="code" href="class_i_l_f_weak.html#a5d93bb48c8aee520695bda7af663b706">Fetaure</a>());</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160; </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="comment">//распечатка ошибки на тестовом наборе.</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="keywordtype">double</span> afrr = 100;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <span class="keywordtype">double</span> FARV = PrintStatistics( m_ResultClass, afrr );</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="comment">//DbgMsg(&quot;afrr =&quot; + TypeToStr(afrr) +&quot;\n&quot;);</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="comment">// завершаем процесс, если ошибка уменьшилась до порогового значения</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="keywordflow">if</span> (FARV &lt; m_FinishFar &amp;&amp; afrr &lt; 0.001)</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        {</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;            <span class="comment">//this-&gt;SaveFRRSamples(stage);</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        }</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160; </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="comment">// для каждого образца обновим веса</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <span class="keywordtype">double</span> wt = 0;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            <a class="code" href="class_t_c_s_sample.html">TCSSample</a>* s = (<a class="code" href="class_t_c_s_sample.html">TCSSample</a>*)m_TrainingSamples.Get(i);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160; </div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            <span class="keywordtype">int</span> res = 0;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            <span class="keywordtype">double</span> err = 0;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            <span class="keywordtype">double</span> factor = (double)(s-&gt;<a class="code" href="class_t_l_f_image.html#a5a44ea86ac3f94f530665d047f95cc69">GetImage</a>()-&gt;sSizeX)/m_widthBase;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            pWc-&gt;<a class="code" href="class_t_c_s_weak.html#a02d5c744e71bfc6e3f4aaa211d9afb37">Scale</a>(factor);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            res = pWc-&gt;<a class="code" href="class_t_c_s_weak.html#aa957a2444fad37c0e35c95c858ed9565">Classify</a>( s );</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160; </div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160; </div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            <span class="keywordflow">if</span> ( res == s-&gt;<a class="code" href="class_t_c_s_sample.html#a54a7b60e35ab30d59b750f7eb31ddfb4">GetFlag</a>() )</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                s-&gt;<a class="code" href="class_t_c_s_sample.html#aac3b6bc5757dfeaf4c0bff242932f4d8">SetWeight</a>(s-&gt;<a class="code" href="class_t_c_s_sample.html#a8df9cbf13871bff310a0cb94e8e37ebe">GetWeight</a>()*beta);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            wt += s-&gt;<a class="code" href="class_t_c_s_sample.html#a8df9cbf13871bff310a0cb94e8e37ebe">GetWeight</a>();</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        }</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160; </div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <span class="comment">//Normalize;</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        wt = 1.0/wt;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        {</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            <a class="code" href="class_t_c_s_sample.html">TCSSample</a>* s = (<a class="code" href="class_t_c_s_sample.html">TCSSample</a>*)m_TrainingSamples.Get(i);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            s-&gt;<a class="code" href="class_t_c_s_sample.html#aac3b6bc5757dfeaf4c0bff242932f4d8">SetWeight</a>(s-&gt;<a class="code" href="class_t_c_s_sample.html#a8df9cbf13871bff310a0cb94e8e37ebe">GetWeight</a>()*wt);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        }</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        <span class="comment">//Удалим найденный признак из списка признаков         m_Features.Delete(bestWc);

    }

    //this-&gt;SaveFRRSamples(stage);
    return true;
}

// распечатка сообщения на экране и в лог файле
void TCSAdaBoost::DbgMsg( std::string const&amp; msg)
{
    (*m_pLog) &lt;&lt; msg;
    cout &lt;&lt; msg;
    flush( *m_pLog );
}

std::string TCSAdaBoost::GetArtefactsBase()
{
    return m_strArtefactsBase;
}
void TCSAdaBoost::SetArtefactsBase(std::string str)
{
    m_strArtefactsBase = str;
}
std::string TCSAdaBoost::GetObjectsBase()
{
    return m_strObjectsbase;
}

void TCSAdaBoost::SetObjectsBase(std::string str)
{
    m_strObjectsbase = str;
}

// возвращает ширину и высоту изображений, которые используются
// для обучения
AWPWORD TCSAdaBoost::WidthBase()
{
    return m_widthBase;
}
void TCSAdaBoost::SetWidthBase(AWPWORD value)
{
    m_widthBase = value;
}
AWPWORD TCSAdaBoost::HeightBase()
{
    return m_heightBase;
}
void TCSAdaBoost::SetHeightBase(AWPWORD value)
{
    m_heightBase = value;
}
TErrTrainData&amp; TCSAdaBoost::GetTrainData()
{
    return m_trainData;
}

TCSStrong* TCSAdaBoost::GetClass()
{
    return &amp;m_ResultClass;
}
int TCSAdaBoost::GetFeaturesCount()
{
    return m_nFeaturesCount;
}
void TCSAdaBoost::SetFeaturesCount(int value)
{
    m_nFeaturesCount = value;
}

double TCSAdaBoost::GetFinishFar()
{
    return this-&gt;m_FinishFar;
}
void TCSAdaBoost::SetFinishFar(double value)
{
    this-&gt;m_FinishFar = value;
}

std::string TCSAdaBoost::GetPath()
{
    return this-&gt;m_strPath;
}

void TCSAdaBoost::SetPath(const char* lpPath)
{
    this-&gt;m_strPath = lpPath;
}

static bool _IsImageFile(std::string&amp; strFileName)
{
    std::string strExt = LFGetFileExt(strFileName);
    std::transform(strExt.begin(), strExt.end(), strExt.begin(), ::tolower);

    if (strExt == &quot;.awp&quot;)
        return true;
    if (strExt == &quot;.jpg&quot;)
        return true;
    if (strExt == &quot;.jpeg&quot;)
        return true;
    if (strExt == &quot;.png&quot;)
        return true;
    if (strExt == &quot;.bmp&quot;)
        return true;
    return false;
}

// загружает образцы для обучения из директории path и сохраняет их в списке объектов 
// SampleList. в зависимости от установленного флага flag образцы считаются образцами 
// объектов или образцами фонов. flag = 1 соответствует образцам объектов, flag = 0 - 
// соответствует образцам фонов.
bool TCSAdaBoost::LoadSample(TLFObjectList&amp; SampleList, int flag, std::string const&amp; path)
{
    DbgMsg( &quot;Loading samples from &quot; + path + &quot;... \n&quot; );
    int count = 0;
    TLFStrings names;
    if (!LFGetDirFiles(path.c_str(), names))
    {
        DbgMsg(&quot;Reading names failed.&quot;);
        return false;
    }
    if (names.size() == 0)
    {
        DbgMsg(&quot;Database is empty.&quot;);
        return false;
    }
    DbgMsg(&quot;Reading &quot; + TypeToStr(names.size()) + &quot; files.\n&quot;);
    for (int i = 0; i &lt; names.size(); i++)
    {
        string name = names[i];
        if (!_IsImageFile(name))
            continue;
        TCSSample* pSample = new TCSSample();
        //DbgMsg(name + &quot;\n&quot;);
        pSample-&gt;LoadFromFile((char*)name.c_str());
        double e = 0;
        if (pSample-&gt;GetImage()-&gt;sSizeX &lt; this-&gt;m_widthBase || pSample-&gt;GetImage()-&gt;sSizeY &lt; this-&gt;m_heightBase)
        {
            delete pSample;
            continue;
        }
        awpImage* img = pSample-&gt;GetIntegralImage();
        if (img == NULL)
            continue;
        pSample-&gt;GetSqIntegralImage();
        bool need_process = flag == 1 ? true : false;
        pSample-&gt;SetFlag(flag);
        SampleList.Add(pSample);
        ++count;
    }

    DbgMsg(TypeToStr(count) + &quot; ok\n&quot;);
    return count &gt; 0;

}
//
void TCSAdaBoost::InitFeatures()
{
   
    DbgMsg(&quot;AdaBoost: init features .... &quot;);
    srand(11);
    m_Features.Clear();

   int sx = 1;
   int sy = 1;
   int w = 3;
   int h = 3;
   for (h = m_heightBase; h &gt;= 3; h-=1)
   {
       for (w = m_widthBase; w &gt;= 3; w-=1)
       {
           for (sy = 0; sy &lt;= m_heightBase - h -3; sy++)
           {
               for (sx = 0; sx &lt;= m_widthBase - w -3; sx++)
               {
                   
                   bool skip = false;// (rand() % 10) &gt; 2;
                   if (skip)
                       continue;
                   TCSWeakTraining* wt = NULL;
                   TLFVFeature Sensor0(sx, sy, w/2, h);
                   wt = new TCSWeakTraining(&amp;Sensor0);
                   if (this-&gt;m_VFeature)
                       m_Features.Add(wt);
                   else
                       delete wt;
                   TLFHFeature Sensor1(sx, sy, w, h/2);
                   wt = new TCSWeakTraining(&amp;Sensor1);
                   if (this-&gt;m_HFeature)
                    m_Features.Add(wt);
                   else
                       delete wt;
                   TLFDFeature Sensor2(sx, sy, w / 2, h / 2);
                   wt = new TCSWeakTraining(&amp;Sensor2);
                   if (this-&gt;m_DFeature)
                    m_Features.Add(wt);
                   else
                       delete wt;
                   TLFCFeature Sensor3(sx, sy, w / 3, h / 3);
                   wt = new TCSWeakTraining(&amp;Sensor3);
                   if (this-&gt;m_CFeature)
                    m_Features.Add(wt);
                   else
                       delete wt;
                   TCSSensor Sensor4(sx, sy, w / 3, h / 3);
                   wt = new TCSWeakTraining(&amp;Sensor4);
                   if (this-&gt;m_CSFeature)
                    m_Features.Add(wt);
                   else
                       delete wt;
                   TLFLBPFeature Sensor5(sx, sy, w / 3, h / 3);
                   wt = new TCSWeakTraining(&amp;Sensor5);
                   if (this-&gt;m_LBPFeature)
                    m_Features.Add(wt);
                   else
                       delete wt;

                   TLFVAFeature Sensor6(sx, sy, w / 2, h);
                   wt = new TCSWeakTraining(&amp;Sensor6);
                   if (this-&gt;m_VAFeature)
                       m_Features.Add(wt);
                   else
                       delete wt;
                   TLFHAFeature Sensor7(sx, sy, w, h / 2);
                   wt = new TCSWeakTraining(&amp;Sensor7);
                   if (this-&gt;m_HAFeature)
                       m_Features.Add(wt);
                   else
                       delete wt;
                   TLFDAFeature Sensor8(sx, sy, w / 2, h / 2);
                   wt = new TCSWeakTraining(&amp;Sensor8);
                   if (this-&gt;m_DAFeature)
                       m_Features.Add(wt);
                   else
                       delete wt;
                   TLFCAFeature Sensor9(sx, sy, w / 3, h / 3);
                   wt = new TCSWeakTraining(&amp;Sensor9);
                   if (this-&gt;m_CAFeature)
                       m_Features.Add(wt);
                   else
                       delete wt;
                   //TLFColorSensor9Bit Sensor10(sx,sy,w,h);
                   //wt = new TCSWeakTraining(&amp;Sensor10);
                   //m_Features.Add(wt);
               }
           }
       }
   }
   DbgMsg(&quot; done .\n&quot;);
   DbgMsg( &quot;AdaBoost: Initiated &quot; + TypeToStr( m_Features.GetCount() )+&quot; features.\n&quot; );
}

void TCSAdaBoost::PrintFeature(ILFFeature* pSensor)
{
    DbgMsg( &quot;Found feature:&quot; + TypeToStr(pSensor-&gt;GetName()) + &quot; x = &quot; + TypeToStr( pSensor-&gt;sxBase() ) +
        &quot;, y = &quot; + TypeToStr( pSensor-&gt;syBase() ) +
        &quot;, width = &quot; + TypeToStr( pSensor-&gt;wUnitBase() ) +
        &quot;, height = &quot; + TypeToStr( pSensor-&gt;hUnitBase() ) + &quot;;\n&quot;);
}

double TCSAdaBoost::PrintStatistics(TCSStrong&amp; Class, double&amp; afrr)
{
    double          dFar = 0, dFrr = 0;
    double min_err = 100000;

    for (  int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
    {

        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

        double err = 0;
        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        Class.Setup(r, m_widthBase);

        Class.Classify(s, err );

        if ( s-&gt;GetFlag() == 1 )
        {
            if (err &lt; min_err)
                min_err = err;

            if ( err &lt; Class.GetThreshold() ) dFrr += 1.0;
        }
        else
        {
            if ( err &gt;= Class.GetThreshold() )
            {
                dFar += 1.0;
            }
        }


    }

    dFrr /= m_nTestFaces;
    dFar /= m_nTestNonFaces;

    DbgMsg( &quot;\nFAR = &quot; + TypeToStr( dFar ) +
            &quot;, FRR = &quot; + TypeToStr( dFrr ) +
            &quot;, threshold = &quot; + TypeToStr( Class.GetThreshold() )+ &quot;;\n&quot; );

    //todo:
    afrr = dFrr;
    
    TWclErrInfo err_info;
    err_info.m_far = dFar;
    err_info.m_frr = dFrr;
    err_info.m_thr = Class.GetThreshold();

    m_trainData.push_back(err_info);
    return dFar;

    double ff = 0;
    double dFar1 = 0;
    double dFrr1 = 0;

    for (  int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
    {

        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

        double err = 0;
        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        Class.Setup(r, m_widthBase);


        Class.Classify( s, err );

        if ( s-&gt;GetFlag() == 1 )
        {
            if (err &lt; min_err) dFrr1 += 1.0;
        }
        else
        {

            if ( err &gt;= min_err )
            {
                dFar1 += 1.0;
            }
        }


    }

    dFrr1 /= m_nTestFaces;
    dFar1 /= m_nTestNonFaces;
    afrr = dFrr1;

    DbgMsg( &quot;ro = &quot; + TypeToStr( min_err ) + &quot;\t frr = &quot; + TypeToStr( dFrr1 ) +
        &quot;,\t far = &quot; + TypeToStr( dFar1 ) + &quot;;\n&quot;);

    //TWclErrInfo err_info;
    err_info.m_far = dFar1;
    err_info.m_frr = dFrr1;
    err_info.m_thr = min_err;

    m_trainData.push_back(err_info);

    return dFar1;
}
int SampleCompare(void * Item1, void * Item2)
{
    TCSSample* s1 = (TCSSample*)Item1;
    TCSSample* s2 = (TCSSample*)Item2;
    if (s1-&gt;GetRating() &gt; s2-&gt;GetRating())
        return 1;
    else if (s1-&gt;GetRating() == s2-&gt;GetRating())
        return 0;
    else
        return -1;
}
void   TCSAdaBoost::SaveFRRSamples(int stage)
{
    if (stage &lt; 0)
        return;
    std::string strPath = this-&gt;m_strPath;
    strPath += &quot;\\frr\\&quot;;

    if (!LFDirExist(strPath.c_str()))
        LFCreateDir(strPath.c_str());

    char buf[32];
    sprintf(buf, &quot;stage%d&quot;, stage);
    strPath += buf;
    if (!LFDirExist(strPath.c_str()))
        LFCreateDir(strPath.c_str());

    //forming an array of positive examples for each settable rating received strong classifier
    TLFObjectList positiveSamples;
    for (int i = 0; i &lt; this-&gt;m_TrainingSamples.GetCount(); i++)
    {
        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
        if (s-&gt;GetFlag() == 1)
        {
            double err = 0;
            awpRect r; r.left =0; r.top = 0;
            r.right = s-&gt;GetImage()-&gt;sSizeX;
            r.bottom = s-&gt;GetImage()-&gt;sSizeY;

            this-&gt;m_ResultClass.Setup(r, m_widthBase);
            this-&gt;m_ResultClass.Classify(s, err);
            s-&gt;SetRating(err);
            
            positiveSamples.Add (new TCSSample(s));
        }
    }
    // sort the list
    positiveSamples.Sort(SampleCompare);
    // Save 1% of the list to disk
    std::string strFrrFileName = LFMakeFileName(strPath, &quot;frr&quot;, &quot;.txt&quot;);
    FILE* F = fopen(strFrrFileName.c_str(), &quot;w+t&quot;);
    if (F == NULL)
        return;
    fprintf (F, &quot;stage threshold = %f\n&quot;, this-&gt;m_ResultClass.GetThreshold());
    int numToSave = positiveSamples.GetCount() / 100;
    for (int i = 0; i &lt; numToSave; i++)
    {
        TCSSample* s = (TCSSample*)positiveSamples.Get(i);
        std::string strFileName = LFMakeFileName(strPath, TypeToStr(i), &quot;.jpg&quot;);
        double r = s-&gt;GetRating();
        fprintf (F, &quot;%s\t %f\n&quot;, strFileName.c_str(),  r);
        awpSaveImage(strFileName.c_str(), s-&gt;GetImage());
    }
    fclose(F);
}

void   TCSAdaBoost::SaveNegativeSamples(const char* lpPath)
{
    string path = lpPath;
    int total = 0;
    LFCreateDir(lpPath);
    for (int i = 0; i &lt; this-&gt;m_TrainingSamples.GetCount(); i++)
    {
        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
        if (s-&gt;GetFlag() == 0)
        {
            string filename = path;
            filename += TypeToStr(total);
            filename += &quot;.awp&quot;;
            total++;
            s-&gt;SaveToFile(filename.c_str());
        }
    }
}

////////////////////////////////////////////////////////////////////////////////
TCSAdaBoostSign::TCSAdaBoostSign()
{
    m_widthBase = 24;
    m_heightBase = 24;
    m_maxFeatures = 50;
    m_strBase1 = &quot;&quot;;
    m_strBase2 = &quot;&quot;;
    m_numSamplesBase1  = 0;
    m_numSamplesBase1  = 0;

    m_flog.open(&quot;log.txt&quot;);
}
bool TCSAdaBoostSign::Load(const char* lpConfigName)
{
   if (lpConfigName == NULL)
        return false;

   TiXmlDocument doc(lpConfigName);
   if (!doc.LoadFile())
    return false;

   TiXmlHandle hDoc(&amp;doc);
   TiXmlElement* pElem = NULL;
   pElem = hDoc.FirstChildElement().Element();

   if (!pElem)
      return false;
   const char* name = pElem-&gt;Value();
   if (strcmp(name, &quot;csboostsign&quot;) != 0)
      return false;
   return Load( pElem);
}

bool    TCSAdaBoostSign::Load (TiXmlElement* node)
{
   if (node == NULL)
    return false;
    m_TrainingSamples.Clear();
    m_TestingSamples.Clear();
    TiXmlElement* pElem = NULL;
    pElem = node-&gt;FirstChildElement();
    //Загрузка образцов для обучения
    DbgMsg( &quot;Loading training sets...\n&quot; );
    m_strBase2 = pElem-&gt;Attribute(&quot;database2&quot;);
    if (!LoadSamples( -1, m_strBase2 ))
        return false;
    m_numSamplesBase2 = m_TrainingSamples.GetCount();
    m_numSamplesTestBase2 = m_TestingSamples.GetCount();
    std::string m_strBase1 = pElem-&gt;Attribute(&quot;database1&quot;);
    if (!LoadSamples( 1,  m_strBase1))
        return false;
    m_numSamplesBase1 = (int)m_TrainingSamples.GetCount( ) - m_numSamplesBase2;
    m_numSamplesTestBase1 = (int)m_TestingSamples.GetCount( ) - m_numSamplesTestBase2;

    //
    double v;
    m_widthBase = 24;
    m_heightBase = 24;
    pElem-&gt;Attribute(&quot;w&quot;, &amp;v);
    m_widthBase = (int )v;
    pElem-&gt;Attribute(&quot;h&quot;, &amp;v);
    m_heightBase = (int )v;

    pElem = pElem-&gt;NextSiblingElement();
    double ni = 5;
    pElem-&gt;Attribute(&quot;maxi&quot;, &amp;ni);
    m_maxFeatures = (int)ni;


    DbgMsg( &quot;Samples to training for class 1 &quot; + TypeToStr(m_numSamplesBase1) +&quot;;\n&quot; );
    DbgMsg( &quot;Samples to training for class -1 &quot; + TypeToStr(m_numSamplesBase2) +&quot;;\n&quot; );
    DbgMsg( &quot;Samples to testing for class 1 &quot; + TypeToStr(m_numSamplesTestBase1) +&quot;;\n&quot; );
    DbgMsg( &quot;Samples to testing for class -1 &quot; + TypeToStr(m_numSamplesTestBase2) +&quot;;\n&quot; );

    // инициализация исходного массива признаков
   InitFeatures( );

    return true;
}

void TCSAdaBoostSign::SetLogName(char* lpLogName)
{
}

void TCSAdaBoostSign::SetLog1Name(char* lpLog1Name)
{
}


bool TCSAdaBoostSign::Boost()
{
    // Начало накачки.
    double wf   = 0.5/m_numSamplesBase1;
    double wnf = 0.5 / m_numSamplesBase2;

    DbgMsg(&quot;\nBoosting started.\n&quot;);

    // Установка начальных весов для обучающего набора m_TrainingSet
    for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
    {
        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
        if (s-&gt;GetFlag() == 1)
            s-&gt;SetWeight(wf);
        else if (s-&gt;GetFlag() == -1)
            s-&gt;SetWeight(wnf);
        else
            continue;
    }

    ProgressMeter progress;
    progress.Init( 30, (int)m_TrainingSamples.GetCount( ) );

    m_ResultClass.Clear();
    //m_trainData.clear();

    if ( m_Features.GetCount( ) == 0 ) return false;

    //Main loop;
    for ( int i = 0; i &lt; m_maxFeatures ; ++i )
    {

        DbgMsg( &quot;\nUpdating: &quot; );
        progress.Init( 30, m_Features.GetCount( ) );
        int count = 0;

//Update
#pragma omp parallel for reduction(+: count)
        for ( int w = 0; w &lt; m_Features.GetCount(); ++w )
        {
            ++count;
            TCSWeakSignTrainig* wcinfo = (TCSWeakSignTrainig*)m_Features.Get(w);
            wcinfo-&gt;SetEpsilon(0);

            //Train section;
            wcinfo-&gt;StartTraining();
            for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
               TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
               wcinfo-&gt;AddSample(s, s-&gt;GetFlag(), s-&gt;GetWeight());
            }
            wcinfo-&gt;Train();

            //Calc error;
            for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
                TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

                int res = wcinfo-&gt;Classify( s );

                if ( s-&gt;GetFlag() != res )
                {
                    wcinfo-&gt;SetEpsilon(wcinfo-&gt;GetEpsilon() + s-&gt;GetWeight());
                }
            }

            if ( progress.Update( ) )
                DbgMsg(&quot;&gt;&quot;);
        }

        DbgMsg( &quot;\n&quot; );
        printf( &quot;Count stage: %d \n&quot;, count );
        // выбор лучшего признака, по минимальной ошибке классификации на обучающем наборе.
        int bestWc = 0;
        for ( int w = 0; w &lt; m_Features.GetCount(); ++w )
        {
            TCSWeakSignTrainig* best       = (TCSWeakSignTrainig*)m_Features.Get(bestWc);
            TCSWeakSignTrainig* current    = (TCSWeakSignTrainig*)m_Features.Get(w);
            if ( best-&gt;GetEpsilon() &gt; current-&gt;GetEpsilon()  )
                bestWc = w;
        }
        TCSWeakSignTrainig* pWc       = (TCSWeakSignTrainig*)m_Features.Get(bestWc);
        pWc-&gt;SetWeight((double)pWc-&gt;GetEpsilon());

        // если ошибка лучшего классификатора превысила критический уровень 50%
        // прекращаем процесс накачки.
        if ( pWc-&gt;Weight() &gt; 0.49 ) break;


        //Update wc weight;
        double beta = pWc-&gt;Weight()/ (1 - pWc-&gt;Weight());
        double min_eps = pWc-&gt;Weight();
        pWc-&gt;SetWeight (log(1.0/beta));

        //Добавим &quot;слабый&quot; классификатор в &quot;комитет".
        m_ResultClass.AddWeak(pWc);
        
        // распечатка атрибутов классификатора
        DbgMsg( &quot;\nRound num = &quot; + TypeToStr(i + 1) +
            &quot;, min_eps = &quot; + TypeToStr(min_eps) +
            &quot;, beta = &quot; + TypeToStr( beta ) +
        &quot;, alpha = &quot;+ TypeToStr(pWc-&gt;Weight())+&quot;;\n&quot; );

        this-&gt;Statistics();
        // для каждого образца обновим веса
        double wt = 0;
        for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
        {
            TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

            int res = 0;
            double err = 0;
            res = pWc-&gt;Classify( s );

            if ( res == s-&gt;GetFlag() )
                s-&gt;SetWeight(s-&gt;GetWeight()*beta);
            wt += s-&gt;GetWeight();
        }

        //Normalize;
        wt = 1.0/wt;

        for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
        {
            TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
            s-&gt;SetWeight(s-&gt;GetWeight()*wt);
        }

        //Удалим найденный признак из списка признаков
        m_Features.Delete(bestWc);

    }
    //SaveROC();
    return true;
}
//
TCSStrongSign* TCSAdaBoostSign::GetResult()
{
  return &amp;m_ResultClass;
}

void    TCSAdaBoostSign::InitFeatures()
{
    m_Features.Clear();

   int sx = 1;
   int sy = 1;
   int w = 3;
   int h = 3;
   for (h = m_heightBase -3; h &gt;= 3; h-=3)
   {
       for (w = m_widthBase ; w &gt;= 3; w-=3)
       {
           for (sy = 1; sy &lt; m_heightBase - h - 1; sy++)
           {
               for (sx = 1; sx &lt; m_widthBase - w - 1; sx++)
               {
                   TCSSensor Sensor(sx, sy, w / 3, h / 3);
                   TCSWeakSignTrainig* wt = new TCSWeakSignTrainig(Sensor);
                   m_Features.Add(wt);
               }
           }
       }
   }
}

bool    TCSAdaBoostSign::LoadSamples(int flag, std::string const&amp; path)
{
    DbgMsg( &quot;Loading samples from &quot; + path + &quot;... &quot; );

    int count = 0;
    srand( (unsigned)time( NULL ) );
    int RANGE_MIN = 0;
    int RANGE_MAX = 3;

#ifdef WIN32
    intptr_t handle = 0;
    _finddata_t filesInfo;
    if ( (handle = _findfirst( (char*)((path+&quot;*.jpg&quot;).c_str()), &amp;filesInfo)) != -1 )
    {
        do
        {
           string name = path + filesInfo.name;
        
            TCSSample* pSample = new TCSSample();
            pSample-&gt;LoadFromFile((char*)name.c_str());

    //        if (pSample-&gt;Process())
            {
                pSample-&gt;SetFlag(flag);
                int r = (int)(((double) rand() / (double) RAND_MAX) * RANGE_MAX + RANGE_MIN);

                //int  r = rand(0);
                if (r &gt; 0)
                    m_TrainingSamples.Add(pSample);
                else
                    m_TestingSamples.Add(pSample);

                ++count;
            }
//            else
//printf( &quot;Can&#39;t load image %s.\n&quot;, name.c_str( ) );
        }while(!_findnext( handle, &amp;filesInfo ));


    }
    _findclose( handle );

#else

//    struct dirent** namelist;
//    if(( count = scandir( path.c_str(), &amp;namelist, jpg_filter, alphasort )) &lt; 0 )
//            return 0;

//    for( int i=0; i&lt;count; i++ )
//    {
//            string name = path + namelist[i]-&gt;d_name;

//            TCSSample* pSample = new TCSSample();
//            pSample-&gt;LoadImage((char*)name.c_str());


//                pSample-&gt;SetFlag(flag);
//              int r = (((double) rand() / (double) RAND_MAX) * RANGE_MAX + RANGE_MIN);

//                //int  r = rand(0);
//                if (r &gt; 0)
//                    m_TrainingSamples.Add(pSample);
//                else
//                    m_TestingSamples.Add(pSample);

//    }

#endif

    DbgMsg( TypeToStr( count ) + &quot; ok\n&quot; );
    return count &gt; 0;
}
void    TCSAdaBoostSign::DbgMsg( std::string const&amp; msg)
{
    std::cout&lt;&lt; msg;  
#ifdef WIN32
    m_flog &lt;&lt; msg;
    m_flog.flush();
#endif
}

void    TCSAdaBoostSign::Statistics()
{
    double errt[2] = {0,0};
    double err1[2] = { 0, 0 };
    double err2[2] = { 0, 0 };
    double erru[2] = { 0, 0 };
    for (  int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
    {

        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

        double err = 0;
        //double factor = (double)(s-&gt;GetImage()-&gt;sSizeX)/24.0;
        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        m_ResultClass.Setup(r, m_widthBase);

        int res = m_ResultClass.Classify( s-&gt;GetIntegralImage(), err );
        if (res != s-&gt;GetFlag())
        {
              errt[0]++;
              if (res == 0)
                erru[0]++;
              if (res == 1)
                err2[0]++;
              if (res == -1)
                err1[0]++;
        }
    }
    errt[0] /= m_TrainingSamples.GetCount();
    errt[0] *= 100;

    err1[0] /= (m_numSamplesBase1);
    err1[0] *= 100;

    err2[0] /= (m_numSamplesBase2);
    err2[0] *= 100;

    erru[0] /= m_TrainingSamples.GetCount();
    erru[0] *= 100;
    for (  int i = 0; i &lt; m_TestingSamples.GetCount(); i++ )
    {

        TCSSample* s = (TCSSample*)m_TestingSamples.Get(i);

        double err = 0;
        //double factor = (double)(s-&gt;GetImage()-&gt;sSizeX)/24.0;
        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        m_ResultClass.Setup(r, m_widthBase);

        int res = m_ResultClass.Classify( s-&gt;GetIntegralImage(), err );
        if (res != s-&gt;GetFlag())
        {
              errt[1]++;
              if (res == 0)
                erru[1]++;
              if (res == 1)
                err2[1]++;
              if (res == -1)
                err1[1]++;
        }
    }
    if (m_TestingSamples.GetCount() &gt; 0)
    {
    errt[1] /= m_TestingSamples.GetCount();
    errt[1] *= 100;

    err1[1] /= (m_numSamplesTestBase1);
    err1[1] *= 100;
    err2[1] /= (m_numSamplesTestBase2);
    err2[1] *= 100;


    erru[1] /= m_TestingSamples.GetCount();
    erru[1] *= 100;
    }

    DbgMsg( &quot;errt = &quot; + TypeToStr( errt[0] ) + &quot; % &quot; + TypeToStr( errt[1] ) + &quot;%;\n&quot; );
    DbgMsg( &quot;err1 = &quot; + TypeToStr( err1[0] ) + &quot; % &quot; + TypeToStr( err1[1] ) + &quot;%;\n&quot; );
    DbgMsg( &quot;err2 = &quot; + TypeToStr( err2[0] ) + &quot; % &quot; + TypeToStr( err2[1] ) + &quot;%;\n&quot;  );
    DbgMsg( &quot;erru = &quot; + TypeToStr( erru[0] ) + &quot; % &quot; + TypeToStr( erru[1] ) + &quot;%;\n&quot; );
}


struct roc_entry
{
    double far1;
    double frr1;
    double far2;
    double frr2;
};
void TCSAdaBoostSign::SaveROC(char*lpName)
{
 //
    double* fSourceClass1 = NULL;
    double* fSourceClass2 = NULL;
    roc_entry roc[100];
    memset(roc,0, sizeof(roc));
    fSourceClass1 = (double*)malloc(m_numSamplesTestBase1*sizeof(double));
    fSourceClass2 = (double*)malloc(m_numSamplesTestBase2*sizeof(double));
    memset(fSourceClass1, 0, m_numSamplesTestBase1*sizeof(double));
    memset(fSourceClass2, 0, m_numSamplesTestBase2*sizeof(double));
    int nc1 =0;
    int nc2 =0;

    for (int i = 0; i &lt; m_TestingSamples.GetCount(); i++)
    {
        TCSSample* s = (TCSSample*)m_TestingSamples.Get(i);

        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        m_ResultClass.Setup(r, m_widthBase);
        double err = 0;
        m_ResultClass.Classify( s-&gt;GetIntegralImage(), err );
        if (s-&gt;GetFlag() == 1)
        {
            fSourceClass1[nc1] = err;
            nc1++;
        }
        else
        {
            fSourceClass2[nc2] = err;
            nc2++;
        }
    }

    double tau = m_ResultClass.GetSumWeakWeight();

    DbgMsg( TypeToStr( tau ) + &quot;\n&quot; );

    double delta = tau / 50.f;
    double stau = -tau;
    int c = 0;
    while(stau &lt; tau)
    {
        for (int i=0; i&lt; nc1; i++)
        {
            if (fSourceClass1[i] &lt; stau)
                roc[c].frr1++;
            if (fSourceClass1[i] &lt; stau)
                roc[c].far2++;
        }
        for (int i=0; i&lt; nc2; i++)
        {
            if (fSourceClass2[i] &gt; stau)
                roc[c].far1++;
            if (fSourceClass2[i] &gt; stau)
                roc[c].frr2++;
        }

        stau += delta;
        c++;
    }
    DbgMsg( TypeToStr( c ) + &quot;\n&quot; );
    for (int i = 0; i &lt; 100; i++)
    {
        roc[i].far1 = 100.f*roc[i].far1/nc2;
        roc[i].frr1 = 100.f*roc[i].frr1/nc1;
        roc[i].far2 = 100.f*roc[i].far2/nc1;
        roc[i].frr2 = 100.f*roc[i].frr2/nc2;
    }
//  std::ostream*       f;
//  f = new ofstream(&quot;roc.txt&quot;);
//  for (int i = 0; i &lt; 100; i++)
//      (*f) &lt;&lt; roc[i].far1 &lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr1&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].far2&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr2 &lt;&lt;&quot;\n&quot;;
//  delete f;
    FILE* f = fopen (lpName, &quot;w+t&quot;);
    for (int i = 0; i &lt; 100; i++)
    {
//      fprintf(f, &quot;%f\n&quot;, roc[i].far1);
        fprintf(f, &quot;%f\t%f\t%f\t%f\n&quot;, roc[i].far1, roc[i].frr1, roc[i].far2,roc[i].frr2);
    }
    //  (*f) &lt;&lt; roc[i].far1 &lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr1&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].far2&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr2 &lt;&lt;&quot;\n&quot;;
    fclose(f);
    free(fSourceClass1);
    free(fSourceClass2);
}

TIEFSAdaBoost::TIEFSAdaBoost()
{
    m_numIFS = 0;
    m_numEFS = 0;
    m_strSourceFile = &quot;&quot;;
    m_pLog = NULL;
}

bool TIEFSAdaBoost::Load(const char* lpFileName)
{
    /*попытка открыть файл конфигурации*/
    TiXmlDocument doc(lpFileName);
    if (!doc.LoadFile())
        return false;
    TiXmlElement* e = doc.FirstChildElement(&quot;IEFSBoost&quot;);
    if (e == NULL)
        return false;
    m_strSourceFile = e-&gt;Attribute(&quot;file&quot;);
    string str = e-&gt;Attribute(&quot;log&quot;);

    if (m_pLog == NULL)
        m_pLog = new ofstream(str.c_str());

    return LoadSamples();
}
// распечатка сообщения на экране и в лог файле
void TIEFSAdaBoost::DbgMsg(std::string const&amp; msg)
{
    (*m_pLog) &lt;&lt; msg;
    cout &lt;&lt; msg;
    flush(*m_pLog);
}

bool TIEFSAdaBoost::Boost()
{
    // Начало накачки.
    double wf  = 0.5 / this-&gt;m_numIFS;
    double wnf = 0.5 / this-&gt;m_numEFS;

    DbgMsg(&quot;\nBoosting started.\n&quot;);

    // Установка начальных весов для обучающего набора m_TrainingSet
    for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
    {
        TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
        if (s-&gt;GetFlag() == 1)
            s-&gt;SetWeight(wf);
        else if (s-&gt;GetFlag() == 0)
            s-&gt;SetWeight(wnf);
        else
            continue;
    }

    ProgressMeter progress;
    progress.Init(30, (int)m_TrainingSamples.GetCount());
    // result class 
    m_ResultClass.Clear();

    if (m_Features.GetCount() == 0)
        return false;

    //Main loop;
    //for (int i = 0; i &lt; this-&gt;m_Features.GetCount(); ++i)
    int i = 0;
    while (this-&gt;m_Features.GetCount() &gt; 0)
    {
        i++;
        DbgMsg(&quot;\nUpdating: &quot;);
        progress.Init(30, m_Features.GetCount());
        int count = 0;

        //Update
#pragma omp parallel for reduction(+: count)
        for (int w = 1; w &lt; m_Features.GetCount(); ++w)
        {
            ++count;
            TIEFSWeak2* wcinfo = (TIEFSWeak2*)m_Features.Get(w);
            if (!wcinfo-&gt;IsFree())
                continue;
            wcinfo-&gt;SetEpsilon(0);

            //Train section;
            wcinfo-&gt;StartTraining();
            for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
                TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
                wcinfo-&gt;AddSample(s);
            }
            wcinfo-&gt;Train();

            //Calc error;
            for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
                TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);

                int res = wcinfo-&gt;Classify(s-&gt;GetValue(w));

                if (s-&gt;GetFlag() != res)
                {
                    wcinfo-&gt;SetEpsilon(wcinfo-&gt;GetEpsilon() + s-&gt;GetWeight());
                }
            }

            if (progress.Update())
                DbgMsg(&quot;&gt;&quot;);
        }

        DbgMsg(&quot;\n&quot;);
        DbgMsg(&quot;Count stage: %d \n&quot; + TypeToStr(count));
        // выбор лучшего признака, по минимальной ошибке классификации на обучающем наборе.
        int bestWc = 1;
        while (!((TIEFSWeak2*)m_Features.Get(bestWc))-&gt;IsFree())
            bestWc++;
        for (int w = bestWc +1; w &lt; m_Features.GetCount(); ++w)
        {
            
            TIEFSWeak2* best = (TIEFSWeak2*)m_Features.Get(bestWc);
            TIEFSWeak2* current = (TIEFSWeak2*)m_Features.Get(w);
            if (!current-&gt;IsFree())
                continue;
            if (best-&gt;GetEpsilon() &gt; current-&gt;GetEpsilon())
                bestWc = w;
        }
        TIEFSWeak* pWc = (TIEFSWeak*)m_Features.Get(bestWc);
        pWc-&gt;SetWeight(pWc-&gt;GetEpsilon());

        // если ошибка лучшего классификатора превысила критический уровень 50%
        // прекращаем процесс накачки.
        if (pWc-&gt;GetWeight() &gt;= 0.5)
        {
        
            DbgMsg(&quot;\n Min eps = 0.5. Break.\n&quot;);
            break;
        }


        //Update wc weight;
        double beta = pWc-&gt;GetWeight() / (1 - pWc-&gt;GetWeight());
        double min_eps = pWc-&gt;GetWeight();
        pWc-&gt;SetWeight(log(1.0 / beta)); 

        //Добавим &quot;слабый&quot; классификатор в &quot;комитет".
        //result class  
        m_ResultClass.Add(pWc-&gt;Clone());
        m_ResultClass.SetThreshold(m_ResultClass.GetSumWeakWeight() / 2);
        pWc-&gt;Lock();
        // распечатка атрибутов классификатора
        DbgMsg(&quot;\nRound num = &quot; + TypeToStr(i + 1) +
            &quot;, min_eps = &quot; + TypeToStr(min_eps) +
            &quot;, beta = &quot; + TypeToStr(beta) +
            &quot;, alpha = &quot; + TypeToStr(pWc-&gt;GetWeight()) + &quot;;\n&quot;);
        // распечатка атрибутов выбранного признака
        DbgMsg(&quot;Feature num = &quot; + TypeToStr(pWc-&gt;GetIndex()) + &quot;\n&quot; );

        //распечатка ошибки на тестовом наборе.
        PrintStatistics();


        // для каждого образца обновим веса
        double wt = 0;
        for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
        {
            TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);

            int res = 0;

            res = pWc-&gt;Classify(s-&gt;GetValue(pWc-&gt;GetIndex()));

            if (res == s-&gt;GetFlag())
            {
                s-&gt;SetWeight(s-&gt;GetWeight()*beta);
            }
            wt += s-&gt;GetWeight();
        }

        //Normalize;
        wt = 1.0 / wt;
        double sum = 0;
        for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
        {
            TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
            s-&gt;SetWeight(s-&gt;GetWeight()*wt);
            sum += s-&gt;GetWeight();
        }
        DbgMsg(&quot;sum  = &quot; + TypeToStr(sum) + &quot;\n&quot;);
        //Удалим найденный признак из списка признаков
      //m_Features.Delete(bestWc);

    }

    this-&gt;m_ResultClass.SaveXML(&quot;IEFSclass.xml&quot;);
    if (this-&gt;m_ResultClass.LoadXML(&quot;IEFSclass.xml&quot;))
    {
        DbgMsg(&quot;Work done.\n\n&quot;);
        this-&gt;PrintStatistics();
        DbgMsg(&quot;Bye!\n&quot;);
        return true;
    }
    else
        return false;
}
double  TIEFSAdaBoost::PrintStatistics()
{
    double          dFar = 0, dFrr = 0;

    for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
    {
        TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
        double err = m_ResultClass.Raiting(s);
        if (s-&gt;GetFlag() == 1)
        {
            if (err &lt; m_ResultClass.GetThreshold()) dFrr += 1.0;
        }
        else
        {
            if (err &gt;= m_ResultClass.GetThreshold())
            {
                dFar += 1.0;
            }
        }
    }

    dFrr /= this-&gt;m_numIFS;
    dFar /= this-&gt;m_numEFS;

    DbgMsg(&quot;\nFAR = &quot; + TypeToStr(dFar) +
        &quot;, FRR = &quot; + TypeToStr(dFrr) +
        &quot;, threshold = &quot; + TypeToStr(m_ResultClass.GetThreshold()) + &quot;;\n&quot;);

    return 0;
}

bool TIEFSAdaBoost::InitFeatures(int num)
{
    if (num &lt;= 0)
    {
        DbgMsg(&quot;Invalid num features: num = &quot; +TypeToStr (num) + &quot;\n&quot;);
        return false;
    }
    for (int i = 0; i &lt; num; i++)
    {
        TIEFSWeak2* w = new TIEFSWeak2(i);
        this-&gt;m_Features.Add(w);
    }
    DbgMsg(TypeToStr(num) + &quot;features created.\n&quot;);
    return true;
}
bool TIEFSAdaBoost::LoadSamples()
{
    DbgMsg(&quot;Loading samples...\n&quot;);
    awpImage* img = NULL;
    if (awpLoadImage(this-&gt;m_strSourceFile.c_str(), &amp;img) != AWP_OK)
    {
        DbgMsg(&quot;Cannot load featues from &quot; + m_strSourceFile + &quot;\n&quot;);
        return false;
    }
    int num = img-&gt;sSizeX - 1;
    double* diff = (double*)malloc(num*sizeof(double));
    if (!this-&gt;InitFeatures(num))
    {
        awpReleaseImage(&amp;img);
        free(diff);
        return false;
    }
    double* d = (double*)img-&gt;pPixels;
    int ifs_count = 0;
    int efs_count = 0;
    for (int i = 0; i &lt; img-&gt;sSizeY; i++)
    {
        int id1 = (int)d[i*img-&gt;sSizeX];
        for (int j = i + 1; j &lt; img-&gt;sSizeY; j++)
        {
            int id2 = (int)d[j*img-&gt;sSizeX];
            int flag = id1 == id2 ? 1 : 0;
            if (!flag &amp;&amp; efs_count &gt; 730000)
                continue;
            if (flag)
                ifs_count++;
            else
                efs_count++;

            for (int k = 1; k &lt;= num; k++)
            {
                diff[k-1] = fabs(d[i*img-&gt;sSizeX + k] - d[j*img-&gt;sSizeX + k]);
            }
            TIEFSSample* s = new TIEFSSample(diff, num, flag);
            this-&gt;m_TrainingSamples.Add(s);
        }
    }
    this-&gt;m_numIFS = ifs_count;
    this-&gt;m_numEFS = efs_count;

    awpReleaseImage(&amp;img);
    free(diff);
    DbgMsg(&quot;IFS samples loaded = &quot; + TypeToStr(m_numIFS) + &quot;\n&quot;);
    DbgMsg(&quot;EFS samples loaded = &quot; + TypeToStr(m_numEFS) + &quot;\n&quot;);
    return true;
}
</span> </div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        m_Features.Delete(bestWc);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    }</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160; </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="comment">//this-&gt;SaveFRRSamples(stage);</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;}</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">// распечатка сообщения на экране и в лог файле void TCSAdaBoost::DbgMsg( std::string const&amp; msg)
{
    (*m_pLog) &lt;&lt; msg;
    cout &lt;&lt; msg;
    flush( *m_pLog );
}

std::string TCSAdaBoost::GetArtefactsBase()
{
    return m_strArtefactsBase;
}
void TCSAdaBoost::SetArtefactsBase(std::string str)
{
    m_strArtefactsBase = str;
}
std::string TCSAdaBoost::GetObjectsBase()
{
    return m_strObjectsbase;
}

void TCSAdaBoost::SetObjectsBase(std::string str)
{
    m_strObjectsbase = str;
}

// возвращает ширину и высоту изображений, которые используются
// для обучения
AWPWORD TCSAdaBoost::WidthBase()
{
    return m_widthBase;
}
void TCSAdaBoost::SetWidthBase(AWPWORD value)
{
    m_widthBase = value;
}
AWPWORD TCSAdaBoost::HeightBase()
{
    return m_heightBase;
}
void TCSAdaBoost::SetHeightBase(AWPWORD value)
{
    m_heightBase = value;
}
TErrTrainData&amp; TCSAdaBoost::GetTrainData()
{
    return m_trainData;
}

TCSStrong* TCSAdaBoost::GetClass()
{
    return &amp;m_ResultClass;
}
int TCSAdaBoost::GetFeaturesCount()
{
    return m_nFeaturesCount;
}
void TCSAdaBoost::SetFeaturesCount(int value)
{
    m_nFeaturesCount = value;
}

double TCSAdaBoost::GetFinishFar()
{
    return this-&gt;m_FinishFar;
}
void TCSAdaBoost::SetFinishFar(double value)
{
    this-&gt;m_FinishFar = value;
}

std::string TCSAdaBoost::GetPath()
{
    return this-&gt;m_strPath;
}

void TCSAdaBoost::SetPath(const char* lpPath)
{
    this-&gt;m_strPath = lpPath;
}

static bool _IsImageFile(std::string&amp; strFileName)
{
    std::string strExt = LFGetFileExt(strFileName);
    std::transform(strExt.begin(), strExt.end(), strExt.begin(), ::tolower);

    if (strExt == &quot;.awp&quot;)
        return true;
    if (strExt == &quot;.jpg&quot;)
        return true;
    if (strExt == &quot;.jpeg&quot;)
        return true;
    if (strExt == &quot;.png&quot;)
        return true;
    if (strExt == &quot;.bmp&quot;)
        return true;
    return false;
}

// загружает образцы для обучения из директории path и сохраняет их в списке объектов 
// SampleList. в зависимости от установленного флага flag образцы считаются образцами 
// объектов или образцами фонов. flag = 1 соответствует образцам объектов, flag = 0 - 
// соответствует образцам фонов.
bool TCSAdaBoost::LoadSample(TLFObjectList&amp; SampleList, int flag, std::string const&amp; path)
{
    DbgMsg( &quot;Loading samples from &quot; + path + &quot;... \n&quot; );
    int count = 0;
    TLFStrings names;
    if (!LFGetDirFiles(path.c_str(), names))
    {
        DbgMsg(&quot;Reading names failed.&quot;);
        return false;
    }
    if (names.size() == 0)
    {
        DbgMsg(&quot;Database is empty.&quot;);
        return false;
    }
    DbgMsg(&quot;Reading &quot; + TypeToStr(names.size()) + &quot; files.\n&quot;);
    for (int i = 0; i &lt; names.size(); i++)
    {
        string name = names[i];
        if (!_IsImageFile(name))
            continue;
        TCSSample* pSample = new TCSSample();
        //DbgMsg(name + &quot;\n&quot;);
        pSample-&gt;LoadFromFile((char*)name.c_str());
        double e = 0;
        if (pSample-&gt;GetImage()-&gt;sSizeX &lt; this-&gt;m_widthBase || pSample-&gt;GetImage()-&gt;sSizeY &lt; this-&gt;m_heightBase)
        {
            delete pSample;
            continue;
        }
        awpImage* img = pSample-&gt;GetIntegralImage();
        if (img == NULL)
            continue;
        pSample-&gt;GetSqIntegralImage();
        bool need_process = flag == 1 ? true : false;
        pSample-&gt;SetFlag(flag);
        SampleList.Add(pSample);
        ++count;
    }

    DbgMsg(TypeToStr(count) + &quot; ok\n&quot;);
    return count &gt; 0;

}
//
void TCSAdaBoost::InitFeatures()
{
   
    DbgMsg(&quot;AdaBoost: init features .... &quot;);
    srand(11);
    m_Features.Clear();

   int sx = 1;
   int sy = 1;
   int w = 3;
   int h = 3;
   for (h = m_heightBase; h &gt;= 3; h-=1)
   {
       for (w = m_widthBase; w &gt;= 3; w-=1)
       {
           for (sy = 0; sy &lt;= m_heightBase - h -3; sy++)
           {
               for (sx = 0; sx &lt;= m_widthBase - w -3; sx++)
               {
                   
                   bool skip = false;// (rand() % 10) &gt; 2;
                   if (skip)
                       continue;
                   TCSWeakTraining* wt = NULL;
                   TLFVFeature Sensor0(sx, sy, w/2, h);
                   wt = new TCSWeakTraining(&amp;Sensor0);
                   if (this-&gt;m_VFeature)
                       m_Features.Add(wt);
                   else
                       delete wt;
                   TLFHFeature Sensor1(sx, sy, w, h/2);
                   wt = new TCSWeakTraining(&amp;Sensor1);
                   if (this-&gt;m_HFeature)
                    m_Features.Add(wt);
                   else
                       delete wt;
                   TLFDFeature Sensor2(sx, sy, w / 2, h / 2);
                   wt = new TCSWeakTraining(&amp;Sensor2);
                   if (this-&gt;m_DFeature)
                    m_Features.Add(wt);
                   else
                       delete wt;
                   TLFCFeature Sensor3(sx, sy, w / 3, h / 3);
                   wt = new TCSWeakTraining(&amp;Sensor3);
                   if (this-&gt;m_CFeature)
                    m_Features.Add(wt);
                   else
                       delete wt;
                   TCSSensor Sensor4(sx, sy, w / 3, h / 3);
                   wt = new TCSWeakTraining(&amp;Sensor4);
                   if (this-&gt;m_CSFeature)
                    m_Features.Add(wt);
                   else
                       delete wt;
                   TLFLBPFeature Sensor5(sx, sy, w / 3, h / 3);
                   wt = new TCSWeakTraining(&amp;Sensor5);
                   if (this-&gt;m_LBPFeature)
                    m_Features.Add(wt);
                   else
                       delete wt;

                   TLFVAFeature Sensor6(sx, sy, w / 2, h);
                   wt = new TCSWeakTraining(&amp;Sensor6);
                   if (this-&gt;m_VAFeature)
                       m_Features.Add(wt);
                   else
                       delete wt;
                   TLFHAFeature Sensor7(sx, sy, w, h / 2);
                   wt = new TCSWeakTraining(&amp;Sensor7);
                   if (this-&gt;m_HAFeature)
                       m_Features.Add(wt);
                   else
                       delete wt;
                   TLFDAFeature Sensor8(sx, sy, w / 2, h / 2);
                   wt = new TCSWeakTraining(&amp;Sensor8);
                   if (this-&gt;m_DAFeature)
                       m_Features.Add(wt);
                   else
                       delete wt;
                   TLFCAFeature Sensor9(sx, sy, w / 3, h / 3);
                   wt = new TCSWeakTraining(&amp;Sensor9);
                   if (this-&gt;m_CAFeature)
                       m_Features.Add(wt);
                   else
                       delete wt;
                   //TLFColorSensor9Bit Sensor10(sx,sy,w,h);
                   //wt = new TCSWeakTraining(&amp;Sensor10);
                   //m_Features.Add(wt);
               }
           }
       }
   }
   DbgMsg(&quot; done .\n&quot;);
   DbgMsg( &quot;AdaBoost: Initiated &quot; + TypeToStr( m_Features.GetCount() )+&quot; features.\n&quot; );
}

void TCSAdaBoost::PrintFeature(ILFFeature* pSensor)
{
    DbgMsg( &quot;Found feature:&quot; + TypeToStr(pSensor-&gt;GetName()) + &quot; x = &quot; + TypeToStr( pSensor-&gt;sxBase() ) +
        &quot;, y = &quot; + TypeToStr( pSensor-&gt;syBase() ) +
        &quot;, width = &quot; + TypeToStr( pSensor-&gt;wUnitBase() ) +
        &quot;, height = &quot; + TypeToStr( pSensor-&gt;hUnitBase() ) + &quot;;\n&quot;);
}

double TCSAdaBoost::PrintStatistics(TCSStrong&amp; Class, double&amp; afrr)
{
    double          dFar = 0, dFrr = 0;
    double min_err = 100000;

    for (  int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
    {

        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

        double err = 0;
        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        Class.Setup(r, m_widthBase);

        Class.Classify(s, err );

        if ( s-&gt;GetFlag() == 1 )
        {
            if (err &lt; min_err)
                min_err = err;

            if ( err &lt; Class.GetThreshold() ) dFrr += 1.0;
        }
        else
        {
            if ( err &gt;= Class.GetThreshold() )
            {
                dFar += 1.0;
            }
        }


    }

    dFrr /= m_nTestFaces;
    dFar /= m_nTestNonFaces;

    DbgMsg( &quot;\nFAR = &quot; + TypeToStr( dFar ) +
            &quot;, FRR = &quot; + TypeToStr( dFrr ) +
            &quot;, threshold = &quot; + TypeToStr( Class.GetThreshold() )+ &quot;;\n&quot; );

    //todo:
    afrr = dFrr;
    
    TWclErrInfo err_info;
    err_info.m_far = dFar;
    err_info.m_frr = dFrr;
    err_info.m_thr = Class.GetThreshold();

    m_trainData.push_back(err_info);
    return dFar;

    double ff = 0;
    double dFar1 = 0;
    double dFrr1 = 0;

    for (  int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
    {

        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

        double err = 0;
        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        Class.Setup(r, m_widthBase);


        Class.Classify( s, err );

        if ( s-&gt;GetFlag() == 1 )
        {
            if (err &lt; min_err) dFrr1 += 1.0;
        }
        else
        {

            if ( err &gt;= min_err )
            {
                dFar1 += 1.0;
            }
        }


    }

    dFrr1 /= m_nTestFaces;
    dFar1 /= m_nTestNonFaces;
    afrr = dFrr1;

    DbgMsg( &quot;ro = &quot; + TypeToStr( min_err ) + &quot;\t frr = &quot; + TypeToStr( dFrr1 ) +
        &quot;,\t far = &quot; + TypeToStr( dFar1 ) + &quot;;\n&quot;);

    //TWclErrInfo err_info;
    err_info.m_far = dFar1;
    err_info.m_frr = dFrr1;
    err_info.m_thr = min_err;

    m_trainData.push_back(err_info);

    return dFar1;
}
int SampleCompare(void * Item1, void * Item2)
{
    TCSSample* s1 = (TCSSample*)Item1;
    TCSSample* s2 = (TCSSample*)Item2;
    if (s1-&gt;GetRating() &gt; s2-&gt;GetRating())
        return 1;
    else if (s1-&gt;GetRating() == s2-&gt;GetRating())
        return 0;
    else
        return -1;
}
void   TCSAdaBoost::SaveFRRSamples(int stage)
{
    if (stage &lt; 0)
        return;
    std::string strPath = this-&gt;m_strPath;
    strPath += &quot;\\frr\\&quot;;

    if (!LFDirExist(strPath.c_str()))
        LFCreateDir(strPath.c_str());

    char buf[32];
    sprintf(buf, &quot;stage%d&quot;, stage);
    strPath += buf;
    if (!LFDirExist(strPath.c_str()))
        LFCreateDir(strPath.c_str());

    //forming an array of positive examples for each settable rating received strong classifier
    TLFObjectList positiveSamples;
    for (int i = 0; i &lt; this-&gt;m_TrainingSamples.GetCount(); i++)
    {
        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
        if (s-&gt;GetFlag() == 1)
        {
            double err = 0;
            awpRect r; r.left =0; r.top = 0;
            r.right = s-&gt;GetImage()-&gt;sSizeX;
            r.bottom = s-&gt;GetImage()-&gt;sSizeY;

            this-&gt;m_ResultClass.Setup(r, m_widthBase);
            this-&gt;m_ResultClass.Classify(s, err);
            s-&gt;SetRating(err);
            
            positiveSamples.Add (new TCSSample(s));
        }
    }
    // sort the list
    positiveSamples.Sort(SampleCompare);
    // Save 1% of the list to disk
    std::string strFrrFileName = LFMakeFileName(strPath, &quot;frr&quot;, &quot;.txt&quot;);
    FILE* F = fopen(strFrrFileName.c_str(), &quot;w+t&quot;);
    if (F == NULL)
        return;
    fprintf (F, &quot;stage threshold = %f\n&quot;, this-&gt;m_ResultClass.GetThreshold());
    int numToSave = positiveSamples.GetCount() / 100;
    for (int i = 0; i &lt; numToSave; i++)
    {
        TCSSample* s = (TCSSample*)positiveSamples.Get(i);
        std::string strFileName = LFMakeFileName(strPath, TypeToStr(i), &quot;.jpg&quot;);
        double r = s-&gt;GetRating();
        fprintf (F, &quot;%s\t %f\n&quot;, strFileName.c_str(),  r);
        awpSaveImage(strFileName.c_str(), s-&gt;GetImage());
    }
    fclose(F);
}

void   TCSAdaBoost::SaveNegativeSamples(const char* lpPath)
{
    string path = lpPath;
    int total = 0;
    LFCreateDir(lpPath);
    for (int i = 0; i &lt; this-&gt;m_TrainingSamples.GetCount(); i++)
    {
        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
        if (s-&gt;GetFlag() == 0)
        {
            string filename = path;
            filename += TypeToStr(total);
            filename += &quot;.awp&quot;;
            total++;
            s-&gt;SaveToFile(filename.c_str());
        }
    }
}

////////////////////////////////////////////////////////////////////////////////
TCSAdaBoostSign::TCSAdaBoostSign()
{
    m_widthBase = 24;
    m_heightBase = 24;
    m_maxFeatures = 50;
    m_strBase1 = &quot;&quot;;
    m_strBase2 = &quot;&quot;;
    m_numSamplesBase1  = 0;
    m_numSamplesBase1  = 0;

    m_flog.open(&quot;log.txt&quot;);
}
bool TCSAdaBoostSign::Load(const char* lpConfigName)
{
   if (lpConfigName == NULL)
        return false;

   TiXmlDocument doc(lpConfigName);
   if (!doc.LoadFile())
    return false;

   TiXmlHandle hDoc(&amp;doc);
   TiXmlElement* pElem = NULL;
   pElem = hDoc.FirstChildElement().Element();

   if (!pElem)
      return false;
   const char* name = pElem-&gt;Value();
   if (strcmp(name, &quot;csboostsign&quot;) != 0)
      return false;
   return Load( pElem);
}

bool    TCSAdaBoostSign::Load (TiXmlElement* node)
{
   if (node == NULL)
    return false;
    m_TrainingSamples.Clear();
    m_TestingSamples.Clear();
    TiXmlElement* pElem = NULL;
    pElem = node-&gt;FirstChildElement();
    //Загрузка образцов для обучения
    DbgMsg( &quot;Loading training sets...\n&quot; );
    m_strBase2 = pElem-&gt;Attribute(&quot;database2&quot;);
    if (!LoadSamples( -1, m_strBase2 ))
        return false;
    m_numSamplesBase2 = m_TrainingSamples.GetCount();
    m_numSamplesTestBase2 = m_TestingSamples.GetCount();
    std::string m_strBase1 = pElem-&gt;Attribute(&quot;database1&quot;);
    if (!LoadSamples( 1,  m_strBase1))
        return false;
    m_numSamplesBase1 = (int)m_TrainingSamples.GetCount( ) - m_numSamplesBase2;
    m_numSamplesTestBase1 = (int)m_TestingSamples.GetCount( ) - m_numSamplesTestBase2;

    //
    double v;
    m_widthBase = 24;
    m_heightBase = 24;
    pElem-&gt;Attribute(&quot;w&quot;, &amp;v);
    m_widthBase = (int )v;
    pElem-&gt;Attribute(&quot;h&quot;, &amp;v);
    m_heightBase = (int )v;

    pElem = pElem-&gt;NextSiblingElement();
    double ni = 5;
    pElem-&gt;Attribute(&quot;maxi&quot;, &amp;ni);
    m_maxFeatures = (int)ni;


    DbgMsg( &quot;Samples to training for class 1 &quot; + TypeToStr(m_numSamplesBase1) +&quot;;\n&quot; );
    DbgMsg( &quot;Samples to training for class -1 &quot; + TypeToStr(m_numSamplesBase2) +&quot;;\n&quot; );
    DbgMsg( &quot;Samples to testing for class 1 &quot; + TypeToStr(m_numSamplesTestBase1) +&quot;;\n&quot; );
    DbgMsg( &quot;Samples to testing for class -1 &quot; + TypeToStr(m_numSamplesTestBase2) +&quot;;\n&quot; );

    // инициализация исходного массива признаков
   InitFeatures( );

    return true;
}

void TCSAdaBoostSign::SetLogName(char* lpLogName)
{
}

void TCSAdaBoostSign::SetLog1Name(char* lpLog1Name)
{
}


bool TCSAdaBoostSign::Boost()
{
    // Начало накачки.
    double wf   = 0.5/m_numSamplesBase1;
    double wnf = 0.5 / m_numSamplesBase2;

    DbgMsg(&quot;\nBoosting started.\n&quot;);

    // Установка начальных весов для обучающего набора m_TrainingSet
    for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
    {
        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
        if (s-&gt;GetFlag() == 1)
            s-&gt;SetWeight(wf);
        else if (s-&gt;GetFlag() == -1)
            s-&gt;SetWeight(wnf);
        else
            continue;
    }

    ProgressMeter progress;
    progress.Init( 30, (int)m_TrainingSamples.GetCount( ) );

    m_ResultClass.Clear();
    //m_trainData.clear();

    if ( m_Features.GetCount( ) == 0 ) return false;

    //Main loop;
    for ( int i = 0; i &lt; m_maxFeatures ; ++i )
    {

        DbgMsg( &quot;\nUpdating: &quot; );
        progress.Init( 30, m_Features.GetCount( ) );
        int count = 0;

//Update
#pragma omp parallel for reduction(+: count)
        for ( int w = 0; w &lt; m_Features.GetCount(); ++w )
        {
            ++count;
            TCSWeakSignTrainig* wcinfo = (TCSWeakSignTrainig*)m_Features.Get(w);
            wcinfo-&gt;SetEpsilon(0);

            //Train section;
            wcinfo-&gt;StartTraining();
            for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
               TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
               wcinfo-&gt;AddSample(s, s-&gt;GetFlag(), s-&gt;GetWeight());
            }
            wcinfo-&gt;Train();

            //Calc error;
            for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
                TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

                int res = wcinfo-&gt;Classify( s );

                if ( s-&gt;GetFlag() != res )
                {
                    wcinfo-&gt;SetEpsilon(wcinfo-&gt;GetEpsilon() + s-&gt;GetWeight());
                }
            }

            if ( progress.Update( ) )
                DbgMsg(&quot;&gt;&quot;);
        }

        DbgMsg( &quot;\n&quot; );
        printf( &quot;Count stage: %d \n&quot;, count );
        // выбор лучшего признака, по минимальной ошибке классификации на обучающем наборе.
        int bestWc = 0;
        for ( int w = 0; w &lt; m_Features.GetCount(); ++w )
        {
            TCSWeakSignTrainig* best       = (TCSWeakSignTrainig*)m_Features.Get(bestWc);
            TCSWeakSignTrainig* current    = (TCSWeakSignTrainig*)m_Features.Get(w);
            if ( best-&gt;GetEpsilon() &gt; current-&gt;GetEpsilon()  )
                bestWc = w;
        }
        TCSWeakSignTrainig* pWc       = (TCSWeakSignTrainig*)m_Features.Get(bestWc);
        pWc-&gt;SetWeight((double)pWc-&gt;GetEpsilon());

        // если ошибка лучшего классификатора превысила критический уровень 50%
        // прекращаем процесс накачки.
        if ( pWc-&gt;Weight() &gt; 0.49 ) break;


        //Update wc weight;
        double beta = pWc-&gt;Weight()/ (1 - pWc-&gt;Weight());
        double min_eps = pWc-&gt;Weight();
        pWc-&gt;SetWeight (log(1.0/beta));

        //Добавим &quot;слабый&quot; классификатор в &quot;комитет".
        m_ResultClass.AddWeak(pWc);
        
        // распечатка атрибутов классификатора
        DbgMsg( &quot;\nRound num = &quot; + TypeToStr(i + 1) +
            &quot;, min_eps = &quot; + TypeToStr(min_eps) +
            &quot;, beta = &quot; + TypeToStr( beta ) +
        &quot;, alpha = &quot;+ TypeToStr(pWc-&gt;Weight())+&quot;;\n&quot; );

        this-&gt;Statistics();
        // для каждого образца обновим веса
        double wt = 0;
        for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
        {
            TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

            int res = 0;
            double err = 0;
            res = pWc-&gt;Classify( s );

            if ( res == s-&gt;GetFlag() )
                s-&gt;SetWeight(s-&gt;GetWeight()*beta);
            wt += s-&gt;GetWeight();
        }

        //Normalize;
        wt = 1.0/wt;

        for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
        {
            TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
            s-&gt;SetWeight(s-&gt;GetWeight()*wt);
        }

        //Удалим найденный признак из списка признаков
        m_Features.Delete(bestWc);

    }
    //SaveROC();
    return true;
}
//
TCSStrongSign* TCSAdaBoostSign::GetResult()
{
  return &amp;m_ResultClass;
}

void    TCSAdaBoostSign::InitFeatures()
{
    m_Features.Clear();

   int sx = 1;
   int sy = 1;
   int w = 3;
   int h = 3;
   for (h = m_heightBase -3; h &gt;= 3; h-=3)
   {
       for (w = m_widthBase ; w &gt;= 3; w-=3)
       {
           for (sy = 1; sy &lt; m_heightBase - h - 1; sy++)
           {
               for (sx = 1; sx &lt; m_widthBase - w - 1; sx++)
               {
                   TCSSensor Sensor(sx, sy, w / 3, h / 3);
                   TCSWeakSignTrainig* wt = new TCSWeakSignTrainig(Sensor);
                   m_Features.Add(wt);
               }
           }
       }
   }
}

bool    TCSAdaBoostSign::LoadSamples(int flag, std::string const&amp; path)
{
    DbgMsg( &quot;Loading samples from &quot; + path + &quot;... &quot; );

    int count = 0;
    srand( (unsigned)time( NULL ) );
    int RANGE_MIN = 0;
    int RANGE_MAX = 3;

#ifdef WIN32
    intptr_t handle = 0;
    _finddata_t filesInfo;
    if ( (handle = _findfirst( (char*)((path+&quot;*.jpg&quot;).c_str()), &amp;filesInfo)) != -1 )
    {
        do
        {
           string name = path + filesInfo.name;
        
            TCSSample* pSample = new TCSSample();
            pSample-&gt;LoadFromFile((char*)name.c_str());

    //        if (pSample-&gt;Process())
            {
                pSample-&gt;SetFlag(flag);
                int r = (int)(((double) rand() / (double) RAND_MAX) * RANGE_MAX + RANGE_MIN);

                //int  r = rand(0);
                if (r &gt; 0)
                    m_TrainingSamples.Add(pSample);
                else
                    m_TestingSamples.Add(pSample);

                ++count;
            }
//            else
//printf( &quot;Can&#39;t load image %s.\n&quot;, name.c_str( ) );
        }while(!_findnext( handle, &amp;filesInfo ));


    }
    _findclose( handle );

#else

//    struct dirent** namelist;
//    if(( count = scandir( path.c_str(), &amp;namelist, jpg_filter, alphasort )) &lt; 0 )
//            return 0;

//    for( int i=0; i&lt;count; i++ )
//    {
//            string name = path + namelist[i]-&gt;d_name;

//            TCSSample* pSample = new TCSSample();
//            pSample-&gt;LoadImage((char*)name.c_str());


//                pSample-&gt;SetFlag(flag);
//              int r = (((double) rand() / (double) RAND_MAX) * RANGE_MAX + RANGE_MIN);

//                //int  r = rand(0);
//                if (r &gt; 0)
//                    m_TrainingSamples.Add(pSample);
//                else
//                    m_TestingSamples.Add(pSample);

//    }

#endif

    DbgMsg( TypeToStr( count ) + &quot; ok\n&quot; );
    return count &gt; 0;
}
void    TCSAdaBoostSign::DbgMsg( std::string const&amp; msg)
{
    std::cout&lt;&lt; msg;  
#ifdef WIN32
    m_flog &lt;&lt; msg;
    m_flog.flush();
#endif
}

void    TCSAdaBoostSign::Statistics()
{
    double errt[2] = {0,0};
    double err1[2] = { 0, 0 };
    double err2[2] = { 0, 0 };
    double erru[2] = { 0, 0 };
    for (  int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
    {

        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

        double err = 0;
        //double factor = (double)(s-&gt;GetImage()-&gt;sSizeX)/24.0;
        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        m_ResultClass.Setup(r, m_widthBase);

        int res = m_ResultClass.Classify( s-&gt;GetIntegralImage(), err );
        if (res != s-&gt;GetFlag())
        {
              errt[0]++;
              if (res == 0)
                erru[0]++;
              if (res == 1)
                err2[0]++;
              if (res == -1)
                err1[0]++;
        }
    }
    errt[0] /= m_TrainingSamples.GetCount();
    errt[0] *= 100;

    err1[0] /= (m_numSamplesBase1);
    err1[0] *= 100;

    err2[0] /= (m_numSamplesBase2);
    err2[0] *= 100;

    erru[0] /= m_TrainingSamples.GetCount();
    erru[0] *= 100;
    for (  int i = 0; i &lt; m_TestingSamples.GetCount(); i++ )
    {

        TCSSample* s = (TCSSample*)m_TestingSamples.Get(i);

        double err = 0;
        //double factor = (double)(s-&gt;GetImage()-&gt;sSizeX)/24.0;
        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        m_ResultClass.Setup(r, m_widthBase);

        int res = m_ResultClass.Classify( s-&gt;GetIntegralImage(), err );
        if (res != s-&gt;GetFlag())
        {
              errt[1]++;
              if (res == 0)
                erru[1]++;
              if (res == 1)
                err2[1]++;
              if (res == -1)
                err1[1]++;
        }
    }
    if (m_TestingSamples.GetCount() &gt; 0)
    {
    errt[1] /= m_TestingSamples.GetCount();
    errt[1] *= 100;

    err1[1] /= (m_numSamplesTestBase1);
    err1[1] *= 100;
    err2[1] /= (m_numSamplesTestBase2);
    err2[1] *= 100;


    erru[1] /= m_TestingSamples.GetCount();
    erru[1] *= 100;
    }

    DbgMsg( &quot;errt = &quot; + TypeToStr( errt[0] ) + &quot; % &quot; + TypeToStr( errt[1] ) + &quot;%;\n&quot; );
    DbgMsg( &quot;err1 = &quot; + TypeToStr( err1[0] ) + &quot; % &quot; + TypeToStr( err1[1] ) + &quot;%;\n&quot; );
    DbgMsg( &quot;err2 = &quot; + TypeToStr( err2[0] ) + &quot; % &quot; + TypeToStr( err2[1] ) + &quot;%;\n&quot;  );
    DbgMsg( &quot;erru = &quot; + TypeToStr( erru[0] ) + &quot; % &quot; + TypeToStr( erru[1] ) + &quot;%;\n&quot; );
}


struct roc_entry
{
    double far1;
    double frr1;
    double far2;
    double frr2;
};
void TCSAdaBoostSign::SaveROC(char*lpName)
{
 //
    double* fSourceClass1 = NULL;
    double* fSourceClass2 = NULL;
    roc_entry roc[100];
    memset(roc,0, sizeof(roc));
    fSourceClass1 = (double*)malloc(m_numSamplesTestBase1*sizeof(double));
    fSourceClass2 = (double*)malloc(m_numSamplesTestBase2*sizeof(double));
    memset(fSourceClass1, 0, m_numSamplesTestBase1*sizeof(double));
    memset(fSourceClass2, 0, m_numSamplesTestBase2*sizeof(double));
    int nc1 =0;
    int nc2 =0;

    for (int i = 0; i &lt; m_TestingSamples.GetCount(); i++)
    {
        TCSSample* s = (TCSSample*)m_TestingSamples.Get(i);

        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        m_ResultClass.Setup(r, m_widthBase);
        double err = 0;
        m_ResultClass.Classify( s-&gt;GetIntegralImage(), err );
        if (s-&gt;GetFlag() == 1)
        {
            fSourceClass1[nc1] = err;
            nc1++;
        }
        else
        {
            fSourceClass2[nc2] = err;
            nc2++;
        }
    }

    double tau = m_ResultClass.GetSumWeakWeight();

    DbgMsg( TypeToStr( tau ) + &quot;\n&quot; );

    double delta = tau / 50.f;
    double stau = -tau;
    int c = 0;
    while(stau &lt; tau)
    {
        for (int i=0; i&lt; nc1; i++)
        {
            if (fSourceClass1[i] &lt; stau)
                roc[c].frr1++;
            if (fSourceClass1[i] &lt; stau)
                roc[c].far2++;
        }
        for (int i=0; i&lt; nc2; i++)
        {
            if (fSourceClass2[i] &gt; stau)
                roc[c].far1++;
            if (fSourceClass2[i] &gt; stau)
                roc[c].frr2++;
        }

        stau += delta;
        c++;
    }
    DbgMsg( TypeToStr( c ) + &quot;\n&quot; );
    for (int i = 0; i &lt; 100; i++)
    {
        roc[i].far1 = 100.f*roc[i].far1/nc2;
        roc[i].frr1 = 100.f*roc[i].frr1/nc1;
        roc[i].far2 = 100.f*roc[i].far2/nc1;
        roc[i].frr2 = 100.f*roc[i].frr2/nc2;
    }
//  std::ostream*       f;
//  f = new ofstream(&quot;roc.txt&quot;);
//  for (int i = 0; i &lt; 100; i++)
//      (*f) &lt;&lt; roc[i].far1 &lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr1&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].far2&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr2 &lt;&lt;&quot;\n&quot;;
//  delete f;
    FILE* f = fopen (lpName, &quot;w+t&quot;);
    for (int i = 0; i &lt; 100; i++)
    {
//      fprintf(f, &quot;%f\n&quot;, roc[i].far1);
        fprintf(f, &quot;%f\t%f\t%f\t%f\n&quot;, roc[i].far1, roc[i].frr1, roc[i].far2,roc[i].frr2);
    }
    //  (*f) &lt;&lt; roc[i].far1 &lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr1&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].far2&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr2 &lt;&lt;&quot;\n&quot;;
    fclose(f);
    free(fSourceClass1);
    free(fSourceClass2);
}

TIEFSAdaBoost::TIEFSAdaBoost()
{
    m_numIFS = 0;
    m_numEFS = 0;
    m_strSourceFile = &quot;&quot;;
    m_pLog = NULL;
}

bool TIEFSAdaBoost::Load(const char* lpFileName)
{
    /*попытка открыть файл конфигурации*/
    TiXmlDocument doc(lpFileName);
    if (!doc.LoadFile())
        return false;
    TiXmlElement* e = doc.FirstChildElement(&quot;IEFSBoost&quot;);
    if (e == NULL)
        return false;
    m_strSourceFile = e-&gt;Attribute(&quot;file&quot;);
    string str = e-&gt;Attribute(&quot;log&quot;);

    if (m_pLog == NULL)
        m_pLog = new ofstream(str.c_str());

    return LoadSamples();
}
// распечатка сообщения на экране и в лог файле
void TIEFSAdaBoost::DbgMsg(std::string const&amp; msg)
{
    (*m_pLog) &lt;&lt; msg;
    cout &lt;&lt; msg;
    flush(*m_pLog);
}

bool TIEFSAdaBoost::Boost()
{
    // Начало накачки.
    double wf  = 0.5 / this-&gt;m_numIFS;
    double wnf = 0.5 / this-&gt;m_numEFS;

    DbgMsg(&quot;\nBoosting started.\n&quot;);

    // Установка начальных весов для обучающего набора m_TrainingSet
    for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
    {
        TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
        if (s-&gt;GetFlag() == 1)
            s-&gt;SetWeight(wf);
        else if (s-&gt;GetFlag() == 0)
            s-&gt;SetWeight(wnf);
        else
            continue;
    }

    ProgressMeter progress;
    progress.Init(30, (int)m_TrainingSamples.GetCount());
    // result class 
    m_ResultClass.Clear();

    if (m_Features.GetCount() == 0)
        return false;

    //Main loop;
    //for (int i = 0; i &lt; this-&gt;m_Features.GetCount(); ++i)
    int i = 0;
    while (this-&gt;m_Features.GetCount() &gt; 0)
    {
        i++;
        DbgMsg(&quot;\nUpdating: &quot;);
        progress.Init(30, m_Features.GetCount());
        int count = 0;

        //Update
#pragma omp parallel for reduction(+: count)
        for (int w = 1; w &lt; m_Features.GetCount(); ++w)
        {
            ++count;
            TIEFSWeak2* wcinfo = (TIEFSWeak2*)m_Features.Get(w);
            if (!wcinfo-&gt;IsFree())
                continue;
            wcinfo-&gt;SetEpsilon(0);

            //Train section;
            wcinfo-&gt;StartTraining();
            for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
                TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
                wcinfo-&gt;AddSample(s);
            }
            wcinfo-&gt;Train();

            //Calc error;
            for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
                TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);

                int res = wcinfo-&gt;Classify(s-&gt;GetValue(w));

                if (s-&gt;GetFlag() != res)
                {
                    wcinfo-&gt;SetEpsilon(wcinfo-&gt;GetEpsilon() + s-&gt;GetWeight());
                }
            }

            if (progress.Update())
                DbgMsg(&quot;&gt;&quot;);
        }

        DbgMsg(&quot;\n&quot;);
        DbgMsg(&quot;Count stage: %d \n&quot; + TypeToStr(count));
        // выбор лучшего признака, по минимальной ошибке классификации на обучающем наборе.
        int bestWc = 1;
        while (!((TIEFSWeak2*)m_Features.Get(bestWc))-&gt;IsFree())
            bestWc++;
        for (int w = bestWc +1; w &lt; m_Features.GetCount(); ++w)
        {
            
            TIEFSWeak2* best = (TIEFSWeak2*)m_Features.Get(bestWc);
            TIEFSWeak2* current = (TIEFSWeak2*)m_Features.Get(w);
            if (!current-&gt;IsFree())
                continue;
            if (best-&gt;GetEpsilon() &gt; current-&gt;GetEpsilon())
                bestWc = w;
        }
        TIEFSWeak* pWc = (TIEFSWeak*)m_Features.Get(bestWc);
        pWc-&gt;SetWeight(pWc-&gt;GetEpsilon());

        // если ошибка лучшего классификатора превысила критический уровень 50%
        // прекращаем процесс накачки.
        if (pWc-&gt;GetWeight() &gt;= 0.5)
        {
        
            DbgMsg(&quot;\n Min eps = 0.5. Break.\n&quot;);
            break;
        }


        //Update wc weight;
        double beta = pWc-&gt;GetWeight() / (1 - pWc-&gt;GetWeight());
        double min_eps = pWc-&gt;GetWeight();
        pWc-&gt;SetWeight(log(1.0 / beta)); 

        //Добавим &quot;слабый&quot; классификатор в &quot;комитет".
        //result class  
        m_ResultClass.Add(pWc-&gt;Clone());
        m_ResultClass.SetThreshold(m_ResultClass.GetSumWeakWeight() / 2);
        pWc-&gt;Lock();
        // распечатка атрибутов классификатора
        DbgMsg(&quot;\nRound num = &quot; + TypeToStr(i + 1) +
            &quot;, min_eps = &quot; + TypeToStr(min_eps) +
            &quot;, beta = &quot; + TypeToStr(beta) +
            &quot;, alpha = &quot; + TypeToStr(pWc-&gt;GetWeight()) + &quot;;\n&quot;);
        // распечатка атрибутов выбранного признака
        DbgMsg(&quot;Feature num = &quot; + TypeToStr(pWc-&gt;GetIndex()) + &quot;\n&quot; );

        //распечатка ошибки на тестовом наборе.
        PrintStatistics();


        // для каждого образца обновим веса
        double wt = 0;
        for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
        {
            TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);

            int res = 0;

            res = pWc-&gt;Classify(s-&gt;GetValue(pWc-&gt;GetIndex()));

            if (res == s-&gt;GetFlag())
            {
                s-&gt;SetWeight(s-&gt;GetWeight()*beta);
            }
            wt += s-&gt;GetWeight();
        }

        //Normalize;
        wt = 1.0 / wt;
        double sum = 0;
        for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
        {
            TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
            s-&gt;SetWeight(s-&gt;GetWeight()*wt);
            sum += s-&gt;GetWeight();
        }
        DbgMsg(&quot;sum  = &quot; + TypeToStr(sum) + &quot;\n&quot;);
        //Удалим найденный признак из списка признаков
      //m_Features.Delete(bestWc);

    }

    this-&gt;m_ResultClass.SaveXML(&quot;IEFSclass.xml&quot;);
    if (this-&gt;m_ResultClass.LoadXML(&quot;IEFSclass.xml&quot;))
    {
        DbgMsg(&quot;Work done.\n\n&quot;);
        this-&gt;PrintStatistics();
        DbgMsg(&quot;Bye!\n&quot;);
        return true;
    }
    else
        return false;
}
double  TIEFSAdaBoost::PrintStatistics()
{
    double          dFar = 0, dFrr = 0;

    for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
    {
        TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
        double err = m_ResultClass.Raiting(s);
        if (s-&gt;GetFlag() == 1)
        {
            if (err &lt; m_ResultClass.GetThreshold()) dFrr += 1.0;
        }
        else
        {
            if (err &gt;= m_ResultClass.GetThreshold())
            {
                dFar += 1.0;
            }
        }
    }

    dFrr /= this-&gt;m_numIFS;
    dFar /= this-&gt;m_numEFS;

    DbgMsg(&quot;\nFAR = &quot; + TypeToStr(dFar) +
        &quot;, FRR = &quot; + TypeToStr(dFrr) +
        &quot;, threshold = &quot; + TypeToStr(m_ResultClass.GetThreshold()) + &quot;;\n&quot;);

    return 0;
}

bool TIEFSAdaBoost::InitFeatures(int num)
{
    if (num &lt;= 0)
    {
        DbgMsg(&quot;Invalid num features: num = &quot; +TypeToStr (num) + &quot;\n&quot;);
        return false;
    }
    for (int i = 0; i &lt; num; i++)
    {
        TIEFSWeak2* w = new TIEFSWeak2(i);
        this-&gt;m_Features.Add(w);
    }
    DbgMsg(TypeToStr(num) + &quot;features created.\n&quot;);
    return true;
}
bool TIEFSAdaBoost::LoadSamples()
{
    DbgMsg(&quot;Loading samples...\n&quot;);
    awpImage* img = NULL;
    if (awpLoadImage(this-&gt;m_strSourceFile.c_str(), &amp;img) != AWP_OK)
    {
        DbgMsg(&quot;Cannot load featues from &quot; + m_strSourceFile + &quot;\n&quot;);
        return false;
    }
    int num = img-&gt;sSizeX - 1;
    double* diff = (double*)malloc(num*sizeof(double));
    if (!this-&gt;InitFeatures(num))
    {
        awpReleaseImage(&amp;img);
        free(diff);
        return false;
    }
    double* d = (double*)img-&gt;pPixels;
    int ifs_count = 0;
    int efs_count = 0;
    for (int i = 0; i &lt; img-&gt;sSizeY; i++)
    {
        int id1 = (int)d[i*img-&gt;sSizeX];
        for (int j = i + 1; j &lt; img-&gt;sSizeY; j++)
        {
            int id2 = (int)d[j*img-&gt;sSizeX];
            int flag = id1 == id2 ? 1 : 0;
            if (!flag &amp;&amp; efs_count &gt; 730000)
                continue;
            if (flag)
                ifs_count++;
            else
                efs_count++;

            for (int k = 1; k &lt;= num; k++)
            {
                diff[k-1] = fabs(d[i*img-&gt;sSizeX + k] - d[j*img-&gt;sSizeX + k]);
            }
            TIEFSSample* s = new TIEFSSample(diff, num, flag);
            this-&gt;m_TrainingSamples.Add(s);
        }
    }
    this-&gt;m_numIFS = ifs_count;
    this-&gt;m_numEFS = efs_count;

    awpReleaseImage(&amp;img);
    free(diff);
    DbgMsg(&quot;IFS samples loaded = &quot; + TypeToStr(m_numIFS) + &quot;\n&quot;);
    DbgMsg(&quot;EFS samples loaded = &quot; + TypeToStr(m_numEFS) + &quot;\n&quot;);
    return true;
}
</span> </div>
<div class="line"><a name="l00303"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#a77eb86bd34daabfe2b39a8df4fc7ddd8">  303</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_t_c_s_ada_boost.html#a77eb86bd34daabfe2b39a8df4fc7ddd8">TCSAdaBoost::DbgMsg</a>( std::string <span class="keyword">const</span>&amp; msg)</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;{</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    (*m_pLog) &lt;&lt; msg;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    cout &lt;&lt; msg;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    flush( *m_pLog );</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;}</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160; </div>
<div class="line"><a name="l00310"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#a7e51aea6cf28d6028c4e0e4d22baefed">  310</a></span>&#160;std::string <a class="code" href="class_t_c_s_ada_boost.html#a7e51aea6cf28d6028c4e0e4d22baefed">TCSAdaBoost::GetArtefactsBase</a>()</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;{</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordflow">return</span> m_strArtefactsBase;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;}</div>
<div class="line"><a name="l00314"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#a5706b327fb1b96b4aa6f5da2c3d63936">  314</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_t_c_s_ada_boost.html#a5706b327fb1b96b4aa6f5da2c3d63936">TCSAdaBoost::SetArtefactsBase</a>(std::string str)</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;{</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    m_strArtefactsBase = str;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;}</div>
<div class="line"><a name="l00318"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#ace23c4878d8742f79b7b4f363ad499f5">  318</a></span>&#160;std::string <a class="code" href="class_t_c_s_ada_boost.html#ace23c4878d8742f79b7b4f363ad499f5">TCSAdaBoost::GetObjectsBase</a>()</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;{</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keywordflow">return</span> m_strObjectsbase;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;}</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#a76e6ced3af8b37e19f5194a54d23010b">  323</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_t_c_s_ada_boost.html#a76e6ced3af8b37e19f5194a54d23010b">TCSAdaBoost::SetObjectsBase</a>(std::string str)</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;{</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    m_strObjectsbase = str;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;}</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; </div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">// возвращает ширину и высоту изображений, которые используются</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">// для обучения</span></div>
<div class="line"><a name="l00330"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#acf0de0253caef63ac103acba0490f14b">  330</a></span>&#160;AWPWORD <a class="code" href="class_t_c_s_ada_boost.html#acf0de0253caef63ac103acba0490f14b">TCSAdaBoost::WidthBase</a>()</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;{</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="keywordflow">return</span> m_widthBase;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;}</div>
<div class="line"><a name="l00334"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#a702566e5657000a1487424c2a9e17ef6">  334</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_t_c_s_ada_boost.html#a702566e5657000a1487424c2a9e17ef6">TCSAdaBoost::SetWidthBase</a>(AWPWORD value)</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;{</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    m_widthBase = value;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;}</div>
<div class="line"><a name="l00338"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#ab538a55ee5d43e8ac16635dcf80dc477">  338</a></span>&#160;AWPWORD <a class="code" href="class_t_c_s_ada_boost.html#ab538a55ee5d43e8ac16635dcf80dc477">TCSAdaBoost::HeightBase</a>()</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;{</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordflow">return</span> m_heightBase;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;}</div>
<div class="line"><a name="l00342"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#a956f0e368647d923e9a245fe925a71bd">  342</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_t_c_s_ada_boost.html#a956f0e368647d923e9a245fe925a71bd">TCSAdaBoost::SetHeightBase</a>(AWPWORD value)</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;{</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    m_heightBase = value;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;}</div>
<div class="line"><a name="l00346"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#a40193e7ace16b7a7ee4a976403288638">  346</a></span>&#160;<a class="code" href="group___l_f_c_s_boost.html#ga61566a81227afa5a090795b458850b90">TErrTrainData</a>&amp; <a class="code" href="class_t_c_s_ada_boost.html#a40193e7ace16b7a7ee4a976403288638">TCSAdaBoost::GetTrainData</a>()</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;{</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keywordflow">return</span> m_trainData;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;}</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160; </div>
<div class="line"><a name="l00351"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#a6e1bc6f1906839b6b172210710a170d8">  351</a></span>&#160;<a class="code" href="class_t_c_s_strong.html">TCSStrong</a>* <a class="code" href="class_t_c_s_ada_boost.html#a6e1bc6f1906839b6b172210710a170d8">TCSAdaBoost::GetClass</a>()</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;{</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordflow">return</span> &amp;m_ResultClass;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;}</div>
<div class="line"><a name="l00355"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#ad87e94ca936e2107579753545d135a00">  355</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="class_t_c_s_ada_boost.html#ad87e94ca936e2107579753545d135a00">TCSAdaBoost::GetFeaturesCount</a>()</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;{</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="keywordflow">return</span> m_nFeaturesCount;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;}</div>
<div class="line"><a name="l00359"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#af079a2284199516e56ee77186fa370b6">  359</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_t_c_s_ada_boost.html#af079a2284199516e56ee77186fa370b6">TCSAdaBoost::SetFeaturesCount</a>(<span class="keywordtype">int</span> value)</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;{</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    m_nFeaturesCount = value;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;}</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160; </div>
<div class="line"><a name="l00364"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#af38dcafbc149c80566883cf1b7ff0d35">  364</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="class_t_c_s_ada_boost.html#af38dcafbc149c80566883cf1b7ff0d35">TCSAdaBoost::GetFinishFar</a>()</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;{</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">return</span> this-&gt;m_FinishFar;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;}</div>
<div class="line"><a name="l00368"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#a6cbbf31deb19f84b7dc4ec50f453fe16">  368</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_t_c_s_ada_boost.html#a6cbbf31deb19f84b7dc4ec50f453fe16">TCSAdaBoost::SetFinishFar</a>(<span class="keywordtype">double</span> value)</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;{</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    this-&gt;m_FinishFar = value;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;}</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160; </div>
<div class="line"><a name="l00373"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#ae8000e604885d5ae921d4ab35e869a0d">  373</a></span>&#160;std::string <a class="code" href="class_t_c_s_ada_boost.html#ae8000e604885d5ae921d4ab35e869a0d">TCSAdaBoost::GetPath</a>()</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;{</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordflow">return</span> this-&gt;m_strPath;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;}</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160; </div>
<div class="line"><a name="l00378"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#a0a5cef7f78f97944618f862ae40e2af6">  378</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_t_c_s_ada_boost.html#a0a5cef7f78f97944618f862ae40e2af6">TCSAdaBoost::SetPath</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* lpPath)</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;{</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    this-&gt;m_strPath = lpPath;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;}</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160; </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> _IsImageFile(std::string&amp; strFileName)</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;{</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    std::string strExt = <a class="code" href="group___l_f_file_utils.html#ga44ffb6b1e2eed50aab82f624d4f4d2d8">LFGetFileExt</a>(strFileName);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    std::transform(strExt.begin(), strExt.end(), strExt.begin(), ::tolower);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160; </div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="keywordflow">if</span> (strExt == <span class="stringliteral">&quot;.awp&quot;</span>)</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordflow">if</span> (strExt == <span class="stringliteral">&quot;.jpg&quot;</span>)</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keywordflow">if</span> (strExt == <span class="stringliteral">&quot;.jpeg&quot;</span>)</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keywordflow">if</span> (strExt == <span class="stringliteral">&quot;.png&quot;</span>)</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">if</span> (strExt == <span class="stringliteral">&quot;.bmp&quot;</span>)</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;}</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160; </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment">// загружает образцы для обучения из директории path и сохраняет их в списке объектов </span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">// SampleList. в зависимости от установленного флага flag образцы считаются образцами </span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">// объектов или образцами фонов. flag = 1 соответствует образцам объектов, flag = 0 - </span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">// соответствует образцам фонов.</span></div>
<div class="line"><a name="l00405"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#a7f9651836ba37c4e908ede280ebc1506">  405</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_t_c_s_ada_boost.html#a7f9651836ba37c4e908ede280ebc1506">TCSAdaBoost::LoadSample</a>(<a class="code" href="class_t_l_f_object_list.html">TLFObjectList</a>&amp; SampleList, <span class="keywordtype">int</span> flag, std::string <span class="keyword">const</span>&amp; path)</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;{</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    DbgMsg( <span class="stringliteral">&quot;Loading samples from &quot;</span> + path + <span class="stringliteral">&quot;... \n&quot;</span> );</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="keywordtype">int</span> count = 0;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <a class="code" href="group___l_f_file_utils.html#gae68de90c59402f90b8b0699aab8734b4">TLFStrings</a> <a class="code" href="_l_f_attr_filter_8h.html#a7d9df0b08f5a808d295f7a8335151070">names</a>;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="group___l_f_file_utils.html#gab674fd8c9eb4e9e30e932fb9cffe1b2c">LFGetDirFiles</a>(path.c_str(), <a class="code" href="_l_f_attr_filter_8h.html#a7d9df0b08f5a808d295f7a8335151070">names</a>))</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    {</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        DbgMsg(<span class="stringliteral">&quot;Reading names failed.&quot;</span>);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    }</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_l_f_attr_filter_8h.html#a7d9df0b08f5a808d295f7a8335151070">names</a>.size() == 0)</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    {</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        DbgMsg(<span class="stringliteral">&quot;Database is empty.&quot;</span>);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    }</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    DbgMsg(<span class="stringliteral">&quot;Reading &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(<a class="code" href="_l_f_attr_filter_8h.html#a7d9df0b08f5a808d295f7a8335151070">names</a>.size()) + <span class="stringliteral">&quot; files.\n&quot;</span>);</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="_l_f_attr_filter_8h.html#a7d9df0b08f5a808d295f7a8335151070">names</a>.size(); i++)</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    {</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <span class="keywordtype">string</span> name = <a class="code" href="_l_f_attr_filter_8h.html#a7d9df0b08f5a808d295f7a8335151070">names</a>[i];</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        <span class="keywordflow">if</span> (!_IsImageFile(name))</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        <a class="code" href="class_t_c_s_sample.html">TCSSample</a>* pSample = <span class="keyword">new</span> <a class="code" href="class_t_c_s_sample.html">TCSSample</a>();</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        <span class="comment">//DbgMsg(name + &quot;\n&quot;);</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        pSample-&gt;<a class="code" href="class_t_l_f_image.html#a55e5fc3eca44bdb372e8da303cdc086d">LoadFromFile</a>((<span class="keywordtype">char</span>*)name.c_str());</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        <span class="keywordtype">double</span> e = 0;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        <span class="keywordflow">if</span> (pSample-&gt;<a class="code" href="class_t_l_f_image.html#a5a44ea86ac3f94f530665d047f95cc69">GetImage</a>()-&gt;sSizeX &lt; this-&gt;m_widthBase || pSample-&gt;<a class="code" href="class_t_l_f_image.html#a5a44ea86ac3f94f530665d047f95cc69">GetImage</a>()-&gt;sSizeY &lt; this-&gt;m_heightBase)</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        {</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            <span class="keyword">delete</span> pSample;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        }</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        awpImage* img = pSample-&gt;<a class="code" href="class_t_l_f_image.html#a68b8ec8cae38332cfefa664792f06c31">GetIntegralImage</a>();</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <span class="keywordflow">if</span> (img == NULL)</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        pSample-&gt;<a class="code" href="class_t_l_f_image.html#a243c41e1d0e48ca6000346014892c2ab">GetSqIntegralImage</a>();</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="keywordtype">bool</span> need_process = flag == 1 ? true : <span class="keyword">false</span>;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        pSample-&gt;<a class="code" href="class_t_c_s_sample.html#ade35a9425888f07126fa206476aad40a">SetFlag</a>(flag);</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        SampleList.<a class="code" href="class_t_l_f_object_list.html#aeea56aec3018d7a253cb9af571a0cfd7">Add</a>(pSample);</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        ++count;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160; </div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    DbgMsg(<a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(count) + <span class="stringliteral">&quot; ok\n&quot;</span>);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">return</span> count &gt; 0;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160; </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;}</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00450"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#aa33161ad390db461c9cc6903cd6400dc">  450</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_t_c_s_ada_boost.html#aa33161ad390db461c9cc6903cd6400dc">TCSAdaBoost::InitFeatures</a>()</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;{</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;   </div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    DbgMsg(<span class="stringliteral">&quot;AdaBoost: init features .... &quot;</span>);</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    srand(11);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    m_Features.Clear();</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;   <span class="keywordtype">int</span> sx = 1;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;   <span class="keywordtype">int</span> sy = 1;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;   <span class="keywordtype">int</span> w = 3;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;   <span class="keywordtype">int</span> h = 3;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;   <span class="keywordflow">for</span> (h = m_heightBase; h &gt;= 3; h-=1)</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;   {</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;       <span class="keywordflow">for</span> (w = m_widthBase; w &gt;= 3; w-=1)</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;       {</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;           <span class="keywordflow">for</span> (sy = 0; sy &lt;= m_heightBase - h -3; sy++)</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;           {</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;               <span class="keywordflow">for</span> (sx = 0; sx &lt;= m_widthBase - w -3; sx++)</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;               {</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                   </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                   <span class="keywordtype">bool</span> skip = <span class="keyword">false</span>;<span class="comment">// (rand() % 10) &gt; 2;</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                   <span class="keywordflow">if</span> (skip)</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                       <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                   <a class="code" href="class_t_c_s_weak_training.html">TCSWeakTraining</a>* wt = NULL;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                   <a class="code" href="class_t_l_f_v_feature.html">TLFVFeature</a> Sensor0(sx, sy, w/2, h);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                   wt = <span class="keyword">new</span> <a class="code" href="class_t_c_s_weak_training.html">TCSWeakTraining</a>(&amp;Sensor0);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                   <span class="keywordflow">if</span> (this-&gt;m_VFeature)</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                       m_Features.Add(wt);</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                       <span class="keyword">delete</span> wt;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                   <a class="code" href="class_t_l_f_h_feature.html">TLFHFeature</a> Sensor1(sx, sy, w, h/2);</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                   wt = <span class="keyword">new</span> <a class="code" href="class_t_c_s_weak_training.html">TCSWeakTraining</a>(&amp;Sensor1);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                   <span class="keywordflow">if</span> (this-&gt;m_HFeature)</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                    m_Features.Add(wt);</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                       <span class="keyword">delete</span> wt;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                   <a class="code" href="class_t_l_f_d_feature.html">TLFDFeature</a> Sensor2(sx, sy, w / 2, h / 2);</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                   wt = <span class="keyword">new</span> <a class="code" href="class_t_c_s_weak_training.html">TCSWeakTraining</a>(&amp;Sensor2);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                   <span class="keywordflow">if</span> (this-&gt;m_DFeature)</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                    m_Features.Add(wt);</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                       <span class="keyword">delete</span> wt;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                   <a class="code" href="class_t_l_f_c_feature.html">TLFCFeature</a> Sensor3(sx, sy, w / 3, h / 3);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                   wt = <span class="keyword">new</span> <a class="code" href="class_t_c_s_weak_training.html">TCSWeakTraining</a>(&amp;Sensor3);</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                   <span class="keywordflow">if</span> (this-&gt;m_CFeature)</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                    m_Features.Add(wt);</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                       <span class="keyword">delete</span> wt;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                   <a class="code" href="class_t_c_s_sensor.html">TCSSensor</a> Sensor4(sx, sy, w / 3, h / 3);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                   wt = <span class="keyword">new</span> <a class="code" href="class_t_c_s_weak_training.html">TCSWeakTraining</a>(&amp;Sensor4);</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                   <span class="keywordflow">if</span> (this-&gt;m_CSFeature)</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                    m_Features.Add(wt);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                       <span class="keyword">delete</span> wt;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                   <a class="code" href="class_t_l_f_l_b_p_feature.html">TLFLBPFeature</a> Sensor5(sx, sy, w / 3, h / 3);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                   wt = <span class="keyword">new</span> <a class="code" href="class_t_c_s_weak_training.html">TCSWeakTraining</a>(&amp;Sensor5);</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                   <span class="keywordflow">if</span> (this-&gt;m_LBPFeature)</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                    m_Features.Add(wt);</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                       <span class="keyword">delete</span> wt;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160; </div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                   <a class="code" href="class_t_l_f_v_a_feature.html">TLFVAFeature</a> Sensor6(sx, sy, w / 2, h);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                   wt = <span class="keyword">new</span> <a class="code" href="class_t_c_s_weak_training.html">TCSWeakTraining</a>(&amp;Sensor6);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                   <span class="keywordflow">if</span> (this-&gt;m_VAFeature)</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                       m_Features.Add(wt);</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                       <span class="keyword">delete</span> wt;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                   <a class="code" href="class_t_l_f_h_a_feature.html">TLFHAFeature</a> Sensor7(sx, sy, w, h / 2);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                   wt = <span class="keyword">new</span> <a class="code" href="class_t_c_s_weak_training.html">TCSWeakTraining</a>(&amp;Sensor7);</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                   <span class="keywordflow">if</span> (this-&gt;m_HAFeature)</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                       m_Features.Add(wt);</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                       <span class="keyword">delete</span> wt;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                   <a class="code" href="class_t_l_f_d_a_feature.html">TLFDAFeature</a> Sensor8(sx, sy, w / 2, h / 2);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                   wt = <span class="keyword">new</span> <a class="code" href="class_t_c_s_weak_training.html">TCSWeakTraining</a>(&amp;Sensor8);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                   <span class="keywordflow">if</span> (this-&gt;m_DAFeature)</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                       m_Features.Add(wt);</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                       <span class="keyword">delete</span> wt;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                   <a class="code" href="class_t_l_f_c_a_feature.html">TLFCAFeature</a> Sensor9(sx, sy, w / 3, h / 3);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                   wt = <span class="keyword">new</span> <a class="code" href="class_t_c_s_weak_training.html">TCSWeakTraining</a>(&amp;Sensor9);</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                   <span class="keywordflow">if</span> (this-&gt;m_CAFeature)</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                       m_Features.Add(wt);</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                       <span class="keyword">delete</span> wt;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                   <span class="comment">//TLFColorSensor9Bit Sensor10(sx,sy,w,h);</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                   <span class="comment">//wt = new TCSWeakTraining(&amp;Sensor10);</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                   <span class="comment">//m_Features.Add(wt);</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;               }</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;           }</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;       }</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;   }</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;   DbgMsg(<span class="stringliteral">&quot; done .\n&quot;</span>);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;   DbgMsg( <span class="stringliteral">&quot;AdaBoost: Initiated &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>( m_Features.GetCount() )+<span class="stringliteral">&quot; features.\n&quot;</span> );</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;}</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160; </div>
<div class="line"><a name="l00546"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#aebbbd76efc2ef6fd037ed5182590bc4a">  546</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_t_c_s_ada_boost.html#aebbbd76efc2ef6fd037ed5182590bc4a">TCSAdaBoost::PrintFeature</a>(<a class="code" href="class_i_l_f_feature.html">ILFFeature</a>* pSensor)</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;{</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    DbgMsg( <span class="stringliteral">&quot;Found feature:&quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(pSensor-&gt;<a class="code" href="class_i_l_f_feature.html#a6cbae80d7cb7af820662e380497b5e5f">GetName</a>()) + <span class="stringliteral">&quot; x = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>( pSensor-&gt;<a class="code" href="class_i_l_f_feature.html#a76f00a5ff9fca29a6e31bcbe1ac812f6">sxBase</a>() ) +</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="stringliteral">&quot;, y = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>( pSensor-&gt;<a class="code" href="class_i_l_f_feature.html#a8420340d6602e9e04cd457d0cac5c888">syBase</a>() ) +</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        <span class="stringliteral">&quot;, width = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>( pSensor-&gt;<a class="code" href="class_i_l_f_feature.html#a2abba96fbe45e8f04212830de4587b64">wUnitBase</a>() ) +</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        <span class="stringliteral">&quot;, height = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>( pSensor-&gt;<a class="code" href="class_i_l_f_feature.html#af9ac2333853668de0e10bbfa7944d2f1">hUnitBase</a>() ) + <span class="stringliteral">&quot;;\n&quot;</span>);</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;}</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160; </div>
<div class="line"><a name="l00554"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#ae50b9cd02b7ac7e2bb8072232256807d">  554</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="class_t_c_s_ada_boost.html#ae50b9cd02b7ac7e2bb8072232256807d">TCSAdaBoost::PrintStatistics</a>(<a class="code" href="class_t_c_s_strong.html">TCSStrong</a>&amp; Class, <span class="keywordtype">double</span>&amp; afrr)</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;{</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keywordtype">double</span>          dFar = 0, dFrr = 0;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keywordtype">double</span> min_err = 100000;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160; </div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="keywordflow">for</span> (  <span class="keywordtype">int</span> i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    {</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160; </div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        <a class="code" href="class_t_c_s_sample.html">TCSSample</a>* s = (<a class="code" href="class_t_c_s_sample.html">TCSSample</a>*)m_TrainingSamples.Get(i);</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160; </div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        <span class="keywordtype">double</span> err = 0;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        awpRect r; r.left =0; r.top = 0;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        r.right = s-&gt;<a class="code" href="class_t_l_f_image.html#a5a44ea86ac3f94f530665d047f95cc69">GetImage</a>()-&gt;sSizeX;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        r.bottom = s-&gt;<a class="code" href="class_t_l_f_image.html#a5a44ea86ac3f94f530665d047f95cc69">GetImage</a>()-&gt;sSizeY;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        Class.<a class="code" href="class_t_c_s_strong.html#a38404df012bf77098bfb7be80aadd66f">Setup</a>(r, m_widthBase);</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160; </div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        Class.<a class="code" href="class_t_c_s_strong.html#a6d512a3f300c4d0b76e09dc752eed0ee">Classify</a>(s, err );</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160; </div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <span class="keywordflow">if</span> ( s-&gt;<a class="code" href="class_t_c_s_sample.html#a54a7b60e35ab30d59b750f7eb31ddfb4">GetFlag</a>() == 1 )</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        {</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            <span class="keywordflow">if</span> (err &lt; min_err)</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                min_err = err;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160; </div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            <span class="keywordflow">if</span> ( err &lt; Class.<a class="code" href="class_i_l_f_strong.html#a454b62bde9e2eea35cf6f723d1577ee4">GetThreshold</a>() ) dFrr += 1.0;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        }</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        {</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            <span class="keywordflow">if</span> ( err &gt;= Class.<a class="code" href="class_i_l_f_strong.html#a454b62bde9e2eea35cf6f723d1577ee4">GetThreshold</a>() )</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            {</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                dFar += 1.0;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            }</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        }</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160; </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160; </div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    }</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160; </div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    dFrr /= m_nTestFaces;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    dFar /= m_nTestNonFaces;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160; </div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    DbgMsg( <span class="stringliteral">&quot;\nFAR = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>( dFar ) +</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;            <span class="stringliteral">&quot;, FRR = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>( dFrr ) +</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            <span class="stringliteral">&quot;, threshold = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>( Class.<a class="code" href="class_i_l_f_strong.html#a454b62bde9e2eea35cf6f723d1577ee4">GetThreshold</a>() )+ <span class="stringliteral">&quot;;\n&quot;</span> );</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160; </div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="comment">//todo:</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    afrr = dFrr;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    </div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <a class="code" href="struct_t_wcl_err_info.html">TWclErrInfo</a> err_info;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    err_info.<a class="code" href="struct_t_wcl_err_info.html#abc99007c13b43797a91a70cb4e09387c">m_far</a> = dFar;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    err_info.<a class="code" href="struct_t_wcl_err_info.html#a44e161c8b6235820b11300c19f244350">m_frr</a> = dFrr;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    err_info.<a class="code" href="struct_t_wcl_err_info.html#ae60b18d38451ebfd8f7854da38ade7a6">m_thr</a> = Class.<a class="code" href="class_i_l_f_strong.html#a454b62bde9e2eea35cf6f723d1577ee4">GetThreshold</a>();</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160; </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    m_trainData.push_back(err_info);</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordflow">return</span> dFar;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160; </div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="keywordtype">double</span> ff = 0;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="keywordtype">double</span> dFar1 = 0;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keywordtype">double</span> dFrr1 = 0;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160; </div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="keywordflow">for</span> (  <span class="keywordtype">int</span> i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    {</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160; </div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <a class="code" href="class_t_c_s_sample.html">TCSSample</a>* s = (<a class="code" href="class_t_c_s_sample.html">TCSSample</a>*)m_TrainingSamples.Get(i);</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160; </div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        <span class="keywordtype">double</span> err = 0;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        awpRect r; r.left =0; r.top = 0;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        r.right = s-&gt;<a class="code" href="class_t_l_f_image.html#a5a44ea86ac3f94f530665d047f95cc69">GetImage</a>()-&gt;sSizeX;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        r.bottom = s-&gt;<a class="code" href="class_t_l_f_image.html#a5a44ea86ac3f94f530665d047f95cc69">GetImage</a>()-&gt;sSizeY;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        Class.<a class="code" href="class_t_c_s_strong.html#a38404df012bf77098bfb7be80aadd66f">Setup</a>(r, m_widthBase);</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160; </div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160; </div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        Class.<a class="code" href="class_t_c_s_strong.html#a6d512a3f300c4d0b76e09dc752eed0ee">Classify</a>( s, err );</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160; </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        <span class="keywordflow">if</span> ( s-&gt;<a class="code" href="class_t_c_s_sample.html#a54a7b60e35ab30d59b750f7eb31ddfb4">GetFlag</a>() == 1 )</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        {</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            <span class="keywordflow">if</span> (err &lt; min_err) dFrr1 += 1.0;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        }</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        {</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160; </div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            <span class="keywordflow">if</span> ( err &gt;= min_err )</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            {</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                dFar1 += 1.0;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            }</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        }</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160; </div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160; </div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    }</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160; </div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    dFrr1 /= m_nTestFaces;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    dFar1 /= m_nTestNonFaces;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    afrr = dFrr1;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160; </div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    DbgMsg( <span class="stringliteral">&quot;ro = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>( min_err ) + <span class="stringliteral">&quot;\t frr = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>( dFrr1 ) +</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        <span class="stringliteral">&quot;,\t far = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>( dFar1 ) + <span class="stringliteral">&quot;;\n&quot;</span>);</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160; </div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="comment">//TWclErrInfo err_info;</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    err_info.<a class="code" href="struct_t_wcl_err_info.html#abc99007c13b43797a91a70cb4e09387c">m_far</a> = dFar1;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    err_info.<a class="code" href="struct_t_wcl_err_info.html#a44e161c8b6235820b11300c19f244350">m_frr</a> = dFrr1;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    err_info.<a class="code" href="struct_t_wcl_err_info.html#ae60b18d38451ebfd8f7854da38ade7a6">m_thr</a> = min_err;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160; </div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    m_trainData.push_back(err_info);</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160; </div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="keywordflow">return</span> dFar1;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;}</div>
<div class="line"><a name="l00658"></a><span class="lineno"><a class="line" href="lfcsboost_8cpp.html#a01ffedf403b9ef77767735a8ab1bffa5">  658</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="lfcsboost_8cpp.html#a01ffedf403b9ef77767735a8ab1bffa5">SampleCompare</a>(<span class="keywordtype">void</span> * Item1, <span class="keywordtype">void</span> * Item2)</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;{</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <a class="code" href="class_t_c_s_sample.html">TCSSample</a>* s1 = (<a class="code" href="class_t_c_s_sample.html">TCSSample</a>*)Item1;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <a class="code" href="class_t_c_s_sample.html">TCSSample</a>* s2 = (<a class="code" href="class_t_c_s_sample.html">TCSSample</a>*)Item2;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="keywordflow">if</span> (s1-&gt;<a class="code" href="class_t_c_s_sample.html#a6f786a436b942bf561e5e0148414de3e">GetRating</a>() &gt; s2-&gt;<a class="code" href="class_t_c_s_sample.html#a6f786a436b942bf561e5e0148414de3e">GetRating</a>())</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s1-&gt;<a class="code" href="class_t_c_s_sample.html#a6f786a436b942bf561e5e0148414de3e">GetRating</a>() == s2-&gt;<a class="code" href="class_t_c_s_sample.html#a6f786a436b942bf561e5e0148414de3e">GetRating</a>())</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;}</div>
<div class="line"><a name="l00669"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#a39e0e089441fe4cfd4f9ddab9fb38f2f">  669</a></span>&#160;<span class="keywordtype">void</span>   <a class="code" href="class_t_c_s_ada_boost.html#a39e0e089441fe4cfd4f9ddab9fb38f2f">TCSAdaBoost::SaveFRRSamples</a>(<span class="keywordtype">int</span> stage)</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;{</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordflow">if</span> (stage &lt; 0)</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    std::string strPath = this-&gt;m_strPath;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    strPath += <span class="stringliteral">&quot;\\frr\\&quot;</span>;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160; </div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="group___l_f_file_utils.html#ga71cdb56ac95e4b7e00de69acf2105ef1">LFDirExist</a>(strPath.c_str()))</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        <a class="code" href="group___l_f_file_utils.html#gaac7e7cc01e0c348f7ce9514d53fe1bd2">LFCreateDir</a>(strPath.c_str());</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160; </div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="keywordtype">char</span> buf[32];</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    sprintf(buf, <span class="stringliteral">&quot;stage%d&quot;</span>, stage);</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    strPath += buf;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="group___l_f_file_utils.html#ga71cdb56ac95e4b7e00de69acf2105ef1">LFDirExist</a>(strPath.c_str()))</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        <a class="code" href="group___l_f_file_utils.html#gaac7e7cc01e0c348f7ce9514d53fe1bd2">LFCreateDir</a>(strPath.c_str());</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160; </div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="comment">//forming an array of positive examples for each settable rating received strong classifier</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <a class="code" href="class_t_l_f_object_list.html">TLFObjectList</a> positiveSamples;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; this-&gt;m_TrainingSamples.GetCount(); i++)</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    {</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        <a class="code" href="class_t_c_s_sample.html">TCSSample</a>* s = (<a class="code" href="class_t_c_s_sample.html">TCSSample</a>*)m_TrainingSamples.Get(i);</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        <span class="keywordflow">if</span> (s-&gt;<a class="code" href="class_t_c_s_sample.html#a54a7b60e35ab30d59b750f7eb31ddfb4">GetFlag</a>() == 1)</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        {</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            <span class="keywordtype">double</span> err = 0;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            awpRect r; r.left =0; r.top = 0;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            r.right = s-&gt;<a class="code" href="class_t_l_f_image.html#a5a44ea86ac3f94f530665d047f95cc69">GetImage</a>()-&gt;sSizeX;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;            r.bottom = s-&gt;<a class="code" href="class_t_l_f_image.html#a5a44ea86ac3f94f530665d047f95cc69">GetImage</a>()-&gt;sSizeY;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160; </div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;            this-&gt;m_ResultClass.Setup(r, m_widthBase);</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            this-&gt;m_ResultClass.Classify(s, err);</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;            s-&gt;<a class="code" href="class_t_c_s_sample.html#a9ce5c39240fcba99b11bcf9ecd77139f">SetRating</a>(err);</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            </div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;            positiveSamples.<a class="code" href="class_t_l_f_object_list.html#aeea56aec3018d7a253cb9af571a0cfd7">Add</a> (<span class="keyword">new</span> <a class="code" href="class_t_c_s_sample.html">TCSSample</a>(s));</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        }</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    }</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="comment">// sort the list</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    positiveSamples.<a class="code" href="class_t_l_f_object_list.html#a531ce97cfa683256fbd6b8cee485b799">Sort</a>(<a class="code" href="lfcsboost_8cpp.html#a01ffedf403b9ef77767735a8ab1bffa5">SampleCompare</a>);</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="comment">// Save 1% of the list to disk</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    std::string strFrrFileName = <a class="code" href="group___l_f_file_utils.html#gad395468232807ead548b1157992c0f77">LFMakeFileName</a>(strPath, <span class="stringliteral">&quot;frr&quot;</span>, <span class="stringliteral">&quot;.txt&quot;</span>);</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    FILE* F = fopen(strFrrFileName.c_str(), <span class="stringliteral">&quot;w+t&quot;</span>);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="keywordflow">if</span> (F == NULL)</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    fprintf (F, <span class="stringliteral">&quot;stage threshold = %f\n&quot;</span>, this-&gt;m_ResultClass.GetThreshold());</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="keywordtype">int</span> numToSave = positiveSamples.<a class="code" href="class_t_l_f_object_list.html#a650c52eef455194f2e29d2ce066fab3b">GetCount</a>() / 100;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numToSave; i++)</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    {</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        <a class="code" href="class_t_c_s_sample.html">TCSSample</a>* s = (<a class="code" href="class_t_c_s_sample.html">TCSSample</a>*)positiveSamples.<a class="code" href="class_t_l_f_object_list.html#aaebd119611fadae07d1f72ad62b03d60">Get</a>(i);</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        std::string strFileName = <a class="code" href="group___l_f_file_utils.html#gad395468232807ead548b1157992c0f77">LFMakeFileName</a>(strPath, <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(i), <span class="stringliteral">&quot;.jpg&quot;</span>);</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        <span class="keywordtype">double</span> r = s-&gt;<a class="code" href="class_t_c_s_sample.html#a6f786a436b942bf561e5e0148414de3e">GetRating</a>();</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        fprintf (F, <span class="stringliteral">&quot;%s\t %f\n&quot;</span>, strFileName.c_str(),  r);</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        awpSaveImage(strFileName.c_str(), s-&gt;<a class="code" href="class_t_l_f_image.html#a5a44ea86ac3f94f530665d047f95cc69">GetImage</a>());</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    }</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    fclose(F);</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;}</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160; </div>
<div class="line"><a name="l00724"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost.html#af2e4f2d7eb0723bc7819fbfd2d0b9a26">  724</a></span>&#160;<span class="keywordtype">void</span>   <a class="code" href="class_t_c_s_ada_boost.html#af2e4f2d7eb0723bc7819fbfd2d0b9a26">TCSAdaBoost::SaveNegativeSamples</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* lpPath)</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;{</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <span class="keywordtype">string</span> path = lpPath;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="keywordtype">int</span> total = 0;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <a class="code" href="group___l_f_file_utils.html#gaac7e7cc01e0c348f7ce9514d53fe1bd2">LFCreateDir</a>(lpPath);</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; this-&gt;m_TrainingSamples.GetCount(); i++)</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    {</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        <a class="code" href="class_t_c_s_sample.html">TCSSample</a>* s = (<a class="code" href="class_t_c_s_sample.html">TCSSample</a>*)m_TrainingSamples.Get(i);</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <span class="keywordflow">if</span> (s-&gt;<a class="code" href="class_t_c_s_sample.html#a54a7b60e35ab30d59b750f7eb31ddfb4">GetFlag</a>() == 0)</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        {</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;            <span class="keywordtype">string</span> filename = path;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;            filename += <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(total);</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;            filename += <span class="stringliteral">&quot;.awp&quot;</span>;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;            total++;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;            s-&gt;<a class="code" href="class_t_l_f_image.html#aabefe7fad02ac79afc519d5d86a1b399">SaveToFile</a>(filename.c_str());</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        }</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    }</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;}</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160; </div>
<div class="line"><a name="l00744"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost_sign.html#a4ac3dd801d0b445cd7f08d7d46bbe347">  744</a></span>&#160;<a class="code" href="class_t_c_s_ada_boost_sign.html#a4ac3dd801d0b445cd7f08d7d46bbe347">TCSAdaBoostSign::TCSAdaBoostSign</a>()</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;{</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    m_widthBase = 24;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    m_heightBase = 24;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    m_maxFeatures = 50;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    m_strBase1 = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    m_strBase2 = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    m_numSamplesBase1  = 0;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    m_numSamplesBase1  = 0;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160; </div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    m_flog.open(<span class="stringliteral">&quot;log.txt&quot;</span>);</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;}</div>
<div class="line"><a name="l00756"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost_sign.html#a387a96259566f2e2693ef13d6c7efdbf">  756</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_t_c_s_ada_boost_sign.html#a707982b4a3c0c0de3ed769f3c8fd75c8">TCSAdaBoostSign::Load</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* lpConfigName)</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;{</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;   <span class="keywordflow">if</span> (lpConfigName == NULL)</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160; </div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;   TiXmlDocument doc(lpConfigName);</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;   <span class="keywordflow">if</span> (!doc.LoadFile())</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160; </div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;   TiXmlHandle hDoc(&amp;doc);</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;   TiXmlElement* pElem = NULL;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;   pElem = hDoc.FirstChildElement().Element();</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160; </div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;   <span class="keywordflow">if</span> (!pElem)</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span>* name = pElem-&gt;Value();</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;   <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;csboostsign&quot;</span>) != 0)</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;   <span class="keywordflow">return</span> Load( pElem);</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;}</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160; </div>
<div class="line"><a name="l00777"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost_sign.html#a707982b4a3c0c0de3ed769f3c8fd75c8">  777</a></span>&#160;<span class="keywordtype">bool</span>    <a class="code" href="class_t_c_s_ada_boost_sign.html#a707982b4a3c0c0de3ed769f3c8fd75c8">TCSAdaBoostSign::Load</a> (TiXmlElement* node)</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;{</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;   <span class="keywordflow">if</span> (node == NULL)</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    m_TrainingSamples.Clear();</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    m_TestingSamples.Clear();</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    TiXmlElement* pElem = NULL;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    pElem = node-&gt;FirstChildElement();</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="comment">//Загрузка образцов для обучения</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    DbgMsg( <span class="stringliteral">&quot;Loading training sets...\n&quot;</span> );</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    m_strBase2 = pElem-&gt;Attribute(<span class="stringliteral">&quot;database2&quot;</span>);</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keywordflow">if</span> (!LoadSamples( -1, m_strBase2 ))</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    m_numSamplesBase2 = m_TrainingSamples.GetCount();</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    m_numSamplesTestBase2 = m_TestingSamples.GetCount();</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    std::string m_strBase1 = pElem-&gt;Attribute(<span class="stringliteral">&quot;database1&quot;</span>);</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="keywordflow">if</span> (!LoadSamples( 1,  m_strBase1))</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    m_numSamplesBase1 = (int)m_TrainingSamples.GetCount( ) - m_numSamplesBase2;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    m_numSamplesTestBase1 = (int)m_TestingSamples.GetCount( ) - m_numSamplesTestBase2;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160; </div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="keywordtype">double</span> v;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    m_widthBase = 24;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    m_heightBase = 24;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    pElem-&gt;Attribute(<span class="stringliteral">&quot;w&quot;</span>, &amp;v);</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    m_widthBase = (int )v;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    pElem-&gt;Attribute(<span class="stringliteral">&quot;h&quot;</span>, &amp;v);</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    m_heightBase = (int )v;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160; </div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    pElem = pElem-&gt;NextSiblingElement();</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="keywordtype">double</span> ni = 5;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    pElem-&gt;Attribute(<span class="stringliteral">&quot;maxi&quot;</span>, &amp;ni);</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    m_maxFeatures = (int)ni;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160; </div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160; </div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    DbgMsg( <span class="stringliteral">&quot;Samples to training for class 1 &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(m_numSamplesBase1) +<span class="stringliteral">&quot;;\n&quot;</span> );</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    DbgMsg( <span class="stringliteral">&quot;Samples to training for class -1 &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(m_numSamplesBase2) +<span class="stringliteral">&quot;;\n&quot;</span> );</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    DbgMsg( <span class="stringliteral">&quot;Samples to testing for class 1 &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(m_numSamplesTestBase1) +<span class="stringliteral">&quot;;\n&quot;</span> );</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    DbgMsg( <span class="stringliteral">&quot;Samples to testing for class -1 &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(m_numSamplesTestBase2) +<span class="stringliteral">&quot;;\n&quot;</span> );</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160; </div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="comment">// инициализация исходного массива признаков    InitFeatures( );

    return true;
}

void TCSAdaBoostSign::SetLogName(char* lpLogName)
{
}

void TCSAdaBoostSign::SetLog1Name(char* lpLog1Name)
{
}


bool TCSAdaBoostSign::Boost()
{
    // Начало накачки.
    double wf   = 0.5/m_numSamplesBase1;
    double wnf = 0.5 / m_numSamplesBase2;

    DbgMsg(&quot;\nBoosting started.\n&quot;);

    // Установка начальных весов для обучающего набора m_TrainingSet
    for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
    {
        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
        if (s-&gt;GetFlag() == 1)
            s-&gt;SetWeight(wf);
        else if (s-&gt;GetFlag() == -1)
            s-&gt;SetWeight(wnf);
        else
            continue;
    }

    ProgressMeter progress;
    progress.Init( 30, (int)m_TrainingSamples.GetCount( ) );

    m_ResultClass.Clear();
    //m_trainData.clear();

    if ( m_Features.GetCount( ) == 0 ) return false;

    //Main loop;
    for ( int i = 0; i &lt; m_maxFeatures ; ++i )
    {

        DbgMsg( &quot;\nUpdating: &quot; );
        progress.Init( 30, m_Features.GetCount( ) );
        int count = 0;

//Update
#pragma omp parallel for reduction(+: count)
        for ( int w = 0; w &lt; m_Features.GetCount(); ++w )
        {
            ++count;
            TCSWeakSignTrainig* wcinfo = (TCSWeakSignTrainig*)m_Features.Get(w);
            wcinfo-&gt;SetEpsilon(0);

            //Train section;
            wcinfo-&gt;StartTraining();
            for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
               TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
               wcinfo-&gt;AddSample(s, s-&gt;GetFlag(), s-&gt;GetWeight());
            }
            wcinfo-&gt;Train();

            //Calc error;
            for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
                TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

                int res = wcinfo-&gt;Classify( s );

                if ( s-&gt;GetFlag() != res )
                {
                    wcinfo-&gt;SetEpsilon(wcinfo-&gt;GetEpsilon() + s-&gt;GetWeight());
                }
            }

            if ( progress.Update( ) )
                DbgMsg(&quot;&gt;&quot;);
        }

        DbgMsg( &quot;\n&quot; );
        printf( &quot;Count stage: %d \n&quot;, count );
        // выбор лучшего признака, по минимальной ошибке классификации на обучающем наборе.
        int bestWc = 0;
        for ( int w = 0; w &lt; m_Features.GetCount(); ++w )
        {
            TCSWeakSignTrainig* best       = (TCSWeakSignTrainig*)m_Features.Get(bestWc);
            TCSWeakSignTrainig* current    = (TCSWeakSignTrainig*)m_Features.Get(w);
            if ( best-&gt;GetEpsilon() &gt; current-&gt;GetEpsilon()  )
                bestWc = w;
        }
        TCSWeakSignTrainig* pWc       = (TCSWeakSignTrainig*)m_Features.Get(bestWc);
        pWc-&gt;SetWeight((double)pWc-&gt;GetEpsilon());

        // если ошибка лучшего классификатора превысила критический уровень 50%
        // прекращаем процесс накачки.
        if ( pWc-&gt;Weight() &gt; 0.49 ) break;


        //Update wc weight;
        double beta = pWc-&gt;Weight()/ (1 - pWc-&gt;Weight());
        double min_eps = pWc-&gt;Weight();
        pWc-&gt;SetWeight (log(1.0/beta));

        //Добавим &quot;слабый&quot; классификатор в &quot;комитет".
        m_ResultClass.AddWeak(pWc);
        
        // распечатка атрибутов классификатора
        DbgMsg( &quot;\nRound num = &quot; + TypeToStr(i + 1) +
            &quot;, min_eps = &quot; + TypeToStr(min_eps) +
            &quot;, beta = &quot; + TypeToStr( beta ) +
        &quot;, alpha = &quot;+ TypeToStr(pWc-&gt;Weight())+&quot;;\n&quot; );

        this-&gt;Statistics();
        // для каждого образца обновим веса
        double wt = 0;
        for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
        {
            TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

            int res = 0;
            double err = 0;
            res = pWc-&gt;Classify( s );

            if ( res == s-&gt;GetFlag() )
                s-&gt;SetWeight(s-&gt;GetWeight()*beta);
            wt += s-&gt;GetWeight();
        }

        //Normalize;
        wt = 1.0/wt;

        for ( int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
        {
            TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);
            s-&gt;SetWeight(s-&gt;GetWeight()*wt);
        }

        //Удалим найденный признак из списка признаков
        m_Features.Delete(bestWc);

    }
    //SaveROC();
    return true;
}
//
TCSStrongSign* TCSAdaBoostSign::GetResult()
{
  return &amp;m_ResultClass;
}

void    TCSAdaBoostSign::InitFeatures()
{
    m_Features.Clear();

   int sx = 1;
   int sy = 1;
   int w = 3;
   int h = 3;
   for (h = m_heightBase -3; h &gt;= 3; h-=3)
   {
       for (w = m_widthBase ; w &gt;= 3; w-=3)
       {
           for (sy = 1; sy &lt; m_heightBase - h - 1; sy++)
           {
               for (sx = 1; sx &lt; m_widthBase - w - 1; sx++)
               {
                   TCSSensor Sensor(sx, sy, w / 3, h / 3);
                   TCSWeakSignTrainig* wt = new TCSWeakSignTrainig(Sensor);
                   m_Features.Add(wt);
               }
           }
       }
   }
}

bool    TCSAdaBoostSign::LoadSamples(int flag, std::string const&amp; path)
{
    DbgMsg( &quot;Loading samples from &quot; + path + &quot;... &quot; );

    int count = 0;
    srand( (unsigned)time( NULL ) );
    int RANGE_MIN = 0;
    int RANGE_MAX = 3;

#ifdef WIN32
    intptr_t handle = 0;
    _finddata_t filesInfo;
    if ( (handle = _findfirst( (char*)((path+&quot;*.jpg&quot;).c_str()), &amp;filesInfo)) != -1 )
    {
        do
        {
           string name = path + filesInfo.name;
        
            TCSSample* pSample = new TCSSample();
            pSample-&gt;LoadFromFile((char*)name.c_str());

    //        if (pSample-&gt;Process())
            {
                pSample-&gt;SetFlag(flag);
                int r = (int)(((double) rand() / (double) RAND_MAX) * RANGE_MAX + RANGE_MIN);

                //int  r = rand(0);
                if (r &gt; 0)
                    m_TrainingSamples.Add(pSample);
                else
                    m_TestingSamples.Add(pSample);

                ++count;
            }
//            else
//printf( &quot;Can&#39;t load image %s.\n&quot;, name.c_str( ) );
        }while(!_findnext( handle, &amp;filesInfo ));


    }
    _findclose( handle );

#else

//    struct dirent** namelist;
//    if(( count = scandir( path.c_str(), &amp;namelist, jpg_filter, alphasort )) &lt; 0 )
//            return 0;

//    for( int i=0; i&lt;count; i++ )
//    {
//            string name = path + namelist[i]-&gt;d_name;

//            TCSSample* pSample = new TCSSample();
//            pSample-&gt;LoadImage((char*)name.c_str());


//                pSample-&gt;SetFlag(flag);
//              int r = (((double) rand() / (double) RAND_MAX) * RANGE_MAX + RANGE_MIN);

//                //int  r = rand(0);
//                if (r &gt; 0)
//                    m_TrainingSamples.Add(pSample);
//                else
//                    m_TestingSamples.Add(pSample);

//    }

#endif

    DbgMsg( TypeToStr( count ) + &quot; ok\n&quot; );
    return count &gt; 0;
}
void    TCSAdaBoostSign::DbgMsg( std::string const&amp; msg)
{
    std::cout&lt;&lt; msg;  
#ifdef WIN32
    m_flog &lt;&lt; msg;
    m_flog.flush();
#endif
}

void    TCSAdaBoostSign::Statistics()
{
    double errt[2] = {0,0};
    double err1[2] = { 0, 0 };
    double err2[2] = { 0, 0 };
    double erru[2] = { 0, 0 };
    for (  int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
    {

        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

        double err = 0;
        //double factor = (double)(s-&gt;GetImage()-&gt;sSizeX)/24.0;
        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        m_ResultClass.Setup(r, m_widthBase);

        int res = m_ResultClass.Classify( s-&gt;GetIntegralImage(), err );
        if (res != s-&gt;GetFlag())
        {
              errt[0]++;
              if (res == 0)
                erru[0]++;
              if (res == 1)
                err2[0]++;
              if (res == -1)
                err1[0]++;
        }
    }
    errt[0] /= m_TrainingSamples.GetCount();
    errt[0] *= 100;

    err1[0] /= (m_numSamplesBase1);
    err1[0] *= 100;

    err2[0] /= (m_numSamplesBase2);
    err2[0] *= 100;

    erru[0] /= m_TrainingSamples.GetCount();
    erru[0] *= 100;
    for (  int i = 0; i &lt; m_TestingSamples.GetCount(); i++ )
    {

        TCSSample* s = (TCSSample*)m_TestingSamples.Get(i);

        double err = 0;
        //double factor = (double)(s-&gt;GetImage()-&gt;sSizeX)/24.0;
        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        m_ResultClass.Setup(r, m_widthBase);

        int res = m_ResultClass.Classify( s-&gt;GetIntegralImage(), err );
        if (res != s-&gt;GetFlag())
        {
              errt[1]++;
              if (res == 0)
                erru[1]++;
              if (res == 1)
                err2[1]++;
              if (res == -1)
                err1[1]++;
        }
    }
    if (m_TestingSamples.GetCount() &gt; 0)
    {
    errt[1] /= m_TestingSamples.GetCount();
    errt[1] *= 100;

    err1[1] /= (m_numSamplesTestBase1);
    err1[1] *= 100;
    err2[1] /= (m_numSamplesTestBase2);
    err2[1] *= 100;


    erru[1] /= m_TestingSamples.GetCount();
    erru[1] *= 100;
    }

    DbgMsg( &quot;errt = &quot; + TypeToStr( errt[0] ) + &quot; % &quot; + TypeToStr( errt[1] ) + &quot;%;\n&quot; );
    DbgMsg( &quot;err1 = &quot; + TypeToStr( err1[0] ) + &quot; % &quot; + TypeToStr( err1[1] ) + &quot;%;\n&quot; );
    DbgMsg( &quot;err2 = &quot; + TypeToStr( err2[0] ) + &quot; % &quot; + TypeToStr( err2[1] ) + &quot;%;\n&quot;  );
    DbgMsg( &quot;erru = &quot; + TypeToStr( erru[0] ) + &quot; % &quot; + TypeToStr( erru[1] ) + &quot;%;\n&quot; );
}


struct roc_entry
{
    double far1;
    double frr1;
    double far2;
    double frr2;
};
void TCSAdaBoostSign::SaveROC(char*lpName)
{
 //
    double* fSourceClass1 = NULL;
    double* fSourceClass2 = NULL;
    roc_entry roc[100];
    memset(roc,0, sizeof(roc));
    fSourceClass1 = (double*)malloc(m_numSamplesTestBase1*sizeof(double));
    fSourceClass2 = (double*)malloc(m_numSamplesTestBase2*sizeof(double));
    memset(fSourceClass1, 0, m_numSamplesTestBase1*sizeof(double));
    memset(fSourceClass2, 0, m_numSamplesTestBase2*sizeof(double));
    int nc1 =0;
    int nc2 =0;

    for (int i = 0; i &lt; m_TestingSamples.GetCount(); i++)
    {
        TCSSample* s = (TCSSample*)m_TestingSamples.Get(i);

        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        m_ResultClass.Setup(r, m_widthBase);
        double err = 0;
        m_ResultClass.Classify( s-&gt;GetIntegralImage(), err );
        if (s-&gt;GetFlag() == 1)
        {
            fSourceClass1[nc1] = err;
            nc1++;
        }
        else
        {
            fSourceClass2[nc2] = err;
            nc2++;
        }
    }

    double tau = m_ResultClass.GetSumWeakWeight();

    DbgMsg( TypeToStr( tau ) + &quot;\n&quot; );

    double delta = tau / 50.f;
    double stau = -tau;
    int c = 0;
    while(stau &lt; tau)
    {
        for (int i=0; i&lt; nc1; i++)
        {
            if (fSourceClass1[i] &lt; stau)
                roc[c].frr1++;
            if (fSourceClass1[i] &lt; stau)
                roc[c].far2++;
        }
        for (int i=0; i&lt; nc2; i++)
        {
            if (fSourceClass2[i] &gt; stau)
                roc[c].far1++;
            if (fSourceClass2[i] &gt; stau)
                roc[c].frr2++;
        }

        stau += delta;
        c++;
    }
    DbgMsg( TypeToStr( c ) + &quot;\n&quot; );
    for (int i = 0; i &lt; 100; i++)
    {
        roc[i].far1 = 100.f*roc[i].far1/nc2;
        roc[i].frr1 = 100.f*roc[i].frr1/nc1;
        roc[i].far2 = 100.f*roc[i].far2/nc1;
        roc[i].frr2 = 100.f*roc[i].frr2/nc2;
    }
//  std::ostream*       f;
//  f = new ofstream(&quot;roc.txt&quot;);
//  for (int i = 0; i &lt; 100; i++)
//      (*f) &lt;&lt; roc[i].far1 &lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr1&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].far2&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr2 &lt;&lt;&quot;\n&quot;;
//  delete f;
    FILE* f = fopen (lpName, &quot;w+t&quot;);
    for (int i = 0; i &lt; 100; i++)
    {
//      fprintf(f, &quot;%f\n&quot;, roc[i].far1);
        fprintf(f, &quot;%f\t%f\t%f\t%f\n&quot;, roc[i].far1, roc[i].frr1, roc[i].far2,roc[i].frr2);
    }
    //  (*f) &lt;&lt; roc[i].far1 &lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr1&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].far2&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr2 &lt;&lt;&quot;\n&quot;;
    fclose(f);
    free(fSourceClass1);
    free(fSourceClass2);
}

TIEFSAdaBoost::TIEFSAdaBoost()
{
    m_numIFS = 0;
    m_numEFS = 0;
    m_strSourceFile = &quot;&quot;;
    m_pLog = NULL;
}

bool TIEFSAdaBoost::Load(const char* lpFileName)
{
    /*попытка открыть файл конфигурации*/
    TiXmlDocument doc(lpFileName);
    if (!doc.LoadFile())
        return false;
    TiXmlElement* e = doc.FirstChildElement(&quot;IEFSBoost&quot;);
    if (e == NULL)
        return false;
    m_strSourceFile = e-&gt;Attribute(&quot;file&quot;);
    string str = e-&gt;Attribute(&quot;log&quot;);

    if (m_pLog == NULL)
        m_pLog = new ofstream(str.c_str());

    return LoadSamples();
}
// распечатка сообщения на экране и в лог файле
void TIEFSAdaBoost::DbgMsg(std::string const&amp; msg)
{
    (*m_pLog) &lt;&lt; msg;
    cout &lt;&lt; msg;
    flush(*m_pLog);
}

bool TIEFSAdaBoost::Boost()
{
    // Начало накачки.
    double wf  = 0.5 / this-&gt;m_numIFS;
    double wnf = 0.5 / this-&gt;m_numEFS;

    DbgMsg(&quot;\nBoosting started.\n&quot;);

    // Установка начальных весов для обучающего набора m_TrainingSet
    for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
    {
        TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
        if (s-&gt;GetFlag() == 1)
            s-&gt;SetWeight(wf);
        else if (s-&gt;GetFlag() == 0)
            s-&gt;SetWeight(wnf);
        else
            continue;
    }

    ProgressMeter progress;
    progress.Init(30, (int)m_TrainingSamples.GetCount());
    // result class 
    m_ResultClass.Clear();

    if (m_Features.GetCount() == 0)
        return false;

    //Main loop;
    //for (int i = 0; i &lt; this-&gt;m_Features.GetCount(); ++i)
    int i = 0;
    while (this-&gt;m_Features.GetCount() &gt; 0)
    {
        i++;
        DbgMsg(&quot;\nUpdating: &quot;);
        progress.Init(30, m_Features.GetCount());
        int count = 0;

        //Update
#pragma omp parallel for reduction(+: count)
        for (int w = 1; w &lt; m_Features.GetCount(); ++w)
        {
            ++count;
            TIEFSWeak2* wcinfo = (TIEFSWeak2*)m_Features.Get(w);
            if (!wcinfo-&gt;IsFree())
                continue;
            wcinfo-&gt;SetEpsilon(0);

            //Train section;
            wcinfo-&gt;StartTraining();
            for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
                TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
                wcinfo-&gt;AddSample(s);
            }
            wcinfo-&gt;Train();

            //Calc error;
            for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
                TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);

                int res = wcinfo-&gt;Classify(s-&gt;GetValue(w));

                if (s-&gt;GetFlag() != res)
                {
                    wcinfo-&gt;SetEpsilon(wcinfo-&gt;GetEpsilon() + s-&gt;GetWeight());
                }
            }

            if (progress.Update())
                DbgMsg(&quot;&gt;&quot;);
        }

        DbgMsg(&quot;\n&quot;);
        DbgMsg(&quot;Count stage: %d \n&quot; + TypeToStr(count));
        // выбор лучшего признака, по минимальной ошибке классификации на обучающем наборе.
        int bestWc = 1;
        while (!((TIEFSWeak2*)m_Features.Get(bestWc))-&gt;IsFree())
            bestWc++;
        for (int w = bestWc +1; w &lt; m_Features.GetCount(); ++w)
        {
            
            TIEFSWeak2* best = (TIEFSWeak2*)m_Features.Get(bestWc);
            TIEFSWeak2* current = (TIEFSWeak2*)m_Features.Get(w);
            if (!current-&gt;IsFree())
                continue;
            if (best-&gt;GetEpsilon() &gt; current-&gt;GetEpsilon())
                bestWc = w;
        }
        TIEFSWeak* pWc = (TIEFSWeak*)m_Features.Get(bestWc);
        pWc-&gt;SetWeight(pWc-&gt;GetEpsilon());

        // если ошибка лучшего классификатора превысила критический уровень 50%
        // прекращаем процесс накачки.
        if (pWc-&gt;GetWeight() &gt;= 0.5)
        {
        
            DbgMsg(&quot;\n Min eps = 0.5. Break.\n&quot;);
            break;
        }


        //Update wc weight;
        double beta = pWc-&gt;GetWeight() / (1 - pWc-&gt;GetWeight());
        double min_eps = pWc-&gt;GetWeight();
        pWc-&gt;SetWeight(log(1.0 / beta)); 

        //Добавим &quot;слабый&quot; классификатор в &quot;комитет".
        //result class  
        m_ResultClass.Add(pWc-&gt;Clone());
        m_ResultClass.SetThreshold(m_ResultClass.GetSumWeakWeight() / 2);
        pWc-&gt;Lock();
        // распечатка атрибутов классификатора
        DbgMsg(&quot;\nRound num = &quot; + TypeToStr(i + 1) +
            &quot;, min_eps = &quot; + TypeToStr(min_eps) +
            &quot;, beta = &quot; + TypeToStr(beta) +
            &quot;, alpha = &quot; + TypeToStr(pWc-&gt;GetWeight()) + &quot;;\n&quot;);
        // распечатка атрибутов выбранного признака
        DbgMsg(&quot;Feature num = &quot; + TypeToStr(pWc-&gt;GetIndex()) + &quot;\n&quot; );

        //распечатка ошибки на тестовом наборе.
        PrintStatistics();


        // для каждого образца обновим веса
        double wt = 0;
        for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
        {
            TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);

            int res = 0;

            res = pWc-&gt;Classify(s-&gt;GetValue(pWc-&gt;GetIndex()));

            if (res == s-&gt;GetFlag())
            {
                s-&gt;SetWeight(s-&gt;GetWeight()*beta);
            }
            wt += s-&gt;GetWeight();
        }

        //Normalize;
        wt = 1.0 / wt;
        double sum = 0;
        for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
        {
            TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
            s-&gt;SetWeight(s-&gt;GetWeight()*wt);
            sum += s-&gt;GetWeight();
        }
        DbgMsg(&quot;sum  = &quot; + TypeToStr(sum) + &quot;\n&quot;);
        //Удалим найденный признак из списка признаков
      //m_Features.Delete(bestWc);

    }

    this-&gt;m_ResultClass.SaveXML(&quot;IEFSclass.xml&quot;);
    if (this-&gt;m_ResultClass.LoadXML(&quot;IEFSclass.xml&quot;))
    {
        DbgMsg(&quot;Work done.\n\n&quot;);
        this-&gt;PrintStatistics();
        DbgMsg(&quot;Bye!\n&quot;);
        return true;
    }
    else
        return false;
}
double  TIEFSAdaBoost::PrintStatistics()
{
    double          dFar = 0, dFrr = 0;

    for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
    {
        TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
        double err = m_ResultClass.Raiting(s);
        if (s-&gt;GetFlag() == 1)
        {
            if (err &lt; m_ResultClass.GetThreshold()) dFrr += 1.0;
        }
        else
        {
            if (err &gt;= m_ResultClass.GetThreshold())
            {
                dFar += 1.0;
            }
        }
    }

    dFrr /= this-&gt;m_numIFS;
    dFar /= this-&gt;m_numEFS;

    DbgMsg(&quot;\nFAR = &quot; + TypeToStr(dFar) +
        &quot;, FRR = &quot; + TypeToStr(dFrr) +
        &quot;, threshold = &quot; + TypeToStr(m_ResultClass.GetThreshold()) + &quot;;\n&quot;);

    return 0;
}

bool TIEFSAdaBoost::InitFeatures(int num)
{
    if (num &lt;= 0)
    {
        DbgMsg(&quot;Invalid num features: num = &quot; +TypeToStr (num) + &quot;\n&quot;);
        return false;
    }
    for (int i = 0; i &lt; num; i++)
    {
        TIEFSWeak2* w = new TIEFSWeak2(i);
        this-&gt;m_Features.Add(w);
    }
    DbgMsg(TypeToStr(num) + &quot;features created.\n&quot;);
    return true;
}
bool TIEFSAdaBoost::LoadSamples()
{
    DbgMsg(&quot;Loading samples...\n&quot;);
    awpImage* img = NULL;
    if (awpLoadImage(this-&gt;m_strSourceFile.c_str(), &amp;img) != AWP_OK)
    {
        DbgMsg(&quot;Cannot load featues from &quot; + m_strSourceFile + &quot;\n&quot;);
        return false;
    }
    int num = img-&gt;sSizeX - 1;
    double* diff = (double*)malloc(num*sizeof(double));
    if (!this-&gt;InitFeatures(num))
    {
        awpReleaseImage(&amp;img);
        free(diff);
        return false;
    }
    double* d = (double*)img-&gt;pPixels;
    int ifs_count = 0;
    int efs_count = 0;
    for (int i = 0; i &lt; img-&gt;sSizeY; i++)
    {
        int id1 = (int)d[i*img-&gt;sSizeX];
        for (int j = i + 1; j &lt; img-&gt;sSizeY; j++)
        {
            int id2 = (int)d[j*img-&gt;sSizeX];
            int flag = id1 == id2 ? 1 : 0;
            if (!flag &amp;&amp; efs_count &gt; 730000)
                continue;
            if (flag)
                ifs_count++;
            else
                efs_count++;

            for (int k = 1; k &lt;= num; k++)
            {
                diff[k-1] = fabs(d[i*img-&gt;sSizeX + k] - d[j*img-&gt;sSizeX + k]);
            }
            TIEFSSample* s = new TIEFSSample(diff, num, flag);
            this-&gt;m_TrainingSamples.Add(s);
        }
    }
    this-&gt;m_numIFS = ifs_count;
    this-&gt;m_numEFS = efs_count;

    awpReleaseImage(&amp;img);
    free(diff);
    DbgMsg(&quot;IFS samples loaded = &quot; + TypeToStr(m_numIFS) + &quot;\n&quot;);
    DbgMsg(&quot;EFS samples loaded = &quot; + TypeToStr(m_numEFS) + &quot;\n&quot;);
    return true;
}
</span> </div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    InitFeatures( );</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160; </div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;}</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160; </div>
<div class="line"><a name="l00824"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost_sign.html#a2b4db2d26c7121ddccc861cb77857a18">  824</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_t_c_s_ada_boost_sign.html#a2b4db2d26c7121ddccc861cb77857a18">TCSAdaBoostSign::SetLogName</a>(<span class="keywordtype">char</span>* lpLogName)</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;{</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;}</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160; </div>
<div class="line"><a name="l00828"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost_sign.html#aecb78e6077145b3e6ad0f77c705dc7ef">  828</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_t_c_s_ada_boost_sign.html#aecb78e6077145b3e6ad0f77c705dc7ef">TCSAdaBoostSign::SetLog1Name</a>(<span class="keywordtype">char</span>* lpLog1Name)</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;{</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;}</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160; </div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160; </div>
<div class="line"><a name="l00833"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost_sign.html#acb614ecee2a55f60cfc10f41992889e2">  833</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_t_c_s_ada_boost_sign.html#acb614ecee2a55f60cfc10f41992889e2">TCSAdaBoostSign::Boost</a>()</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;{</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="comment">// Начало накачки.</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <span class="keywordtype">double</span> wf   = 0.5/m_numSamplesBase1;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <span class="keywordtype">double</span> wnf = 0.5 / m_numSamplesBase2;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160; </div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    DbgMsg(<span class="stringliteral">&quot;\nBoosting started.\n&quot;</span>);</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160; </div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <span class="comment">// Установка начальных весов для обучающего набора m_TrainingSet</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; m_TrainingSamples.GetCount(); i++)</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    {</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        <a class="code" href="class_t_c_s_sample.html">TCSSample</a>* s = (<a class="code" href="class_t_c_s_sample.html">TCSSample</a>*)m_TrainingSamples.Get(i);</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        <span class="keywordflow">if</span> (s-&gt;<a class="code" href="class_t_c_s_sample.html#a54a7b60e35ab30d59b750f7eb31ddfb4">GetFlag</a>() == 1)</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;            s-&gt;<a class="code" href="class_t_c_s_sample.html#aac3b6bc5757dfeaf4c0bff242932f4d8">SetWeight</a>(wf);</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s-&gt;<a class="code" href="class_t_c_s_sample.html#a54a7b60e35ab30d59b750f7eb31ddfb4">GetFlag</a>() == -1)</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;            s-&gt;<a class="code" href="class_t_c_s_sample.html#aac3b6bc5757dfeaf4c0bff242932f4d8">SetWeight</a>(wnf);</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    }</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160; </div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <a class="code" href="class_progress_meter.html">ProgressMeter</a> progress;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    progress.<a class="code" href="class_progress_meter.html#a135acb682c55a6aed758d164aab5a0e7">Init</a>( 30, (<span class="keywordtype">int</span>)m_TrainingSamples.GetCount( ) );</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160; </div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    m_ResultClass.Clear();</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <span class="comment">//m_trainData.clear();</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160; </div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="keywordflow">if</span> ( m_Features.GetCount( ) == 0 ) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160; </div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="comment">//Main loop;</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; m_maxFeatures ; ++i )</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    {</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160; </div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        DbgMsg( <span class="stringliteral">&quot;\nUpdating: &quot;</span> );</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        progress.<a class="code" href="class_progress_meter.html#a135acb682c55a6aed758d164aab5a0e7">Init</a>( 30, m_Features.GetCount( ) );</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        <span class="keywordtype">int</span> count = 0;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160; </div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="comment">//Update</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="preprocessor">#pragma omp parallel for reduction(+: count)</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> w = 0; w &lt; m_Features.GetCount(); ++w )</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        {</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;            ++count;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;            <a class="code" href="class_t_c_s_weak_sign_trainig.html">TCSWeakSignTrainig</a>* wcinfo = (<a class="code" href="class_t_c_s_weak_sign_trainig.html">TCSWeakSignTrainig</a>*)m_Features.Get(w);</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;            wcinfo-&gt;<a class="code" href="class_t_c_s_weak_sign_trainig.html#a7a2685c9e6aa4138a76d256213bf73a7">SetEpsilon</a>(0);</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160; </div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;            <span class="comment">//Train section;</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;            wcinfo-&gt;<a class="code" href="class_t_c_s_weak_sign_trainig.html#a0db7ff8b24d598a860124e9cedbc1cb1">StartTraining</a>();</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;            <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; m_TrainingSamples.GetCount(); i++)</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;            {</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;               <a class="code" href="class_t_c_s_sample.html">TCSSample</a>* s = (<a class="code" href="class_t_c_s_sample.html">TCSSample</a>*)m_TrainingSamples.Get(i);</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;               wcinfo-&gt;<a class="code" href="class_t_c_s_weak_sign_trainig.html#a09e6b43d893b9c43836838eaca8a7bd0">AddSample</a>(s, s-&gt;<a class="code" href="class_t_c_s_sample.html#a54a7b60e35ab30d59b750f7eb31ddfb4">GetFlag</a>(), s-&gt;<a class="code" href="class_t_c_s_sample.html#a8df9cbf13871bff310a0cb94e8e37ebe">GetWeight</a>());</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;            }</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;            wcinfo-&gt;<a class="code" href="class_t_c_s_weak_sign_trainig.html#a03c38dea0e9fd012703ff6630f8070a8">Train</a>();</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160; </div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;            <span class="comment">//Calc error;</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;            <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; m_TrainingSamples.GetCount(); i++)</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;            {</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;                <a class="code" href="class_t_c_s_sample.html">TCSSample</a>* s = (<a class="code" href="class_t_c_s_sample.html">TCSSample</a>*)m_TrainingSamples.Get(i);</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160; </div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                <span class="keywordtype">int</span> res = wcinfo-&gt;<a class="code" href="class_t_c_s_weak_sign.html#a2c7a93e32da16b8d7b238c3961448182">Classify</a>( s );</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160; </div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                <span class="keywordflow">if</span> ( s-&gt;<a class="code" href="class_t_c_s_sample.html#a54a7b60e35ab30d59b750f7eb31ddfb4">GetFlag</a>() != res )</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                {</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;                    wcinfo-&gt;<a class="code" href="class_t_c_s_weak_sign_trainig.html#a7a2685c9e6aa4138a76d256213bf73a7">SetEpsilon</a>(wcinfo-&gt;<a class="code" href="class_t_c_s_weak_sign_trainig.html#a61eadc9ad8fb6a961faa23fbe6fb5410">GetEpsilon</a>() + s-&gt;<a class="code" href="class_t_c_s_sample.html#a8df9cbf13871bff310a0cb94e8e37ebe">GetWeight</a>());</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                }</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;            }</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160; </div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;            <span class="keywordflow">if</span> ( progress.<a class="code" href="class_progress_meter.html#ac3902e5affdd16dcec5042d24e8c3512">Update</a>( ) )</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                DbgMsg(<span class="stringliteral">&quot;&gt;&quot;</span>);</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        }</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160; </div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        DbgMsg( <span class="stringliteral">&quot;\n&quot;</span> );</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        printf( <span class="stringliteral">&quot;Count stage: %d \n&quot;</span>, count );</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        <span class="comment">// выбор лучшего признака, по минимальной ошибке классификации на обучающем наборе.</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        <span class="keywordtype">int</span> bestWc = 0;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> w = 0; w &lt; m_Features.GetCount(); ++w )</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        {</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;            <a class="code" href="class_t_c_s_weak_sign_trainig.html">TCSWeakSignTrainig</a>* best       = (<a class="code" href="class_t_c_s_weak_sign_trainig.html">TCSWeakSignTrainig</a>*)m_Features.Get(bestWc);</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;            <a class="code" href="class_t_c_s_weak_sign_trainig.html">TCSWeakSignTrainig</a>* current    = (<a class="code" href="class_t_c_s_weak_sign_trainig.html">TCSWeakSignTrainig</a>*)m_Features.Get(w);</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;            <span class="keywordflow">if</span> ( best-&gt;<a class="code" href="class_t_c_s_weak_sign_trainig.html#a61eadc9ad8fb6a961faa23fbe6fb5410">GetEpsilon</a>() &gt; current-&gt;<a class="code" href="class_t_c_s_weak_sign_trainig.html#a61eadc9ad8fb6a961faa23fbe6fb5410">GetEpsilon</a>()  )</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                bestWc = w;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        }</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        <a class="code" href="class_t_c_s_weak_sign_trainig.html">TCSWeakSignTrainig</a>* pWc       = (<a class="code" href="class_t_c_s_weak_sign_trainig.html">TCSWeakSignTrainig</a>*)m_Features.Get(bestWc);</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        pWc-&gt;<a class="code" href="class_i_l_f_weak.html#a02d5241b95e5fe950c7703c22e31fa26">SetWeight</a>((<span class="keywordtype">double</span>)pWc-&gt;<a class="code" href="class_t_c_s_weak_sign_trainig.html#a61eadc9ad8fb6a961faa23fbe6fb5410">GetEpsilon</a>());</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160; </div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        <span class="comment">// если ошибка лучшего классификатора превысила критический уровень 50%</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        <span class="comment">// прекращаем процесс накачки.</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        <span class="keywordflow">if</span> ( pWc-&gt;<a class="code" href="class_i_l_f_weak.html#ac4b6b8d3a7fec9566ffc92f69631768c">Weight</a>() &gt; 0.49 ) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160; </div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160; </div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        <span class="comment">//Update wc weight;</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        <span class="keywordtype">double</span> beta = pWc-&gt;<a class="code" href="class_i_l_f_weak.html#ac4b6b8d3a7fec9566ffc92f69631768c">Weight</a>()/ (1 - pWc-&gt;<a class="code" href="class_i_l_f_weak.html#ac4b6b8d3a7fec9566ffc92f69631768c">Weight</a>());</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;        <span class="keywordtype">double</span> min_eps = pWc-&gt;<a class="code" href="class_i_l_f_weak.html#ac4b6b8d3a7fec9566ffc92f69631768c">Weight</a>();</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        pWc-&gt;<a class="code" href="class_i_l_f_weak.html#a02d5241b95e5fe950c7703c22e31fa26">SetWeight</a> (log(1.0/beta));</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160; </div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        <span class="comment">//Добавим &quot;слабый&quot; классификатор в &quot;комитет".</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        m_ResultClass.AddWeak(pWc);</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        </div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        <span class="comment">// распечатка атрибутов классификатора</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;        DbgMsg( <span class="stringliteral">&quot;\nRound num = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(i + 1) +</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;            <span class="stringliteral">&quot;, min_eps = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(min_eps) +</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;            <span class="stringliteral">&quot;, beta = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>( beta ) +</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        <span class="stringliteral">&quot;, alpha = &quot;</span>+ <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(pWc-&gt;<a class="code" href="class_i_l_f_weak.html#ac4b6b8d3a7fec9566ffc92f69631768c">Weight</a>())+<span class="stringliteral">&quot;;\n&quot;</span> );</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160; </div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        this-&gt;Statistics();</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;        <span class="comment">// для каждого образца обновим веса</span></div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        <span class="keywordtype">double</span> wt = 0;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        {</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;            <a class="code" href="class_t_c_s_sample.html">TCSSample</a>* s = (<a class="code" href="class_t_c_s_sample.html">TCSSample</a>*)m_TrainingSamples.Get(i);</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160; </div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;            <span class="keywordtype">int</span> res = 0;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;            <span class="keywordtype">double</span> err = 0;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;            res = pWc-&gt;<a class="code" href="class_t_c_s_weak_sign.html#a2c7a93e32da16b8d7b238c3961448182">Classify</a>( s );</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160; </div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;            <span class="keywordflow">if</span> ( res == s-&gt;<a class="code" href="class_t_c_s_sample.html#a54a7b60e35ab30d59b750f7eb31ddfb4">GetFlag</a>() )</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;                s-&gt;<a class="code" href="class_t_c_s_sample.html#aac3b6bc5757dfeaf4c0bff242932f4d8">SetWeight</a>(s-&gt;<a class="code" href="class_t_c_s_sample.html#a8df9cbf13871bff310a0cb94e8e37ebe">GetWeight</a>()*beta);</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;            wt += s-&gt;<a class="code" href="class_t_c_s_sample.html#a8df9cbf13871bff310a0cb94e8e37ebe">GetWeight</a>();</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        }</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160; </div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        <span class="comment">//Normalize;</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        wt = 1.0/wt;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160; </div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        {</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;            <a class="code" href="class_t_c_s_sample.html">TCSSample</a>* s = (<a class="code" href="class_t_c_s_sample.html">TCSSample</a>*)m_TrainingSamples.Get(i);</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;            s-&gt;<a class="code" href="class_t_c_s_sample.html#aac3b6bc5757dfeaf4c0bff242932f4d8">SetWeight</a>(s-&gt;<a class="code" href="class_t_c_s_sample.html#a8df9cbf13871bff310a0cb94e8e37ebe">GetWeight</a>()*wt);</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;        }</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160; </div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        <span class="comment">//Удалим найденный признак из списка признаков         m_Features.Delete(bestWc);

    }
    //SaveROC();
    return true;
}
//
TCSStrongSign* TCSAdaBoostSign::GetResult()
{
  return &amp;m_ResultClass;
}

void    TCSAdaBoostSign::InitFeatures()
{
    m_Features.Clear();

   int sx = 1;
   int sy = 1;
   int w = 3;
   int h = 3;
   for (h = m_heightBase -3; h &gt;= 3; h-=3)
   {
       for (w = m_widthBase ; w &gt;= 3; w-=3)
       {
           for (sy = 1; sy &lt; m_heightBase - h - 1; sy++)
           {
               for (sx = 1; sx &lt; m_widthBase - w - 1; sx++)
               {
                   TCSSensor Sensor(sx, sy, w / 3, h / 3);
                   TCSWeakSignTrainig* wt = new TCSWeakSignTrainig(Sensor);
                   m_Features.Add(wt);
               }
           }
       }
   }
}

bool    TCSAdaBoostSign::LoadSamples(int flag, std::string const&amp; path)
{
    DbgMsg( &quot;Loading samples from &quot; + path + &quot;... &quot; );

    int count = 0;
    srand( (unsigned)time( NULL ) );
    int RANGE_MIN = 0;
    int RANGE_MAX = 3;

#ifdef WIN32
    intptr_t handle = 0;
    _finddata_t filesInfo;
    if ( (handle = _findfirst( (char*)((path+&quot;*.jpg&quot;).c_str()), &amp;filesInfo)) != -1 )
    {
        do
        {
           string name = path + filesInfo.name;
        
            TCSSample* pSample = new TCSSample();
            pSample-&gt;LoadFromFile((char*)name.c_str());

    //        if (pSample-&gt;Process())
            {
                pSample-&gt;SetFlag(flag);
                int r = (int)(((double) rand() / (double) RAND_MAX) * RANGE_MAX + RANGE_MIN);

                //int  r = rand(0);
                if (r &gt; 0)
                    m_TrainingSamples.Add(pSample);
                else
                    m_TestingSamples.Add(pSample);

                ++count;
            }
//            else
//printf( &quot;Can&#39;t load image %s.\n&quot;, name.c_str( ) );
        }while(!_findnext( handle, &amp;filesInfo ));


    }
    _findclose( handle );

#else

//    struct dirent** namelist;
//    if(( count = scandir( path.c_str(), &amp;namelist, jpg_filter, alphasort )) &lt; 0 )
//            return 0;

//    for( int i=0; i&lt;count; i++ )
//    {
//            string name = path + namelist[i]-&gt;d_name;

//            TCSSample* pSample = new TCSSample();
//            pSample-&gt;LoadImage((char*)name.c_str());


//                pSample-&gt;SetFlag(flag);
//              int r = (((double) rand() / (double) RAND_MAX) * RANGE_MAX + RANGE_MIN);

//                //int  r = rand(0);
//                if (r &gt; 0)
//                    m_TrainingSamples.Add(pSample);
//                else
//                    m_TestingSamples.Add(pSample);

//    }

#endif

    DbgMsg( TypeToStr( count ) + &quot; ok\n&quot; );
    return count &gt; 0;
}
void    TCSAdaBoostSign::DbgMsg( std::string const&amp; msg)
{
    std::cout&lt;&lt; msg;  
#ifdef WIN32
    m_flog &lt;&lt; msg;
    m_flog.flush();
#endif
}

void    TCSAdaBoostSign::Statistics()
{
    double errt[2] = {0,0};
    double err1[2] = { 0, 0 };
    double err2[2] = { 0, 0 };
    double erru[2] = { 0, 0 };
    for (  int i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )
    {

        TCSSample* s = (TCSSample*)m_TrainingSamples.Get(i);

        double err = 0;
        //double factor = (double)(s-&gt;GetImage()-&gt;sSizeX)/24.0;
        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        m_ResultClass.Setup(r, m_widthBase);

        int res = m_ResultClass.Classify( s-&gt;GetIntegralImage(), err );
        if (res != s-&gt;GetFlag())
        {
              errt[0]++;
              if (res == 0)
                erru[0]++;
              if (res == 1)
                err2[0]++;
              if (res == -1)
                err1[0]++;
        }
    }
    errt[0] /= m_TrainingSamples.GetCount();
    errt[0] *= 100;

    err1[0] /= (m_numSamplesBase1);
    err1[0] *= 100;

    err2[0] /= (m_numSamplesBase2);
    err2[0] *= 100;

    erru[0] /= m_TrainingSamples.GetCount();
    erru[0] *= 100;
    for (  int i = 0; i &lt; m_TestingSamples.GetCount(); i++ )
    {

        TCSSample* s = (TCSSample*)m_TestingSamples.Get(i);

        double err = 0;
        //double factor = (double)(s-&gt;GetImage()-&gt;sSizeX)/24.0;
        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        m_ResultClass.Setup(r, m_widthBase);

        int res = m_ResultClass.Classify( s-&gt;GetIntegralImage(), err );
        if (res != s-&gt;GetFlag())
        {
              errt[1]++;
              if (res == 0)
                erru[1]++;
              if (res == 1)
                err2[1]++;
              if (res == -1)
                err1[1]++;
        }
    }
    if (m_TestingSamples.GetCount() &gt; 0)
    {
    errt[1] /= m_TestingSamples.GetCount();
    errt[1] *= 100;

    err1[1] /= (m_numSamplesTestBase1);
    err1[1] *= 100;
    err2[1] /= (m_numSamplesTestBase2);
    err2[1] *= 100;


    erru[1] /= m_TestingSamples.GetCount();
    erru[1] *= 100;
    }

    DbgMsg( &quot;errt = &quot; + TypeToStr( errt[0] ) + &quot; % &quot; + TypeToStr( errt[1] ) + &quot;%;\n&quot; );
    DbgMsg( &quot;err1 = &quot; + TypeToStr( err1[0] ) + &quot; % &quot; + TypeToStr( err1[1] ) + &quot;%;\n&quot; );
    DbgMsg( &quot;err2 = &quot; + TypeToStr( err2[0] ) + &quot; % &quot; + TypeToStr( err2[1] ) + &quot;%;\n&quot;  );
    DbgMsg( &quot;erru = &quot; + TypeToStr( erru[0] ) + &quot; % &quot; + TypeToStr( erru[1] ) + &quot;%;\n&quot; );
}


struct roc_entry
{
    double far1;
    double frr1;
    double far2;
    double frr2;
};
void TCSAdaBoostSign::SaveROC(char*lpName)
{
 //
    double* fSourceClass1 = NULL;
    double* fSourceClass2 = NULL;
    roc_entry roc[100];
    memset(roc,0, sizeof(roc));
    fSourceClass1 = (double*)malloc(m_numSamplesTestBase1*sizeof(double));
    fSourceClass2 = (double*)malloc(m_numSamplesTestBase2*sizeof(double));
    memset(fSourceClass1, 0, m_numSamplesTestBase1*sizeof(double));
    memset(fSourceClass2, 0, m_numSamplesTestBase2*sizeof(double));
    int nc1 =0;
    int nc2 =0;

    for (int i = 0; i &lt; m_TestingSamples.GetCount(); i++)
    {
        TCSSample* s = (TCSSample*)m_TestingSamples.Get(i);

        awpRect r; r.left =0; r.top = 0;
        r.right = s-&gt;GetImage()-&gt;sSizeX;
        r.bottom = s-&gt;GetImage()-&gt;sSizeY;
        m_ResultClass.Setup(r, m_widthBase);
        double err = 0;
        m_ResultClass.Classify( s-&gt;GetIntegralImage(), err );
        if (s-&gt;GetFlag() == 1)
        {
            fSourceClass1[nc1] = err;
            nc1++;
        }
        else
        {
            fSourceClass2[nc2] = err;
            nc2++;
        }
    }

    double tau = m_ResultClass.GetSumWeakWeight();

    DbgMsg( TypeToStr( tau ) + &quot;\n&quot; );

    double delta = tau / 50.f;
    double stau = -tau;
    int c = 0;
    while(stau &lt; tau)
    {
        for (int i=0; i&lt; nc1; i++)
        {
            if (fSourceClass1[i] &lt; stau)
                roc[c].frr1++;
            if (fSourceClass1[i] &lt; stau)
                roc[c].far2++;
        }
        for (int i=0; i&lt; nc2; i++)
        {
            if (fSourceClass2[i] &gt; stau)
                roc[c].far1++;
            if (fSourceClass2[i] &gt; stau)
                roc[c].frr2++;
        }

        stau += delta;
        c++;
    }
    DbgMsg( TypeToStr( c ) + &quot;\n&quot; );
    for (int i = 0; i &lt; 100; i++)
    {
        roc[i].far1 = 100.f*roc[i].far1/nc2;
        roc[i].frr1 = 100.f*roc[i].frr1/nc1;
        roc[i].far2 = 100.f*roc[i].far2/nc1;
        roc[i].frr2 = 100.f*roc[i].frr2/nc2;
    }
//  std::ostream*       f;
//  f = new ofstream(&quot;roc.txt&quot;);
//  for (int i = 0; i &lt; 100; i++)
//      (*f) &lt;&lt; roc[i].far1 &lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr1&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].far2&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr2 &lt;&lt;&quot;\n&quot;;
//  delete f;
    FILE* f = fopen (lpName, &quot;w+t&quot;);
    for (int i = 0; i &lt; 100; i++)
    {
//      fprintf(f, &quot;%f\n&quot;, roc[i].far1);
        fprintf(f, &quot;%f\t%f\t%f\t%f\n&quot;, roc[i].far1, roc[i].frr1, roc[i].far2,roc[i].frr2);
    }
    //  (*f) &lt;&lt; roc[i].far1 &lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr1&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].far2&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr2 &lt;&lt;&quot;\n&quot;;
    fclose(f);
    free(fSourceClass1);
    free(fSourceClass2);
}

TIEFSAdaBoost::TIEFSAdaBoost()
{
    m_numIFS = 0;
    m_numEFS = 0;
    m_strSourceFile = &quot;&quot;;
    m_pLog = NULL;
}

bool TIEFSAdaBoost::Load(const char* lpFileName)
{
    /*попытка открыть файл конфигурации*/
    TiXmlDocument doc(lpFileName);
    if (!doc.LoadFile())
        return false;
    TiXmlElement* e = doc.FirstChildElement(&quot;IEFSBoost&quot;);
    if (e == NULL)
        return false;
    m_strSourceFile = e-&gt;Attribute(&quot;file&quot;);
    string str = e-&gt;Attribute(&quot;log&quot;);

    if (m_pLog == NULL)
        m_pLog = new ofstream(str.c_str());

    return LoadSamples();
}
// распечатка сообщения на экране и в лог файле
void TIEFSAdaBoost::DbgMsg(std::string const&amp; msg)
{
    (*m_pLog) &lt;&lt; msg;
    cout &lt;&lt; msg;
    flush(*m_pLog);
}

bool TIEFSAdaBoost::Boost()
{
    // Начало накачки.
    double wf  = 0.5 / this-&gt;m_numIFS;
    double wnf = 0.5 / this-&gt;m_numEFS;

    DbgMsg(&quot;\nBoosting started.\n&quot;);

    // Установка начальных весов для обучающего набора m_TrainingSet
    for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
    {
        TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
        if (s-&gt;GetFlag() == 1)
            s-&gt;SetWeight(wf);
        else if (s-&gt;GetFlag() == 0)
            s-&gt;SetWeight(wnf);
        else
            continue;
    }

    ProgressMeter progress;
    progress.Init(30, (int)m_TrainingSamples.GetCount());
    // result class 
    m_ResultClass.Clear();

    if (m_Features.GetCount() == 0)
        return false;

    //Main loop;
    //for (int i = 0; i &lt; this-&gt;m_Features.GetCount(); ++i)
    int i = 0;
    while (this-&gt;m_Features.GetCount() &gt; 0)
    {
        i++;
        DbgMsg(&quot;\nUpdating: &quot;);
        progress.Init(30, m_Features.GetCount());
        int count = 0;

        //Update
#pragma omp parallel for reduction(+: count)
        for (int w = 1; w &lt; m_Features.GetCount(); ++w)
        {
            ++count;
            TIEFSWeak2* wcinfo = (TIEFSWeak2*)m_Features.Get(w);
            if (!wcinfo-&gt;IsFree())
                continue;
            wcinfo-&gt;SetEpsilon(0);

            //Train section;
            wcinfo-&gt;StartTraining();
            for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
                TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
                wcinfo-&gt;AddSample(s);
            }
            wcinfo-&gt;Train();

            //Calc error;
            for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
                TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);

                int res = wcinfo-&gt;Classify(s-&gt;GetValue(w));

                if (s-&gt;GetFlag() != res)
                {
                    wcinfo-&gt;SetEpsilon(wcinfo-&gt;GetEpsilon() + s-&gt;GetWeight());
                }
            }

            if (progress.Update())
                DbgMsg(&quot;&gt;&quot;);
        }

        DbgMsg(&quot;\n&quot;);
        DbgMsg(&quot;Count stage: %d \n&quot; + TypeToStr(count));
        // выбор лучшего признака, по минимальной ошибке классификации на обучающем наборе.
        int bestWc = 1;
        while (!((TIEFSWeak2*)m_Features.Get(bestWc))-&gt;IsFree())
            bestWc++;
        for (int w = bestWc +1; w &lt; m_Features.GetCount(); ++w)
        {
            
            TIEFSWeak2* best = (TIEFSWeak2*)m_Features.Get(bestWc);
            TIEFSWeak2* current = (TIEFSWeak2*)m_Features.Get(w);
            if (!current-&gt;IsFree())
                continue;
            if (best-&gt;GetEpsilon() &gt; current-&gt;GetEpsilon())
                bestWc = w;
        }
        TIEFSWeak* pWc = (TIEFSWeak*)m_Features.Get(bestWc);
        pWc-&gt;SetWeight(pWc-&gt;GetEpsilon());

        // если ошибка лучшего классификатора превысила критический уровень 50%
        // прекращаем процесс накачки.
        if (pWc-&gt;GetWeight() &gt;= 0.5)
        {
        
            DbgMsg(&quot;\n Min eps = 0.5. Break.\n&quot;);
            break;
        }


        //Update wc weight;
        double beta = pWc-&gt;GetWeight() / (1 - pWc-&gt;GetWeight());
        double min_eps = pWc-&gt;GetWeight();
        pWc-&gt;SetWeight(log(1.0 / beta)); 

        //Добавим &quot;слабый&quot; классификатор в &quot;комитет".
        //result class  
        m_ResultClass.Add(pWc-&gt;Clone());
        m_ResultClass.SetThreshold(m_ResultClass.GetSumWeakWeight() / 2);
        pWc-&gt;Lock();
        // распечатка атрибутов классификатора
        DbgMsg(&quot;\nRound num = &quot; + TypeToStr(i + 1) +
            &quot;, min_eps = &quot; + TypeToStr(min_eps) +
            &quot;, beta = &quot; + TypeToStr(beta) +
            &quot;, alpha = &quot; + TypeToStr(pWc-&gt;GetWeight()) + &quot;;\n&quot;);
        // распечатка атрибутов выбранного признака
        DbgMsg(&quot;Feature num = &quot; + TypeToStr(pWc-&gt;GetIndex()) + &quot;\n&quot; );

        //распечатка ошибки на тестовом наборе.
        PrintStatistics();


        // для каждого образца обновим веса
        double wt = 0;
        for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
        {
            TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);

            int res = 0;

            res = pWc-&gt;Classify(s-&gt;GetValue(pWc-&gt;GetIndex()));

            if (res == s-&gt;GetFlag())
            {
                s-&gt;SetWeight(s-&gt;GetWeight()*beta);
            }
            wt += s-&gt;GetWeight();
        }

        //Normalize;
        wt = 1.0 / wt;
        double sum = 0;
        for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
        {
            TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
            s-&gt;SetWeight(s-&gt;GetWeight()*wt);
            sum += s-&gt;GetWeight();
        }
        DbgMsg(&quot;sum  = &quot; + TypeToStr(sum) + &quot;\n&quot;);
        //Удалим найденный признак из списка признаков
      //m_Features.Delete(bestWc);

    }

    this-&gt;m_ResultClass.SaveXML(&quot;IEFSclass.xml&quot;);
    if (this-&gt;m_ResultClass.LoadXML(&quot;IEFSclass.xml&quot;))
    {
        DbgMsg(&quot;Work done.\n\n&quot;);
        this-&gt;PrintStatistics();
        DbgMsg(&quot;Bye!\n&quot;);
        return true;
    }
    else
        return false;
}
double  TIEFSAdaBoost::PrintStatistics()
{
    double          dFar = 0, dFrr = 0;

    for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
    {
        TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
        double err = m_ResultClass.Raiting(s);
        if (s-&gt;GetFlag() == 1)
        {
            if (err &lt; m_ResultClass.GetThreshold()) dFrr += 1.0;
        }
        else
        {
            if (err &gt;= m_ResultClass.GetThreshold())
            {
                dFar += 1.0;
            }
        }
    }

    dFrr /= this-&gt;m_numIFS;
    dFar /= this-&gt;m_numEFS;

    DbgMsg(&quot;\nFAR = &quot; + TypeToStr(dFar) +
        &quot;, FRR = &quot; + TypeToStr(dFrr) +
        &quot;, threshold = &quot; + TypeToStr(m_ResultClass.GetThreshold()) + &quot;;\n&quot;);

    return 0;
}

bool TIEFSAdaBoost::InitFeatures(int num)
{
    if (num &lt;= 0)
    {
        DbgMsg(&quot;Invalid num features: num = &quot; +TypeToStr (num) + &quot;\n&quot;);
        return false;
    }
    for (int i = 0; i &lt; num; i++)
    {
        TIEFSWeak2* w = new TIEFSWeak2(i);
        this-&gt;m_Features.Add(w);
    }
    DbgMsg(TypeToStr(num) + &quot;features created.\n&quot;);
    return true;
}
bool TIEFSAdaBoost::LoadSamples()
{
    DbgMsg(&quot;Loading samples...\n&quot;);
    awpImage* img = NULL;
    if (awpLoadImage(this-&gt;m_strSourceFile.c_str(), &amp;img) != AWP_OK)
    {
        DbgMsg(&quot;Cannot load featues from &quot; + m_strSourceFile + &quot;\n&quot;);
        return false;
    }
    int num = img-&gt;sSizeX - 1;
    double* diff = (double*)malloc(num*sizeof(double));
    if (!this-&gt;InitFeatures(num))
    {
        awpReleaseImage(&amp;img);
        free(diff);
        return false;
    }
    double* d = (double*)img-&gt;pPixels;
    int ifs_count = 0;
    int efs_count = 0;
    for (int i = 0; i &lt; img-&gt;sSizeY; i++)
    {
        int id1 = (int)d[i*img-&gt;sSizeX];
        for (int j = i + 1; j &lt; img-&gt;sSizeY; j++)
        {
            int id2 = (int)d[j*img-&gt;sSizeX];
            int flag = id1 == id2 ? 1 : 0;
            if (!flag &amp;&amp; efs_count &gt; 730000)
                continue;
            if (flag)
                ifs_count++;
            else
                efs_count++;

            for (int k = 1; k &lt;= num; k++)
            {
                diff[k-1] = fabs(d[i*img-&gt;sSizeX + k] - d[j*img-&gt;sSizeX + k]);
            }
            TIEFSSample* s = new TIEFSSample(diff, num, flag);
            this-&gt;m_TrainingSamples.Add(s);
        }
    }
    this-&gt;m_numIFS = ifs_count;
    this-&gt;m_numEFS = efs_count;

    awpReleaseImage(&amp;img);
    free(diff);
    DbgMsg(&quot;IFS samples loaded = &quot; + TypeToStr(m_numIFS) + &quot;\n&quot;);
    DbgMsg(&quot;EFS samples loaded = &quot; + TypeToStr(m_numEFS) + &quot;\n&quot;);
    return true;
}
</span> </div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        m_Features.Delete(bestWc);</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160; </div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    }</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    <span class="comment">//SaveROC();</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;}</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00969"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost_sign.html#aa6f2353af7679fa121aaa89ecd5b402c">  969</a></span>&#160;<a class="code" href="class_t_c_s_strong_sign.html">TCSStrongSign</a>* <a class="code" href="class_t_c_s_ada_boost_sign.html#aa6f2353af7679fa121aaa89ecd5b402c">TCSAdaBoostSign::GetResult</a>()</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;{</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <span class="keywordflow">return</span> &amp;m_ResultClass;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;}</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160; </div>
<div class="line"><a name="l00974"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost_sign.html#a12f242ece282d1cefc7df01645f6b671">  974</a></span>&#160;<span class="keywordtype">void</span>    <a class="code" href="class_t_c_s_ada_boost_sign.html#a12f242ece282d1cefc7df01645f6b671">TCSAdaBoostSign::InitFeatures</a>()</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;{</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    m_Features.Clear();</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160; </div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;   <span class="keywordtype">int</span> sx = 1;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;   <span class="keywordtype">int</span> sy = 1;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;   <span class="keywordtype">int</span> w = 3;</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;   <span class="keywordtype">int</span> h = 3;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;   <span class="keywordflow">for</span> (h = m_heightBase -3; h &gt;= 3; h-=3)</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;   {</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;       <span class="keywordflow">for</span> (w = m_widthBase ; w &gt;= 3; w-=3)</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;       {</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;           <span class="keywordflow">for</span> (sy = 1; sy &lt; m_heightBase - h - 1; sy++)</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;           {</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;               <span class="keywordflow">for</span> (sx = 1; sx &lt; m_widthBase - w - 1; sx++)</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;               {</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;                   <a class="code" href="class_t_c_s_sensor.html">TCSSensor</a> Sensor(sx, sy, w / 3, h / 3);</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;                   <a class="code" href="class_t_c_s_weak_sign_trainig.html">TCSWeakSignTrainig</a>* wt = <span class="keyword">new</span> <a class="code" href="class_t_c_s_weak_sign_trainig.html">TCSWeakSignTrainig</a>(Sensor);</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;                   m_Features.Add(wt);</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;               }</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;           }</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;       }</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;   }</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;}</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160; </div>
<div class="line"><a name="l00999"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost_sign.html#a196e68f4e144396eb200453f7dd4e441">  999</a></span>&#160;<span class="keywordtype">bool</span>    <a class="code" href="class_t_c_s_ada_boost_sign.html#a196e68f4e144396eb200453f7dd4e441">TCSAdaBoostSign::LoadSamples</a>(<span class="keywordtype">int</span> flag, std::string <span class="keyword">const</span>&amp; path)</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;{</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    DbgMsg( <span class="stringliteral">&quot;Loading samples from &quot;</span> + path + <span class="stringliteral">&quot;... &quot;</span> );</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160; </div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    <span class="keywordtype">int</span> count = 0;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    srand( (<span class="keywordtype">unsigned</span>)time( NULL ) );</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <span class="keywordtype">int</span> RANGE_MIN = 0;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <span class="keywordtype">int</span> RANGE_MAX = 3;</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160; </div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="preprocessor">#ifdef WIN32</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    intptr_t handle = 0;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    _finddata_t filesInfo;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="keywordflow">if</span> ( (handle = _findfirst( (<span class="keywordtype">char</span>*)((path+<span class="stringliteral">&quot;*.jpg&quot;</span>).c_str()), &amp;filesInfo)) != -1 )</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    {</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        <span class="keywordflow">do</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        {</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;           <span class="keywordtype">string</span> name = path + filesInfo.name;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        </div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;            <a class="code" href="class_t_c_s_sample.html">TCSSample</a>* pSample = <span class="keyword">new</span> <a class="code" href="class_t_c_s_sample.html">TCSSample</a>();</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;            pSample-&gt;<a class="code" href="class_t_l_f_image.html#a55e5fc3eca44bdb372e8da303cdc086d">LoadFromFile</a>((<span class="keywordtype">char</span>*)name.c_str());</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160; </div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <span class="comment">//        if (pSample-&gt;Process())</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;            {</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                pSample-&gt;<a class="code" href="class_t_c_s_sample.html#ade35a9425888f07126fa206476aad40a">SetFlag</a>(flag);</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                <span class="keywordtype">int</span> r = (int)(((<span class="keywordtype">double</span>) rand() / (<span class="keywordtype">double</span>) RAND_MAX) * RANGE_MAX + RANGE_MIN);</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160; </div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;                <span class="comment">//int  r = rand(0);</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                <span class="keywordflow">if</span> (r &gt; 0)</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                    m_TrainingSamples.Add(pSample);</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;                    m_TestingSamples.Add(pSample);</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160; </div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;                ++count;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;            }</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="comment">//            else</span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="comment">//printf( &quot;Can&#39;t load image %s.\n&quot;, name.c_str( ) );</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        }<span class="keywordflow">while</span>(!_findnext( handle, &amp;filesInfo ));</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160; </div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160; </div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    }</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    _findclose( handle );</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160; </div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160; </div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="comment">//    struct dirent** namelist;</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="comment">//    if(( count = scandir( path.c_str(), &amp;namelist, jpg_filter, alphasort )) &lt; 0 )</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="comment">//            return 0;</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160; </div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="comment">//    for( int i=0; i&lt;count; i++ )</span></div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="comment">//    {</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="comment">//            string name = path + namelist[i]-&gt;d_name;</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160; </div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="comment">//            TCSSample* pSample = new TCSSample();</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="comment">//            pSample-&gt;LoadImage((char*)name.c_str());</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160; </div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160; </div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment">//                pSample-&gt;SetFlag(flag);</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="comment">//              int r = (((double) rand() / (double) RAND_MAX) * RANGE_MAX + RANGE_MIN);</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160; </div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="comment">//                //int  r = rand(0);</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment">//                if (r &gt; 0)</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="comment">//                    m_TrainingSamples.Add(pSample);</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment">//                else</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="comment">//                    m_TestingSamples.Add(pSample);</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160; </div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160; </div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160; </div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    DbgMsg( <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>( count ) + <span class="stringliteral">&quot; ok\n&quot;</span> );</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="keywordflow">return</span> count &gt; 0;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;}</div>
<div class="line"><a name="l01071"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost_sign.html#a4ea38c792232fe23289778c960e63213"> 1071</a></span>&#160;<span class="keywordtype">void</span>    <a class="code" href="class_t_c_s_ada_boost_sign.html#a4ea38c792232fe23289778c960e63213">TCSAdaBoostSign::DbgMsg</a>( std::string <span class="keyword">const</span>&amp; msg)</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;{</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    std::cout&lt;&lt; msg;  </div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="preprocessor">#ifdef WIN32</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    m_flog &lt;&lt; msg;</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    m_flog.flush();</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;}</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160; </div>
<div class="line"><a name="l01080"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost_sign.html#aeb1171436bf897009e4e7122d387975d"> 1080</a></span>&#160;<span class="keywordtype">void</span>    <a class="code" href="class_t_c_s_ada_boost_sign.html#aeb1171436bf897009e4e7122d387975d">TCSAdaBoostSign::Statistics</a>()</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;{</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    <span class="keywordtype">double</span> errt[2] = {0,0};</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <span class="keywordtype">double</span> err1[2] = { 0, 0 };</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <span class="keywordtype">double</span> err2[2] = { 0, 0 };</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <span class="keywordtype">double</span> erru[2] = { 0, 0 };</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <span class="keywordflow">for</span> (  <span class="keywordtype">int</span> i = 0; i &lt; m_TrainingSamples.GetCount(); i++ )</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    {</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160; </div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;        <a class="code" href="class_t_c_s_sample.html">TCSSample</a>* s = (<a class="code" href="class_t_c_s_sample.html">TCSSample</a>*)m_TrainingSamples.Get(i);</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160; </div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        <span class="keywordtype">double</span> err = 0;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;        <span class="comment">//double factor = (double)(s-&gt;GetImage()-&gt;sSizeX)/24.0;</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        awpRect r; r.left =0; r.top = 0;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;        r.right = s-&gt;<a class="code" href="class_t_l_f_image.html#a5a44ea86ac3f94f530665d047f95cc69">GetImage</a>()-&gt;sSizeX;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;        r.bottom = s-&gt;<a class="code" href="class_t_l_f_image.html#a5a44ea86ac3f94f530665d047f95cc69">GetImage</a>()-&gt;sSizeY;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;        m_ResultClass.Setup(r, m_widthBase);</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160; </div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;        <span class="keywordtype">int</span> res = m_ResultClass.Classify( s-&gt;<a class="code" href="class_t_l_f_image.html#a68b8ec8cae38332cfefa664792f06c31">GetIntegralImage</a>(), err );</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;        <span class="keywordflow">if</span> (res != s-&gt;<a class="code" href="class_t_c_s_sample.html#a54a7b60e35ab30d59b750f7eb31ddfb4">GetFlag</a>())</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;        {</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;              errt[0]++;</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;              <span class="keywordflow">if</span> (res == 0)</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;                erru[0]++;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;              <span class="keywordflow">if</span> (res == 1)</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;                err2[0]++;</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;              <span class="keywordflow">if</span> (res == -1)</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;                err1[0]++;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        }</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    }</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    errt[0] /= m_TrainingSamples.GetCount();</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    errt[0] *= 100;</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160; </div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    err1[0] /= (m_numSamplesBase1);</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    err1[0] *= 100;</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160; </div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    err2[0] /= (m_numSamplesBase2);</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    err2[0] *= 100;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160; </div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    erru[0] /= m_TrainingSamples.GetCount();</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    erru[0] *= 100;</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <span class="keywordflow">for</span> (  <span class="keywordtype">int</span> i = 0; i &lt; m_TestingSamples.GetCount(); i++ )</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    {</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160; </div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;        <a class="code" href="class_t_c_s_sample.html">TCSSample</a>* s = (<a class="code" href="class_t_c_s_sample.html">TCSSample</a>*)m_TestingSamples.Get(i);</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160; </div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;        <span class="keywordtype">double</span> err = 0;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;        <span class="comment">//double factor = (double)(s-&gt;GetImage()-&gt;sSizeX)/24.0;</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;        awpRect r; r.left =0; r.top = 0;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;        r.right = s-&gt;<a class="code" href="class_t_l_f_image.html#a5a44ea86ac3f94f530665d047f95cc69">GetImage</a>()-&gt;sSizeX;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;        r.bottom = s-&gt;<a class="code" href="class_t_l_f_image.html#a5a44ea86ac3f94f530665d047f95cc69">GetImage</a>()-&gt;sSizeY;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;        m_ResultClass.Setup(r, m_widthBase);</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160; </div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;        <span class="keywordtype">int</span> res = m_ResultClass.Classify( s-&gt;<a class="code" href="class_t_l_f_image.html#a68b8ec8cae38332cfefa664792f06c31">GetIntegralImage</a>(), err );</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;        <span class="keywordflow">if</span> (res != s-&gt;<a class="code" href="class_t_c_s_sample.html#a54a7b60e35ab30d59b750f7eb31ddfb4">GetFlag</a>())</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;        {</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;              errt[1]++;</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;              <span class="keywordflow">if</span> (res == 0)</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;                erru[1]++;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;              <span class="keywordflow">if</span> (res == 1)</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                err2[1]++;</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;              <span class="keywordflow">if</span> (res == -1)</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;                err1[1]++;</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;        }</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    }</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <span class="keywordflow">if</span> (m_TestingSamples.GetCount() &gt; 0)</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    {</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    errt[1] /= m_TestingSamples.GetCount();</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    errt[1] *= 100;</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160; </div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    err1[1] /= (m_numSamplesTestBase1);</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    err1[1] *= 100;</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    err2[1] /= (m_numSamplesTestBase2);</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    err2[1] *= 100;</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160; </div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160; </div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    erru[1] /= m_TestingSamples.GetCount();</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    erru[1] *= 100;</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    }</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160; </div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    DbgMsg( <span class="stringliteral">&quot;errt = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>( errt[0] ) + <span class="stringliteral">&quot; % &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>( errt[1] ) + <span class="stringliteral">&quot;%;\n&quot;</span> );</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    DbgMsg( <span class="stringliteral">&quot;err1 = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>( err1[0] ) + <span class="stringliteral">&quot; % &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>( err1[1] ) + <span class="stringliteral">&quot;%;\n&quot;</span> );</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    DbgMsg( <span class="stringliteral">&quot;err2 = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>( err2[0] ) + <span class="stringliteral">&quot; % &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>( err2[1] ) + <span class="stringliteral">&quot;%;\n&quot;</span>  );</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    DbgMsg( <span class="stringliteral">&quot;erru = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>( erru[0] ) + <span class="stringliteral">&quot; % &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>( erru[1] ) + <span class="stringliteral">&quot;%;\n&quot;</span> );</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;}</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160; </div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160; </div>
<div class="line"><a name="l01167"></a><span class="lineno"><a class="line" href="structroc__entry.html"> 1167</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structroc__entry.html">roc_entry</a></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;{</div>
<div class="line"><a name="l01169"></a><span class="lineno"><a class="line" href="structroc__entry.html#a3af1d5a128a88112f4ee87e91319d401"> 1169</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="structroc__entry.html#a3af1d5a128a88112f4ee87e91319d401">far1</a>;</div>
<div class="line"><a name="l01170"></a><span class="lineno"><a class="line" href="structroc__entry.html#abfcb32661474b94884813a9464304c82"> 1170</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="structroc__entry.html#abfcb32661474b94884813a9464304c82">frr1</a>;</div>
<div class="line"><a name="l01171"></a><span class="lineno"><a class="line" href="structroc__entry.html#a9f55baf22422312bbb59867900fd399b"> 1171</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="structroc__entry.html#a9f55baf22422312bbb59867900fd399b">far2</a>;</div>
<div class="line"><a name="l01172"></a><span class="lineno"><a class="line" href="structroc__entry.html#a82d05755e37d473a22d97e0d53188fde"> 1172</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="structroc__entry.html#a82d05755e37d473a22d97e0d53188fde">frr2</a>;</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;};</div>
<div class="line"><a name="l01174"></a><span class="lineno"><a class="line" href="class_t_c_s_ada_boost_sign.html#a429aba9cf67141d5707ce7998243bdff"> 1174</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_t_c_s_ada_boost_sign.html#a429aba9cf67141d5707ce7998243bdff">TCSAdaBoostSign::SaveROC</a>(<span class="keywordtype">char</span>*lpName)</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;{</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160; <span class="comment">//</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    <span class="keywordtype">double</span>* fSourceClass1 = NULL;</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    <span class="keywordtype">double</span>* fSourceClass2 = NULL;</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <a class="code" href="structroc__entry.html">roc_entry</a> roc[100];</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    memset(roc,0, <span class="keyword">sizeof</span>(roc));</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    fSourceClass1 = (<span class="keywordtype">double</span>*)malloc(m_numSamplesTestBase1*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    fSourceClass2 = (<span class="keywordtype">double</span>*)malloc(m_numSamplesTestBase2*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    memset(fSourceClass1, 0, m_numSamplesTestBase1*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    memset(fSourceClass2, 0, m_numSamplesTestBase2*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="keywordtype">int</span> nc1 =0;</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    <span class="keywordtype">int</span> nc2 =0;</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160; </div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_TestingSamples.GetCount(); i++)</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    {</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;        <a class="code" href="class_t_c_s_sample.html">TCSSample</a>* s = (<a class="code" href="class_t_c_s_sample.html">TCSSample</a>*)m_TestingSamples.Get(i);</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160; </div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;        awpRect r; r.left =0; r.top = 0;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;        r.right = s-&gt;<a class="code" href="class_t_l_f_image.html#a5a44ea86ac3f94f530665d047f95cc69">GetImage</a>()-&gt;sSizeX;</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;        r.bottom = s-&gt;<a class="code" href="class_t_l_f_image.html#a5a44ea86ac3f94f530665d047f95cc69">GetImage</a>()-&gt;sSizeY;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;        m_ResultClass.Setup(r, m_widthBase);</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        <span class="keywordtype">double</span> err = 0;</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        m_ResultClass.Classify( s-&gt;<a class="code" href="class_t_l_f_image.html#a68b8ec8cae38332cfefa664792f06c31">GetIntegralImage</a>(), err );</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;        <span class="keywordflow">if</span> (s-&gt;<a class="code" href="class_t_c_s_sample.html#a54a7b60e35ab30d59b750f7eb31ddfb4">GetFlag</a>() == 1)</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;        {</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;            fSourceClass1[nc1] = err;</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;            nc1++;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;        }</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        {</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;            fSourceClass2[nc2] = err;</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;            nc2++;</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;        }</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    }</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160; </div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    <span class="keywordtype">double</span> tau = m_ResultClass.GetSumWeakWeight();</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160; </div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    DbgMsg( <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>( tau ) + <span class="stringliteral">&quot;\n&quot;</span> );</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160; </div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    <span class="keywordtype">double</span> delta = tau / 50.f;</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    <span class="keywordtype">double</span> stau = -tau;</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    <span class="keywordtype">int</span> c = 0;</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    <span class="keywordflow">while</span>(stau &lt; tau)</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    {</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt; nc1; i++)</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;        {</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;            <span class="keywordflow">if</span> (fSourceClass1[i] &lt; stau)</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;                roc[c].<a class="code" href="structroc__entry.html#abfcb32661474b94884813a9464304c82">frr1</a>++;</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;            <span class="keywordflow">if</span> (fSourceClass1[i] &lt; stau)</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;                roc[c].<a class="code" href="structroc__entry.html#a9f55baf22422312bbb59867900fd399b">far2</a>++;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;        }</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt; nc2; i++)</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;        {</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;            <span class="keywordflow">if</span> (fSourceClass2[i] &gt; stau)</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;                roc[c].<a class="code" href="structroc__entry.html#a3af1d5a128a88112f4ee87e91319d401">far1</a>++;</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;            <span class="keywordflow">if</span> (fSourceClass2[i] &gt; stau)</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;                roc[c].<a class="code" href="structroc__entry.html#a82d05755e37d473a22d97e0d53188fde">frr2</a>++;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        }</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160; </div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;        stau += delta;</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;        c++;</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    }</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    DbgMsg( <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>( c ) + <span class="stringliteral">&quot;\n&quot;</span> );</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 100; i++)</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    {</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        roc[i].<a class="code" href="structroc__entry.html#a3af1d5a128a88112f4ee87e91319d401">far1</a> = 100.f*roc[i].<a class="code" href="structroc__entry.html#a3af1d5a128a88112f4ee87e91319d401">far1</a>/nc2;</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;        roc[i].<a class="code" href="structroc__entry.html#abfcb32661474b94884813a9464304c82">frr1</a> = 100.f*roc[i].<a class="code" href="structroc__entry.html#abfcb32661474b94884813a9464304c82">frr1</a>/nc1;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;        roc[i].<a class="code" href="structroc__entry.html#a9f55baf22422312bbb59867900fd399b">far2</a> = 100.f*roc[i].<a class="code" href="structroc__entry.html#a9f55baf22422312bbb59867900fd399b">far2</a>/nc1;</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        roc[i].<a class="code" href="structroc__entry.html#a82d05755e37d473a22d97e0d53188fde">frr2</a> = 100.f*roc[i].<a class="code" href="structroc__entry.html#a82d05755e37d473a22d97e0d53188fde">frr2</a>/nc2;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    }</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;<span class="comment">//  std::ostream*       f;</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;<span class="comment">//  f = new ofstream(&quot;roc.txt&quot;);</span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;<span class="comment">//  for (int i = 0; i &lt; 100; i++)</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="comment">//      (*f) &lt;&lt; roc[i].far1 &lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr1&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].far2&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr2 &lt;&lt;&quot;\n&quot;;</span></div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="comment">//  delete f;</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    FILE* f = fopen (lpName, <span class="stringliteral">&quot;w+t&quot;</span>);</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 100; i++)</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    {</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="comment">//      fprintf(f, &quot;%f\n&quot;, roc[i].far1);</span></div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;        fprintf(f, <span class="stringliteral">&quot;%f\t%f\t%f\t%f\n&quot;</span>, roc[i].far1, roc[i].frr1, roc[i].far2,roc[i].frr2);</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    }</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    <span class="comment">//  (*f) &lt;&lt; roc[i].far1 &lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr1&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].far2&lt;&lt; &quot;\t&quot; &lt;&lt; roc[i].frr2 &lt;&lt;&quot;\n&quot;;</span></div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    fclose(f);</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    free(fSourceClass1);</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    free(fSourceClass2);</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;}</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160; </div>
<div class="line"><a name="l01262"></a><span class="lineno"><a class="line" href="class_t_i_e_f_s_ada_boost.html#a65181f4e8b2013145954b6f313c38b80"> 1262</a></span>&#160;<a class="code" href="class_t_i_e_f_s_ada_boost.html#a65181f4e8b2013145954b6f313c38b80">TIEFSAdaBoost::TIEFSAdaBoost</a>()</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;{</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    m_numIFS = 0;</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    m_numEFS = 0;</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    m_strSourceFile = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    m_pLog = NULL;</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;}</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160; </div>
<div class="line"><a name="l01270"></a><span class="lineno"><a class="line" href="class_t_i_e_f_s_ada_boost.html#a35d561c823c2578532fe6cbb416f5345"> 1270</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_t_i_e_f_s_ada_boost.html#a35d561c823c2578532fe6cbb416f5345">TIEFSAdaBoost::Load</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* lpFileName)</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;{</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <span class="comment">/*попытка открыть файл конфигурации*/</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    TiXmlDocument doc(lpFileName);</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    <span class="keywordflow">if</span> (!doc.LoadFile())</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    TiXmlElement* e = doc.FirstChildElement(<span class="stringliteral">&quot;IEFSBoost&quot;</span>);</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    <span class="keywordflow">if</span> (e == NULL)</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    m_strSourceFile = e-&gt;Attribute(<span class="stringliteral">&quot;file&quot;</span>);</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    <span class="keywordtype">string</span> str = e-&gt;Attribute(<span class="stringliteral">&quot;log&quot;</span>);</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160; </div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    <span class="keywordflow">if</span> (m_pLog == NULL)</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;        m_pLog = <span class="keyword">new</span> ofstream(str.c_str());</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160; </div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    <span class="keywordflow">return</span> LoadSamples();</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;}</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;<span class="comment">// распечатка сообщения на экране и в лог файле void TIEFSAdaBoost::DbgMsg(std::string const&amp; msg)
{
    (*m_pLog) &lt;&lt; msg;
    cout &lt;&lt; msg;
    flush(*m_pLog);
}

bool TIEFSAdaBoost::Boost()
{
    // Начало накачки.
    double wf  = 0.5 / this-&gt;m_numIFS;
    double wnf = 0.5 / this-&gt;m_numEFS;

    DbgMsg(&quot;\nBoosting started.\n&quot;);

    // Установка начальных весов для обучающего набора m_TrainingSet
    for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
    {
        TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
        if (s-&gt;GetFlag() == 1)
            s-&gt;SetWeight(wf);
        else if (s-&gt;GetFlag() == 0)
            s-&gt;SetWeight(wnf);
        else
            continue;
    }

    ProgressMeter progress;
    progress.Init(30, (int)m_TrainingSamples.GetCount());
    // result class 
    m_ResultClass.Clear();

    if (m_Features.GetCount() == 0)
        return false;

    //Main loop;
    //for (int i = 0; i &lt; this-&gt;m_Features.GetCount(); ++i)
    int i = 0;
    while (this-&gt;m_Features.GetCount() &gt; 0)
    {
        i++;
        DbgMsg(&quot;\nUpdating: &quot;);
        progress.Init(30, m_Features.GetCount());
        int count = 0;

        //Update
#pragma omp parallel for reduction(+: count)
        for (int w = 1; w &lt; m_Features.GetCount(); ++w)
        {
            ++count;
            TIEFSWeak2* wcinfo = (TIEFSWeak2*)m_Features.Get(w);
            if (!wcinfo-&gt;IsFree())
                continue;
            wcinfo-&gt;SetEpsilon(0);

            //Train section;
            wcinfo-&gt;StartTraining();
            for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
                TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
                wcinfo-&gt;AddSample(s);
            }
            wcinfo-&gt;Train();

            //Calc error;
            for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
            {
                TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);

                int res = wcinfo-&gt;Classify(s-&gt;GetValue(w));

                if (s-&gt;GetFlag() != res)
                {
                    wcinfo-&gt;SetEpsilon(wcinfo-&gt;GetEpsilon() + s-&gt;GetWeight());
                }
            }

            if (progress.Update())
                DbgMsg(&quot;&gt;&quot;);
        }

        DbgMsg(&quot;\n&quot;);
        DbgMsg(&quot;Count stage: %d \n&quot; + TypeToStr(count));
        // выбор лучшего признака, по минимальной ошибке классификации на обучающем наборе.
        int bestWc = 1;
        while (!((TIEFSWeak2*)m_Features.Get(bestWc))-&gt;IsFree())
            bestWc++;
        for (int w = bestWc +1; w &lt; m_Features.GetCount(); ++w)
        {
            
            TIEFSWeak2* best = (TIEFSWeak2*)m_Features.Get(bestWc);
            TIEFSWeak2* current = (TIEFSWeak2*)m_Features.Get(w);
            if (!current-&gt;IsFree())
                continue;
            if (best-&gt;GetEpsilon() &gt; current-&gt;GetEpsilon())
                bestWc = w;
        }
        TIEFSWeak* pWc = (TIEFSWeak*)m_Features.Get(bestWc);
        pWc-&gt;SetWeight(pWc-&gt;GetEpsilon());

        // если ошибка лучшего классификатора превысила критический уровень 50%
        // прекращаем процесс накачки.
        if (pWc-&gt;GetWeight() &gt;= 0.5)
        {
        
            DbgMsg(&quot;\n Min eps = 0.5. Break.\n&quot;);
            break;
        }


        //Update wc weight;
        double beta = pWc-&gt;GetWeight() / (1 - pWc-&gt;GetWeight());
        double min_eps = pWc-&gt;GetWeight();
        pWc-&gt;SetWeight(log(1.0 / beta)); 

        //Добавим &quot;слабый&quot; классификатор в &quot;комитет".
        //result class  
        m_ResultClass.Add(pWc-&gt;Clone());
        m_ResultClass.SetThreshold(m_ResultClass.GetSumWeakWeight() / 2);
        pWc-&gt;Lock();
        // распечатка атрибутов классификатора
        DbgMsg(&quot;\nRound num = &quot; + TypeToStr(i + 1) +
            &quot;, min_eps = &quot; + TypeToStr(min_eps) +
            &quot;, beta = &quot; + TypeToStr(beta) +
            &quot;, alpha = &quot; + TypeToStr(pWc-&gt;GetWeight()) + &quot;;\n&quot;);
        // распечатка атрибутов выбранного признака
        DbgMsg(&quot;Feature num = &quot; + TypeToStr(pWc-&gt;GetIndex()) + &quot;\n&quot; );

        //распечатка ошибки на тестовом наборе.
        PrintStatistics();


        // для каждого образца обновим веса
        double wt = 0;
        for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
        {
            TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);

            int res = 0;

            res = pWc-&gt;Classify(s-&gt;GetValue(pWc-&gt;GetIndex()));

            if (res == s-&gt;GetFlag())
            {
                s-&gt;SetWeight(s-&gt;GetWeight()*beta);
            }
            wt += s-&gt;GetWeight();
        }

        //Normalize;
        wt = 1.0 / wt;
        double sum = 0;
        for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
        {
            TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
            s-&gt;SetWeight(s-&gt;GetWeight()*wt);
            sum += s-&gt;GetWeight();
        }
        DbgMsg(&quot;sum  = &quot; + TypeToStr(sum) + &quot;\n&quot;);
        //Удалим найденный признак из списка признаков
      //m_Features.Delete(bestWc);

    }

    this-&gt;m_ResultClass.SaveXML(&quot;IEFSclass.xml&quot;);
    if (this-&gt;m_ResultClass.LoadXML(&quot;IEFSclass.xml&quot;))
    {
        DbgMsg(&quot;Work done.\n\n&quot;);
        this-&gt;PrintStatistics();
        DbgMsg(&quot;Bye!\n&quot;);
        return true;
    }
    else
        return false;
}
double  TIEFSAdaBoost::PrintStatistics()
{
    double          dFar = 0, dFrr = 0;

    for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
    {
        TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
        double err = m_ResultClass.Raiting(s);
        if (s-&gt;GetFlag() == 1)
        {
            if (err &lt; m_ResultClass.GetThreshold()) dFrr += 1.0;
        }
        else
        {
            if (err &gt;= m_ResultClass.GetThreshold())
            {
                dFar += 1.0;
            }
        }
    }

    dFrr /= this-&gt;m_numIFS;
    dFar /= this-&gt;m_numEFS;

    DbgMsg(&quot;\nFAR = &quot; + TypeToStr(dFar) +
        &quot;, FRR = &quot; + TypeToStr(dFrr) +
        &quot;, threshold = &quot; + TypeToStr(m_ResultClass.GetThreshold()) + &quot;;\n&quot;);

    return 0;
}

bool TIEFSAdaBoost::InitFeatures(int num)
{
    if (num &lt;= 0)
    {
        DbgMsg(&quot;Invalid num features: num = &quot; +TypeToStr (num) + &quot;\n&quot;);
        return false;
    }
    for (int i = 0; i &lt; num; i++)
    {
        TIEFSWeak2* w = new TIEFSWeak2(i);
        this-&gt;m_Features.Add(w);
    }
    DbgMsg(TypeToStr(num) + &quot;features created.\n&quot;);
    return true;
}
bool TIEFSAdaBoost::LoadSamples()
{
    DbgMsg(&quot;Loading samples...\n&quot;);
    awpImage* img = NULL;
    if (awpLoadImage(this-&gt;m_strSourceFile.c_str(), &amp;img) != AWP_OK)
    {
        DbgMsg(&quot;Cannot load featues from &quot; + m_strSourceFile + &quot;\n&quot;);
        return false;
    }
    int num = img-&gt;sSizeX - 1;
    double* diff = (double*)malloc(num*sizeof(double));
    if (!this-&gt;InitFeatures(num))
    {
        awpReleaseImage(&amp;img);
        free(diff);
        return false;
    }
    double* d = (double*)img-&gt;pPixels;
    int ifs_count = 0;
    int efs_count = 0;
    for (int i = 0; i &lt; img-&gt;sSizeY; i++)
    {
        int id1 = (int)d[i*img-&gt;sSizeX];
        for (int j = i + 1; j &lt; img-&gt;sSizeY; j++)
        {
            int id2 = (int)d[j*img-&gt;sSizeX];
            int flag = id1 == id2 ? 1 : 0;
            if (!flag &amp;&amp; efs_count &gt; 730000)
                continue;
            if (flag)
                ifs_count++;
            else
                efs_count++;

            for (int k = 1; k &lt;= num; k++)
            {
                diff[k-1] = fabs(d[i*img-&gt;sSizeX + k] - d[j*img-&gt;sSizeX + k]);
            }
            TIEFSSample* s = new TIEFSSample(diff, num, flag);
            this-&gt;m_TrainingSamples.Add(s);
        }
    }
    this-&gt;m_numIFS = ifs_count;
    this-&gt;m_numEFS = efs_count;

    awpReleaseImage(&amp;img);
    free(diff);
    DbgMsg(&quot;IFS samples loaded = &quot; + TypeToStr(m_numIFS) + &quot;\n&quot;);
    DbgMsg(&quot;EFS samples loaded = &quot; + TypeToStr(m_numEFS) + &quot;\n&quot;);
    return true;
}
</span> </div>
<div class="line"><a name="l01288"></a><span class="lineno"><a class="line" href="class_t_i_e_f_s_ada_boost.html#ad3c132d6e7ca1e8255090f0cbf3d3600"> 1288</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_t_i_e_f_s_ada_boost.html#ad3c132d6e7ca1e8255090f0cbf3d3600">TIEFSAdaBoost::DbgMsg</a>(std::string <span class="keyword">const</span>&amp; msg)</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;{</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    (*m_pLog) &lt;&lt; msg;</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    cout &lt;&lt; msg;</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    flush(*m_pLog);</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;}</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160; </div>
<div class="line"><a name="l01295"></a><span class="lineno"><a class="line" href="class_t_i_e_f_s_ada_boost.html#a20279b218d355bc5c84cebfc8e18354b"> 1295</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_t_i_e_f_s_ada_boost.html#a20279b218d355bc5c84cebfc8e18354b">TIEFSAdaBoost::Boost</a>()</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;{</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    <span class="comment">// Начало накачки.</span></div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    <span class="keywordtype">double</span> wf  = 0.5 / this-&gt;m_numIFS;</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    <span class="keywordtype">double</span> wnf = 0.5 / this-&gt;m_numEFS;</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160; </div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    DbgMsg(<span class="stringliteral">&quot;\nBoosting started.\n&quot;</span>);</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160; </div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    <span class="comment">// Установка начальных весов для обучающего набора m_TrainingSet</span></div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_TrainingSamples.GetCount(); i++)</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    {</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;        <a class="code" href="class_t_i_e_f_s_sample.html">TIEFSSample</a>* s = (<a class="code" href="class_t_i_e_f_s_sample.html">TIEFSSample</a>*)m_TrainingSamples.Get(i);</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;        <span class="keywordflow">if</span> (s-&gt;<a class="code" href="class_t_i_e_f_s_sample.html#a07c56c83555e7d6c392f40e27394dde9">GetFlag</a>() == 1)</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;            s-&gt;<a class="code" href="class_t_i_e_f_s_sample.html#a1fe035b0b79ab77e1f273dfa3c6847da">SetWeight</a>(wf);</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s-&gt;<a class="code" href="class_t_i_e_f_s_sample.html#a07c56c83555e7d6c392f40e27394dde9">GetFlag</a>() == 0)</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;            s-&gt;<a class="code" href="class_t_i_e_f_s_sample.html#a1fe035b0b79ab77e1f273dfa3c6847da">SetWeight</a>(wnf);</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    }</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160; </div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    <a class="code" href="class_progress_meter.html">ProgressMeter</a> progress;</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    progress.<a class="code" href="class_progress_meter.html#a135acb682c55a6aed758d164aab5a0e7">Init</a>(30, (<span class="keywordtype">int</span>)m_TrainingSamples.GetCount());</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    <span class="comment">// result class </span></div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    m_ResultClass.Clear();</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160; </div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    <span class="keywordflow">if</span> (m_Features.GetCount() == 0)</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160; </div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    <span class="comment">//Main loop;</span></div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    <span class="comment">//for (int i = 0; i &lt; this-&gt;m_Features.GetCount(); ++i)</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    <span class="keywordtype">int</span> i = 0;</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    <span class="keywordflow">while</span> (this-&gt;m_Features.GetCount() &gt; 0)</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    {</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;        i++;</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        DbgMsg(<span class="stringliteral">&quot;\nUpdating: &quot;</span>);</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;        progress.<a class="code" href="class_progress_meter.html#a135acb682c55a6aed758d164aab5a0e7">Init</a>(30, m_Features.GetCount());</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        <span class="keywordtype">int</span> count = 0;</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160; </div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        <span class="comment">//Update</span></div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="preprocessor">#pragma omp parallel for reduction(+: count)</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> w = 1; w &lt; m_Features.GetCount(); ++w)</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;        {</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;            ++count;</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;            <a class="code" href="class_t_i_e_f_s_weak2.html">TIEFSWeak2</a>* wcinfo = (<a class="code" href="class_t_i_e_f_s_weak2.html">TIEFSWeak2</a>*)m_Features.Get(w);</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;            <span class="keywordflow">if</span> (!wcinfo-&gt;<a class="code" href="class_t_i_e_f_s_weak2.html#a9828ebb937256e233f0f03d8072dba1f">IsFree</a>())</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;            wcinfo-&gt;<a class="code" href="class_t_i_e_f_s_weak2.html#a7ff38acda5f5cd477b08615c82aa48fb">SetEpsilon</a>(0);</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160; </div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;            <span class="comment">//Train section;</span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;            wcinfo-&gt;<a class="code" href="class_t_i_e_f_s_weak2.html#a4e52c79caef5978125ff3499bbb9b96a">StartTraining</a>();</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_TrainingSamples.GetCount(); i++)</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;            {</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;                <a class="code" href="class_t_i_e_f_s_sample.html">TIEFSSample</a>* s = (<a class="code" href="class_t_i_e_f_s_sample.html">TIEFSSample</a>*)m_TrainingSamples.Get(i);</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;                wcinfo-&gt;<a class="code" href="class_t_i_e_f_s_weak2.html#a002afc3c989b0e090b04c9b7e9ae841c">AddSample</a>(s);</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;            }</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;            wcinfo-&gt;<a class="code" href="class_t_i_e_f_s_weak2.html#a5179a87c1b7c61757aa02b851279d63f">Train</a>();</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160; </div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;            <span class="comment">//Calc error;</span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_TrainingSamples.GetCount(); i++)</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;            {</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;                <a class="code" href="class_t_i_e_f_s_sample.html">TIEFSSample</a>* s = (<a class="code" href="class_t_i_e_f_s_sample.html">TIEFSSample</a>*)m_TrainingSamples.Get(i);</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160; </div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;                <span class="keywordtype">int</span> res = wcinfo-&gt;<a class="code" href="class_t_i_e_f_s_weak2.html#a55ce01134d588ad3ca99982893adc3e1">Classify</a>(s-&gt;<a class="code" href="class_t_i_e_f_s_sample.html#a01abfb349375911bf682e037d41bc1a8">GetValue</a>(w));</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160; </div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;                <span class="keywordflow">if</span> (s-&gt;<a class="code" href="class_t_i_e_f_s_sample.html#a07c56c83555e7d6c392f40e27394dde9">GetFlag</a>() != res)</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;                {</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;                    wcinfo-&gt;<a class="code" href="class_t_i_e_f_s_weak2.html#a7ff38acda5f5cd477b08615c82aa48fb">SetEpsilon</a>(wcinfo-&gt;<a class="code" href="class_t_i_e_f_s_weak2.html#a1ad7f04d3ce4af8b17b5be7e3315b99a">GetEpsilon</a>() + s-&gt;<a class="code" href="class_t_i_e_f_s_sample.html#a3768ef2072a4f41017be24acb5251910">GetWeight</a>());</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;                }</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;            }</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160; </div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;            <span class="keywordflow">if</span> (progress.<a class="code" href="class_progress_meter.html#ac3902e5affdd16dcec5042d24e8c3512">Update</a>())</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                DbgMsg(<span class="stringliteral">&quot;&gt;&quot;</span>);</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;        }</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160; </div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        DbgMsg(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;        DbgMsg(<span class="stringliteral">&quot;Count stage: %d \n&quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(count));</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;        <span class="comment">// выбор лучшего признака, по минимальной ошибке классификации на обучающем наборе.</span></div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;        <span class="keywordtype">int</span> bestWc = 1;</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;        <span class="keywordflow">while</span> (!((<a class="code" href="class_t_i_e_f_s_weak2.html">TIEFSWeak2</a>*)m_Features.Get(bestWc))-&gt;IsFree())</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;            bestWc++;</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> w = bestWc +1; w &lt; m_Features.GetCount(); ++w)</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;        {</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;            </div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;            <a class="code" href="class_t_i_e_f_s_weak2.html">TIEFSWeak2</a>* best = (<a class="code" href="class_t_i_e_f_s_weak2.html">TIEFSWeak2</a>*)m_Features.Get(bestWc);</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;            <a class="code" href="class_t_i_e_f_s_weak2.html">TIEFSWeak2</a>* current = (<a class="code" href="class_t_i_e_f_s_weak2.html">TIEFSWeak2</a>*)m_Features.Get(w);</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;            <span class="keywordflow">if</span> (!current-&gt;<a class="code" href="class_t_i_e_f_s_weak2.html#a9828ebb937256e233f0f03d8072dba1f">IsFree</a>())</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;            <span class="keywordflow">if</span> (best-&gt;<a class="code" href="class_t_i_e_f_s_weak2.html#a1ad7f04d3ce4af8b17b5be7e3315b99a">GetEpsilon</a>() &gt; current-&gt;<a class="code" href="class_t_i_e_f_s_weak2.html#a1ad7f04d3ce4af8b17b5be7e3315b99a">GetEpsilon</a>())</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;                bestWc = w;</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;        }</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;        <a class="code" href="class_t_i_e_f_s_weak.html">TIEFSWeak</a>* pWc = (<a class="code" href="class_t_i_e_f_s_weak.html">TIEFSWeak</a>*)m_Features.Get(bestWc);</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;        pWc-&gt;<a class="code" href="class_t_i_e_f_s_weak.html#ae5af9bf80fbfbda3eafe81174a394df9">SetWeight</a>(pWc-&gt;<a class="code" href="class_t_i_e_f_s_weak.html#ad1a25dbee5eae597f2b13ce0c230c890">GetEpsilon</a>());</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160; </div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;        <span class="comment">// если ошибка лучшего классификатора превысила критический уровень 50%</span></div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;        <span class="comment">// прекращаем процесс накачки.</span></div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;        <span class="keywordflow">if</span> (pWc-&gt;<a class="code" href="class_t_i_e_f_s_weak.html#a77a6851962d96705506856fbaedf8aa3">GetWeight</a>() &gt;= 0.5)</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;        {</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;        </div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;            DbgMsg(<span class="stringliteral">&quot;\n Min eps = 0.5. Break.\n&quot;</span>);</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;        }</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160; </div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160; </div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;        <span class="comment">//Update wc weight;</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;        <span class="keywordtype">double</span> beta = pWc-&gt;<a class="code" href="class_t_i_e_f_s_weak.html#a77a6851962d96705506856fbaedf8aa3">GetWeight</a>() / (1 - pWc-&gt;<a class="code" href="class_t_i_e_f_s_weak.html#a77a6851962d96705506856fbaedf8aa3">GetWeight</a>());</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;        <span class="keywordtype">double</span> min_eps = pWc-&gt;<a class="code" href="class_t_i_e_f_s_weak.html#a77a6851962d96705506856fbaedf8aa3">GetWeight</a>();</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;        pWc-&gt;<a class="code" href="class_t_i_e_f_s_weak.html#ae5af9bf80fbfbda3eafe81174a394df9">SetWeight</a>(log(1.0 / beta)); </div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160; </div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;        <span class="comment">//Добавим &quot;слабый&quot; классификатор в &quot;комитет".</span></div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;        <span class="comment">//result class  </span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;        m_ResultClass.Add(pWc-&gt;<a class="code" href="class_t_i_e_f_s_weak.html#a6b1d72a07d3847f1caf3bdf7e26cb557">Clone</a>());</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;        m_ResultClass.SetThreshold(m_ResultClass.GetSumWeakWeight() / 2);</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;        pWc-&gt;<a class="code" href="class_t_i_e_f_s_weak.html#a66ceae7f84119894b758c817f52e0d81">Lock</a>();</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;        <span class="comment">// распечатка атрибутов классификатора</span></div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;        DbgMsg(<span class="stringliteral">&quot;\nRound num = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(i + 1) +</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;            <span class="stringliteral">&quot;, min_eps = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(min_eps) +</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;            <span class="stringliteral">&quot;, beta = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(beta) +</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;            <span class="stringliteral">&quot;, alpha = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(pWc-&gt;<a class="code" href="class_t_i_e_f_s_weak.html#a77a6851962d96705506856fbaedf8aa3">GetWeight</a>()) + <span class="stringliteral">&quot;;\n&quot;</span>);</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;        <span class="comment">// распечатка атрибутов выбранного признака</span></div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;        DbgMsg(<span class="stringliteral">&quot;Feature num = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(pWc-&gt;<a class="code" href="class_t_i_e_f_s_weak.html#a2778dbc7b54cf984592d3dad573b9084">GetIndex</a>()) + <span class="stringliteral">&quot;\n&quot;</span> );</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160; </div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;        <span class="comment">//распечатка ошибки на тестовом наборе.</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        PrintStatistics();</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160; </div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160; </div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;        <span class="comment">// для каждого образца обновим веса</span></div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;        <span class="keywordtype">double</span> wt = 0;</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_TrainingSamples.GetCount(); i++)</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;        {</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;            <a class="code" href="class_t_i_e_f_s_sample.html">TIEFSSample</a>* s = (<a class="code" href="class_t_i_e_f_s_sample.html">TIEFSSample</a>*)m_TrainingSamples.Get(i);</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160; </div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;            <span class="keywordtype">int</span> res = 0;</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160; </div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;            res = pWc-&gt;<a class="code" href="class_t_i_e_f_s_weak.html#a00075d8ffdbaf06d39814b3b6672116b">Classify</a>(s-&gt;<a class="code" href="class_t_i_e_f_s_sample.html#a01abfb349375911bf682e037d41bc1a8">GetValue</a>(pWc-&gt;<a class="code" href="class_t_i_e_f_s_weak.html#a2778dbc7b54cf984592d3dad573b9084">GetIndex</a>()));</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160; </div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;            <span class="keywordflow">if</span> (res == s-&gt;<a class="code" href="class_t_i_e_f_s_sample.html#a07c56c83555e7d6c392f40e27394dde9">GetFlag</a>())</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;            {</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;                s-&gt;<a class="code" href="class_t_i_e_f_s_sample.html#a1fe035b0b79ab77e1f273dfa3c6847da">SetWeight</a>(s-&gt;<a class="code" href="class_t_i_e_f_s_sample.html#a3768ef2072a4f41017be24acb5251910">GetWeight</a>()*beta);</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;            }</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;            wt += s-&gt;<a class="code" href="class_t_i_e_f_s_sample.html#a3768ef2072a4f41017be24acb5251910">GetWeight</a>();</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;        }</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160; </div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;        <span class="comment">//Normalize;</span></div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;        wt = 1.0 / wt;</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;        <span class="keywordtype">double</span> sum = 0;</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_TrainingSamples.GetCount(); i++)</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;        {</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;            <a class="code" href="class_t_i_e_f_s_sample.html">TIEFSSample</a>* s = (<a class="code" href="class_t_i_e_f_s_sample.html">TIEFSSample</a>*)m_TrainingSamples.Get(i);</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;            s-&gt;<a class="code" href="class_t_i_e_f_s_sample.html#a1fe035b0b79ab77e1f273dfa3c6847da">SetWeight</a>(s-&gt;<a class="code" href="class_t_i_e_f_s_sample.html#a3768ef2072a4f41017be24acb5251910">GetWeight</a>()*wt);</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;            sum += s-&gt;<a class="code" href="class_t_i_e_f_s_sample.html#a3768ef2072a4f41017be24acb5251910">GetWeight</a>();</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;        }</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;        DbgMsg(<span class="stringliteral">&quot;sum  = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(sum) + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;        <span class="comment">//Удалим найденный признак из списка признаков       //m_Features.Delete(bestWc);

    }

    this-&gt;m_ResultClass.SaveXML(&quot;IEFSclass.xml&quot;);
    if (this-&gt;m_ResultClass.LoadXML(&quot;IEFSclass.xml&quot;))
    {
        DbgMsg(&quot;Work done.\n\n&quot;);
        this-&gt;PrintStatistics();
        DbgMsg(&quot;Bye!\n&quot;);
        return true;
    }
    else
        return false;
}
double  TIEFSAdaBoost::PrintStatistics()
{
    double          dFar = 0, dFrr = 0;

    for (int i = 0; i &lt; m_TrainingSamples.GetCount(); i++)
    {
        TIEFSSample* s = (TIEFSSample*)m_TrainingSamples.Get(i);
        double err = m_ResultClass.Raiting(s);
        if (s-&gt;GetFlag() == 1)
        {
            if (err &lt; m_ResultClass.GetThreshold()) dFrr += 1.0;
        }
        else
        {
            if (err &gt;= m_ResultClass.GetThreshold())
            {
                dFar += 1.0;
            }
        }
    }

    dFrr /= this-&gt;m_numIFS;
    dFar /= this-&gt;m_numEFS;

    DbgMsg(&quot;\nFAR = &quot; + TypeToStr(dFar) +
        &quot;, FRR = &quot; + TypeToStr(dFrr) +
        &quot;, threshold = &quot; + TypeToStr(m_ResultClass.GetThreshold()) + &quot;;\n&quot;);

    return 0;
}

bool TIEFSAdaBoost::InitFeatures(int num)
{
    if (num &lt;= 0)
    {
        DbgMsg(&quot;Invalid num features: num = &quot; +TypeToStr (num) + &quot;\n&quot;);
        return false;
    }
    for (int i = 0; i &lt; num; i++)
    {
        TIEFSWeak2* w = new TIEFSWeak2(i);
        this-&gt;m_Features.Add(w);
    }
    DbgMsg(TypeToStr(num) + &quot;features created.\n&quot;);
    return true;
}
bool TIEFSAdaBoost::LoadSamples()
{
    DbgMsg(&quot;Loading samples...\n&quot;);
    awpImage* img = NULL;
    if (awpLoadImage(this-&gt;m_strSourceFile.c_str(), &amp;img) != AWP_OK)
    {
        DbgMsg(&quot;Cannot load featues from &quot; + m_strSourceFile + &quot;\n&quot;);
        return false;
    }
    int num = img-&gt;sSizeX - 1;
    double* diff = (double*)malloc(num*sizeof(double));
    if (!this-&gt;InitFeatures(num))
    {
        awpReleaseImage(&amp;img);
        free(diff);
        return false;
    }
    double* d = (double*)img-&gt;pPixels;
    int ifs_count = 0;
    int efs_count = 0;
    for (int i = 0; i &lt; img-&gt;sSizeY; i++)
    {
        int id1 = (int)d[i*img-&gt;sSizeX];
        for (int j = i + 1; j &lt; img-&gt;sSizeY; j++)
        {
            int id2 = (int)d[j*img-&gt;sSizeX];
            int flag = id1 == id2 ? 1 : 0;
            if (!flag &amp;&amp; efs_count &gt; 730000)
                continue;
            if (flag)
                ifs_count++;
            else
                efs_count++;

            for (int k = 1; k &lt;= num; k++)
            {
                diff[k-1] = fabs(d[i*img-&gt;sSizeX + k] - d[j*img-&gt;sSizeX + k]);
            }
            TIEFSSample* s = new TIEFSSample(diff, num, flag);
            this-&gt;m_TrainingSamples.Add(s);
        }
    }
    this-&gt;m_numIFS = ifs_count;
    this-&gt;m_numEFS = efs_count;

    awpReleaseImage(&amp;img);
    free(diff);
    DbgMsg(&quot;IFS samples loaded = &quot; + TypeToStr(m_numIFS) + &quot;\n&quot;);
    DbgMsg(&quot;EFS samples loaded = &quot; + TypeToStr(m_numEFS) + &quot;\n&quot;);
    return true;
}
</span> </div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;        <span class="comment">//m_Features.Delete(bestWc);</span></div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160; </div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    }</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160; </div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    this-&gt;m_ResultClass.SaveXML(<span class="stringliteral">&quot;IEFSclass.xml&quot;</span>);</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    <span class="keywordflow">if</span> (this-&gt;m_ResultClass.LoadXML(<span class="stringliteral">&quot;IEFSclass.xml&quot;</span>))</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    {</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;        DbgMsg(<span class="stringliteral">&quot;Work done.\n\n&quot;</span>);</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        this-&gt;PrintStatistics();</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        DbgMsg(<span class="stringliteral">&quot;Bye!\n&quot;</span>);</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    }</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;}</div>
<div class="line"><a name="l01463"></a><span class="lineno"><a class="line" href="class_t_i_e_f_s_ada_boost.html#afb9305ff3a6cfe79b9022e7c07e68e2e"> 1463</a></span>&#160;<span class="keywordtype">double</span>  <a class="code" href="class_t_i_e_f_s_ada_boost.html#afb9305ff3a6cfe79b9022e7c07e68e2e">TIEFSAdaBoost::PrintStatistics</a>()</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;{</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    <span class="keywordtype">double</span>          dFar = 0, dFrr = 0;</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160; </div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_TrainingSamples.GetCount(); i++)</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;    {</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;        <a class="code" href="class_t_i_e_f_s_sample.html">TIEFSSample</a>* s = (<a class="code" href="class_t_i_e_f_s_sample.html">TIEFSSample</a>*)m_TrainingSamples.Get(i);</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;        <span class="keywordtype">double</span> err = m_ResultClass.Raiting(s);</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;        <span class="keywordflow">if</span> (s-&gt;<a class="code" href="class_t_i_e_f_s_sample.html#a07c56c83555e7d6c392f40e27394dde9">GetFlag</a>() == 1)</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;        {</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;            <span class="keywordflow">if</span> (err &lt; m_ResultClass.GetThreshold()) dFrr += 1.0;</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;        }</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;        {</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;            <span class="keywordflow">if</span> (err &gt;= m_ResultClass.GetThreshold())</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;            {</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;                dFar += 1.0;</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;            }</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;        }</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    }</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160; </div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    dFrr /= this-&gt;m_numIFS;</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    dFar /= this-&gt;m_numEFS;</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160; </div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    DbgMsg(<span class="stringliteral">&quot;\nFAR = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(dFar) +</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;        <span class="stringliteral">&quot;, FRR = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(dFrr) +</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;        <span class="stringliteral">&quot;, threshold = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(m_ResultClass.GetThreshold()) + <span class="stringliteral">&quot;;\n&quot;</span>);</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160; </div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;}</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160; </div>
<div class="line"><a name="l01494"></a><span class="lineno"><a class="line" href="class_t_i_e_f_s_ada_boost.html#a2052a39245426b0c5c9364e5c3823651"> 1494</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_t_i_e_f_s_ada_boost.html#a2052a39245426b0c5c9364e5c3823651">TIEFSAdaBoost::InitFeatures</a>(<span class="keywordtype">int</span> num)</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;{</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    <span class="keywordflow">if</span> (num &lt;= 0)</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    {</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;        DbgMsg(<span class="stringliteral">&quot;Invalid num features: num = &quot;</span> +<a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a> (num) + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    }</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; num; i++)</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    {</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;        <a class="code" href="class_t_i_e_f_s_weak2.html">TIEFSWeak2</a>* w = <span class="keyword">new</span> <a class="code" href="class_t_i_e_f_s_weak2.html">TIEFSWeak2</a>(i);</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;        this-&gt;m_Features.Add(w);</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;    }</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    DbgMsg(<a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(num) + <span class="stringliteral">&quot;features created.\n&quot;</span>);</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;}</div>
<div class="line"><a name="l01509"></a><span class="lineno"><a class="line" href="class_t_i_e_f_s_ada_boost.html#a15290441000811ae447f96ad139c8bd0"> 1509</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_t_i_e_f_s_ada_boost.html#a15290441000811ae447f96ad139c8bd0">TIEFSAdaBoost::LoadSamples</a>()</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;{</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    DbgMsg(<span class="stringliteral">&quot;Loading samples...\n&quot;</span>);</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    awpImage* img = NULL;</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;    <span class="keywordflow">if</span> (awpLoadImage(this-&gt;m_strSourceFile.c_str(), &amp;img) != AWP_OK)</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    {</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;        DbgMsg(<span class="stringliteral">&quot;Cannot load featues from &quot;</span> + m_strSourceFile + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;    }</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;    <span class="keywordtype">int</span> num = img-&gt;sSizeX - 1;</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;    <span class="keywordtype">double</span>* diff = (<span class="keywordtype">double</span>*)malloc(num*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    <span class="keywordflow">if</span> (!this-&gt;InitFeatures(num))</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    {</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;        awpReleaseImage(&amp;img);</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;        free(diff);</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    }</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    <span class="keywordtype">double</span>* d = (<span class="keywordtype">double</span>*)img-&gt;pPixels;</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;    <span class="keywordtype">int</span> ifs_count = 0;</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;    <span class="keywordtype">int</span> efs_count = 0;</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    for (<span class="keywordtype">int</span> i = 0; i &lt; img-&gt;sSizeY; i++)</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    {</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;        <span class="keywordtype">int</span> id1 = (int)d[i*img-&gt;sSizeX];</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;        for (<span class="keywordtype">int</span> j = i + 1; j &lt; img-&gt;sSizeY; j++)</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;        {</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;            <span class="keywordtype">int</span> id2 = (int)d[j*img-&gt;sSizeX];</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;            <span class="keywordtype">int</span> flag = id1 == id2 ? 1 : 0;</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;            if (!flag &amp;&amp; efs_count &gt; 730000)</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;            <span class="keywordflow">if</span> (flag)</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;                ifs_count++;</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;                efs_count++;</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160; </div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 1; k &lt;= num; k++)</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;            {</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;                diff[k-1] = fabs(d[i*img-&gt;sSizeX + k] - d[j*img-&gt;sSizeX + k]);</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;            }</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;            <a class="code" href="class_t_i_e_f_s_sample.html">TIEFSSample</a>* s = <span class="keyword">new</span> <a class="code" href="class_t_i_e_f_s_sample.html">TIEFSSample</a>(diff, num, flag);</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;            this-&gt;m_TrainingSamples.Add(s);</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;        }</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    }</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    this-&gt;m_numIFS = ifs_count;</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    this-&gt;m_numEFS = efs_count;</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160; </div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    awpReleaseImage(&amp;img);</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    free(diff);</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    DbgMsg(<span class="stringliteral">&quot;IFS samples loaded = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(m_numIFS) + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    DbgMsg(<span class="stringliteral">&quot;EFS samples loaded = &quot;</span> + <a class="code" href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a>(m_numEFS) + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="aclass_t_c_s_sample_html"><div class="ttname"><a href="class_t_c_s_sample.html">TCSSample</a></div><div class="ttdef"><b>Definition:</b> <a href="_l_f_sample_8h_source.html#l00059">LFSample.h:59</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_a5706b327fb1b96b4aa6f5da2c3d63936"><div class="ttname"><a href="class_t_c_s_ada_boost.html#a5706b327fb1b96b4aa6f5da2c3d63936">TCSAdaBoost::SetArtefactsBase</a></div><div class="ttdeci">void SetArtefactsBase(std::string str)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00314">lfcsboost.cpp:314</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_weak_html"><div class="ttname"><a href="class_t_i_e_f_s_weak.html">TIEFSWeak</a></div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8h_source.html#l00222">LFWeak.h:222</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_sample_html_a01abfb349375911bf682e037d41bc1a8"><div class="ttname"><a href="class_t_i_e_f_s_sample.html#a01abfb349375911bf682e037d41bc1a8">TIEFSSample::GetValue</a></div><div class="ttdeci">double GetValue(int index)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_sample_8cpp_source.html#l00154">LFSample.cpp:154</a></div></div>
<div class="ttc" id="aclass_i_l_f_strong_html_a454b62bde9e2eea35cf6f723d1577ee4"><div class="ttname"><a href="class_i_l_f_strong.html#a454b62bde9e2eea35cf6f723d1577ee4">ILFStrong::GetThreshold</a></div><div class="ttdeci">double GetThreshold()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_strong_impl_8cpp_source.html#l00047">LFStrongImpl.cpp:47</a></div></div>
<div class="ttc" id="aclass_t_c_s_sample_html_a8df9cbf13871bff310a0cb94e8e37ebe"><div class="ttname"><a href="class_t_c_s_sample.html#a8df9cbf13871bff310a0cb94e8e37ebe">TCSSample::GetWeight</a></div><div class="ttdeci">double GetWeight()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_sample_8cpp_source.html#l00055">LFSample.cpp:55</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_a77eb86bd34daabfe2b39a8df4fc7ddd8"><div class="ttname"><a href="class_t_c_s_ada_boost.html#a77eb86bd34daabfe2b39a8df4fc7ddd8">TCSAdaBoost::DbgMsg</a></div><div class="ttdeci">void DbgMsg(std::string const &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00303">lfcsboost.cpp:303</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_sample_html"><div class="ttname"><a href="class_t_i_e_f_s_sample.html">TIEFSSample</a></div><div class="ttdef"><b>Definition:</b> <a href="_l_f_sample_8h_source.html#l00111">LFSample.h:111</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_a6e1bc6f1906839b6b172210710a170d8"><div class="ttname"><a href="class_t_c_s_ada_boost.html#a6e1bc6f1906839b6b172210710a170d8">TCSAdaBoost::GetClass</a></div><div class="ttdeci">TCSStrong * GetClass()</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00351">lfcsboost.cpp:351</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_sample_html_a3768ef2072a4f41017be24acb5251910"><div class="ttname"><a href="class_t_i_e_f_s_sample.html#a3768ef2072a4f41017be24acb5251910">TIEFSSample::GetWeight</a></div><div class="ttdeci">double GetWeight()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_sample_8cpp_source.html#l00145">LFSample.cpp:145</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_weak_html_a00075d8ffdbaf06d39814b3b6672116b"><div class="ttname"><a href="class_t_i_e_f_s_weak.html#a00075d8ffdbaf06d39814b3b6672116b">TIEFSWeak::Classify</a></div><div class="ttdeci">int Classify(double value, double *value2=NULL)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8cpp_source.html#l00455">LFWeak.cpp:455</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_sample_html_a1fe035b0b79ab77e1f273dfa3c6847da"><div class="ttname"><a href="class_t_i_e_f_s_sample.html#a1fe035b0b79ab77e1f273dfa3c6847da">TIEFSSample::SetWeight</a></div><div class="ttdeci">void SetWeight(double Value)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_sample_8cpp_source.html#l00149">LFSample.cpp:149</a></div></div>
<div class="ttc" id="a___l_f_8h_html_a9e81fba2857bcc9063ccabb58bd6a899"><div class="ttname"><a href="___l_f_8h.html#a9e81fba2857bcc9063ccabb58bd6a899">TypeToStr</a></div><div class="ttdeci">std::string TypeToStr(const T &amp;t)</div><div class="ttdef"><b>Definition:</b> <a href="___l_f_8h_source.html#l00240">_LF.h:240</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_weak_html_a77a6851962d96705506856fbaedf8aa3"><div class="ttname"><a href="class_t_i_e_f_s_weak.html#a77a6851962d96705506856fbaedf8aa3">TIEFSWeak::GetWeight</a></div><div class="ttdeci">double GetWeight()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8cpp_source.html#l00466">LFWeak.cpp:466</a></div></div>
<div class="ttc" id="aclass_t_l_f_object_list_html"><div class="ttname"><a href="class_t_l_f_object_list.html">TLFObjectList</a></div><div class="ttdoc">List of LFObjects.</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_8h_source.html#l00133">LF.h:133</a></div></div>
<div class="ttc" id="astructroc__entry_html_a9f55baf22422312bbb59867900fd399b"><div class="ttname"><a href="structroc__entry.html#a9f55baf22422312bbb59867900fd399b">roc_entry::far2</a></div><div class="ttdeci">double far2</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l01171">lfcsboost.cpp:1171</a></div></div>
<div class="ttc" id="astruct_t_wcl_err_info_html_a44e161c8b6235820b11300c19f244350"><div class="ttname"><a href="struct_t_wcl_err_info.html#a44e161c8b6235820b11300c19f244350">TWclErrInfo::m_frr</a></div><div class="ttdeci">double m_frr</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_c_s_boost_8h_source.html#l00058">LFCSBoost.h:58</a></div></div>
<div class="ttc" id="aclass_t_c_s_sample_html_aac3b6bc5757dfeaf4c0bff242932f4d8"><div class="ttname"><a href="class_t_c_s_sample.html#aac3b6bc5757dfeaf4c0bff242932f4d8">TCSSample::SetWeight</a></div><div class="ttdeci">void SetWeight(double Value)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_sample_8cpp_source.html#l00059">LFSample.cpp:59</a></div></div>
<div class="ttc" id="aclass_t_c_s_sensor_html"><div class="ttname"><a href="class_t_c_s_sensor.html">TCSSensor</a></div><div class="ttdef"><b>Definition:</b> <a href="_l_f_features_8h_source.html#l00344">LFFeatures.h:344</a></div></div>
<div class="ttc" id="aclass_i_l_f_weak_html_a02d5241b95e5fe950c7703c22e31fa26"><div class="ttname"><a href="class_i_l_f_weak.html#a02d5241b95e5fe950c7703c22e31fa26">ILFWeak::SetWeight</a></div><div class="ttdeci">void SetWeight(double value)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_impl_8cpp_source.html#l00044">LFWeakImpl.cpp:44</a></div></div>
<div class="ttc" id="astructroc__entry_html_abfcb32661474b94884813a9464304c82"><div class="ttname"><a href="structroc__entry.html#abfcb32661474b94884813a9464304c82">roc_entry::frr1</a></div><div class="ttdeci">double frr1</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l01170">lfcsboost.cpp:1170</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_sign_html_aa6f2353af7679fa121aaa89ecd5b402c"><div class="ttname"><a href="class_t_c_s_ada_boost_sign.html#aa6f2353af7679fa121aaa89ecd5b402c">TCSAdaBoostSign::GetResult</a></div><div class="ttdeci">TCSStrongSign * GetResult()</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00969">lfcsboost.cpp:969</a></div></div>
<div class="ttc" id="aclass_progress_meter_html"><div class="ttname"><a href="class_progress_meter.html">ProgressMeter</a></div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00006">lfcsboost.cpp:6</a></div></div>
<div class="ttc" id="aclass_t_c_s_weak_html_a02d5c744e71bfc6e3f4aaa211d9afb37"><div class="ttname"><a href="class_t_c_s_weak.html#a02d5c744e71bfc6e3f4aaa211d9afb37">TCSWeak::Scale</a></div><div class="ttdeci">void Scale(double factor)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8cpp_source.html#l00108">LFWeak.cpp:108</a></div></div>
<div class="ttc" id="aclass_t_c_s_weak_training_html_ab6cf6f6b550d24e3503a413e3124bac4"><div class="ttname"><a href="class_t_c_s_weak_training.html#ab6cf6f6b550d24e3503a413e3124bac4">TCSWeakTraining::Train</a></div><div class="ttdeci">virtual void Train()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8cpp_source.html#l00221">LFWeak.cpp:221</a></div></div>
<div class="ttc" id="aclass_i_l_f_feature_html_af9ac2333853668de0e10bbfa7944d2f1"><div class="ttname"><a href="class_i_l_f_feature.html#af9ac2333853668de0e10bbfa7944d2f1">ILFFeature::hUnitBase</a></div><div class="ttdeci">int hUnitBase()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_feature_impl_8cpp_source.html#l00122">LFFeatureImpl.cpp:122</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_weak2_html_a4e52c79caef5978125ff3499bbb9b96a"><div class="ttname"><a href="class_t_i_e_f_s_weak2.html#a4e52c79caef5978125ff3499bbb9b96a">TIEFSWeak2::StartTraining</a></div><div class="ttdeci">void StartTraining()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8cpp_source.html#l00630">LFWeak.cpp:630</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_a0a5cef7f78f97944618f862ae40e2af6"><div class="ttname"><a href="class_t_c_s_ada_boost.html#a0a5cef7f78f97944618f862ae40e2af6">TCSAdaBoost::SetPath</a></div><div class="ttdeci">void SetPath(const char *lpPath)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00378">lfcsboost.cpp:378</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_a6cbbf31deb19f84b7dc4ec50f453fe16"><div class="ttname"><a href="class_t_c_s_ada_boost.html#a6cbbf31deb19f84b7dc4ec50f453fe16">TCSAdaBoost::SetFinishFar</a></div><div class="ttdeci">void SetFinishFar(double value)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00368">lfcsboost.cpp:368</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_sample_html_a07c56c83555e7d6c392f40e27394dde9"><div class="ttname"><a href="class_t_i_e_f_s_sample.html#a07c56c83555e7d6c392f40e27394dde9">TIEFSSample::GetFlag</a></div><div class="ttdeci">int GetFlag()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_sample_8cpp_source.html#l00136">LFSample.cpp:136</a></div></div>
<div class="ttc" id="aclass_t_l_f_c_a_feature_html"><div class="ttname"><a href="class_t_l_f_c_a_feature.html">TLFCAFeature</a></div><div class="ttdef"><b>Definition:</b> <a href="_l_f_features_8h_source.html#l00266">LFFeatures.h:266</a></div></div>
<div class="ttc" id="aclass_t_c_s_strong_sign_html"><div class="ttname"><a href="class_t_c_s_strong_sign.html">TCSStrongSign</a></div><div class="ttdef"><b>Definition:</b> <a href="_l_f_strong_8h_source.html#l00073">LFStrong.h:73</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_af2e4f2d7eb0723bc7819fbfd2d0b9a26"><div class="ttname"><a href="class_t_c_s_ada_boost.html#af2e4f2d7eb0723bc7819fbfd2d0b9a26">TCSAdaBoost::SaveNegativeSamples</a></div><div class="ttdeci">void SaveNegativeSamples(const char *lpPath)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00724">lfcsboost.cpp:724</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_weak2_html_a5179a87c1b7c61757aa02b851279d63f"><div class="ttname"><a href="class_t_i_e_f_s_weak2.html#a5179a87c1b7c61757aa02b851279d63f">TIEFSWeak2::Train</a></div><div class="ttdeci">void Train()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8cpp_source.html#l00646">LFWeak.cpp:646</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_ac403ef7de3158bdc0e6e66d79a3bb4ce"><div class="ttname"><a href="class_t_c_s_ada_boost.html#ac403ef7de3158bdc0e6e66d79a3bb4ce">TCSAdaBoost::TCSAdaBoost</a></div><div class="ttdeci">TCSAdaBoost()</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00040">lfcsboost.cpp:40</a></div></div>
<div class="ttc" id="aclass_i_l_f_feature_html_a8420340d6602e9e04cd457d0cac5c888"><div class="ttname"><a href="class_i_l_f_feature.html#a8420340d6602e9e04cd457d0cac5c888">ILFFeature::syBase</a></div><div class="ttdeci">int syBase()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_feature_impl_8cpp_source.html#l00114">LFFeatureImpl.cpp:114</a></div></div>
<div class="ttc" id="aclass_t_l_f_object_list_html_aeea56aec3018d7a253cb9af571a0cfd7"><div class="ttname"><a href="class_t_l_f_object_list.html#aeea56aec3018d7a253cb9af571a0cfd7">TLFObjectList::Add</a></div><div class="ttdeci">int Add(TLFObject *pObject)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_common_8cpp_source.html#l00317">LFCommon.cpp:317</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_aa33161ad390db461c9cc6903cd6400dc"><div class="ttname"><a href="class_t_c_s_ada_boost.html#aa33161ad390db461c9cc6903cd6400dc">TCSAdaBoost::InitFeatures</a></div><div class="ttdeci">void InitFeatures()</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00450">lfcsboost.cpp:450</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_ada_boost_html_a65181f4e8b2013145954b6f313c38b80"><div class="ttname"><a href="class_t_i_e_f_s_ada_boost.html#a65181f4e8b2013145954b6f313c38b80">TIEFSAdaBoost::TIEFSAdaBoost</a></div><div class="ttdeci">TIEFSAdaBoost()</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l01262">lfcsboost.cpp:1262</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_sign_html_a196e68f4e144396eb200453f7dd4e441"><div class="ttname"><a href="class_t_c_s_ada_boost_sign.html#a196e68f4e144396eb200453f7dd4e441">TCSAdaBoostSign::LoadSamples</a></div><div class="ttdeci">bool LoadSamples(int flag, std::string const &amp;path)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00999">lfcsboost.cpp:999</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_ac500ed623c8cc7661a59afdeabf1c754"><div class="ttname"><a href="class_t_c_s_ada_boost.html#ac500ed623c8cc7661a59afdeabf1c754">TCSAdaBoost::Load</a></div><div class="ttdeci">bool Load(TiXmlElement *node, int cascade)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00091">lfcsboost.cpp:91</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_sign_html_a4ac3dd801d0b445cd7f08d7d46bbe347"><div class="ttname"><a href="class_t_c_s_ada_boost_sign.html#a4ac3dd801d0b445cd7f08d7d46bbe347">TCSAdaBoostSign::TCSAdaBoostSign</a></div><div class="ttdeci">TCSAdaBoostSign()</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00744">lfcsboost.cpp:744</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_weak2_html"><div class="ttname"><a href="class_t_i_e_f_s_weak2.html">TIEFSWeak2</a></div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8h_source.html#l00267">LFWeak.h:267</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_weak2_html_a55ce01134d588ad3ca99982893adc3e1"><div class="ttname"><a href="class_t_i_e_f_s_weak2.html#a55ce01134d588ad3ca99982893adc3e1">TIEFSWeak2::Classify</a></div><div class="ttdeci">int Classify(double value, double *value2=NULL)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8cpp_source.html#l00617">LFWeak.cpp:617</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_ace23c4878d8742f79b7b4f363ad499f5"><div class="ttname"><a href="class_t_c_s_ada_boost.html#ace23c4878d8742f79b7b4f363ad499f5">TCSAdaBoost::GetObjectsBase</a></div><div class="ttdeci">std::string GetObjectsBase()</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00318">lfcsboost.cpp:318</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_weak_html_ae5af9bf80fbfbda3eafe81174a394df9"><div class="ttname"><a href="class_t_i_e_f_s_weak.html#ae5af9bf80fbfbda3eafe81174a394df9">TIEFSWeak::SetWeight</a></div><div class="ttdeci">void SetWeight(double Value)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8cpp_source.html#l00471">LFWeak.cpp:471</a></div></div>
<div class="ttc" id="aclass_t_c_s_weak_training_html_a51719fa17b282b074995c3edb10fc064"><div class="ttname"><a href="class_t_c_s_weak_training.html#a51719fa17b282b074995c3edb10fc064">TCSWeakTraining::StartTraining</a></div><div class="ttdeci">virtual void StartTraining()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8cpp_source.html#l00215">LFWeak.cpp:215</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_ae50b9cd02b7ac7e2bb8072232256807d"><div class="ttname"><a href="class_t_c_s_ada_boost.html#ae50b9cd02b7ac7e2bb8072232256807d">TCSAdaBoost::PrintStatistics</a></div><div class="ttdeci">double PrintStatistics(TCSStrong &amp;Class, double &amp;afrr)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00554">lfcsboost.cpp:554</a></div></div>
<div class="ttc" id="aclass_t_c_s_strong_html"><div class="ttname"><a href="class_t_c_s_strong.html">TCSStrong</a></div><div class="ttdef"><b>Definition:</b> <a href="_l_f_strong_8h_source.html#l00056">LFStrong.h:56</a></div></div>
<div class="ttc" id="agroup___l_f_file_utils_html_gaac7e7cc01e0c348f7ce9514d53fe1bd2"><div class="ttname"><a href="group___l_f_file_utils.html#gaac7e7cc01e0c348f7ce9514d53fe1bd2">LFCreateDir</a></div><div class="ttdeci">bool LFCreateDir(const char *lpPath)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_file_utils_8cpp_source.html#l00073">LFFileUtils.cpp:73</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_weak2_html_a7ff38acda5f5cd477b08615c82aa48fb"><div class="ttname"><a href="class_t_i_e_f_s_weak2.html#a7ff38acda5f5cd477b08615c82aa48fb">TIEFSWeak2::SetEpsilon</a></div><div class="ttdeci">void SetEpsilon(double Value)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8cpp_source.html#l00659">LFWeak.cpp:659</a></div></div>
<div class="ttc" id="aclass_t_c_s_weak_sign_trainig_html_a0db7ff8b24d598a860124e9cedbc1cb1"><div class="ttname"><a href="class_t_c_s_weak_sign_trainig.html#a0db7ff8b24d598a860124e9cedbc1cb1">TCSWeakSignTrainig::StartTraining</a></div><div class="ttdeci">virtual void StartTraining()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8cpp_source.html#l00381">LFWeak.cpp:381</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_a40193e7ace16b7a7ee4a976403288638"><div class="ttname"><a href="class_t_c_s_ada_boost.html#a40193e7ace16b7a7ee4a976403288638">TCSAdaBoost::GetTrainData</a></div><div class="ttdeci">TErrTrainData &amp; GetTrainData()</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00346">lfcsboost.cpp:346</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_sign_html_a12f242ece282d1cefc7df01645f6b671"><div class="ttname"><a href="class_t_c_s_ada_boost_sign.html#a12f242ece282d1cefc7df01645f6b671">TCSAdaBoostSign::InitFeatures</a></div><div class="ttdeci">void InitFeatures()</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00974">lfcsboost.cpp:974</a></div></div>
<div class="ttc" id="aclass_t_c_s_weak_sign_trainig_html_a03c38dea0e9fd012703ff6630f8070a8"><div class="ttname"><a href="class_t_c_s_weak_sign_trainig.html#a03c38dea0e9fd012703ff6630f8070a8">TCSWeakSignTrainig::Train</a></div><div class="ttdeci">virtual void Train()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8cpp_source.html#l00386">LFWeak.cpp:386</a></div></div>
<div class="ttc" id="aclass_i_l_f_feature_html"><div class="ttname"><a href="class_i_l_f_feature.html">ILFFeature</a></div><div class="ttdef"><b>Definition:</b> <a href="_l_f_8h_source.html#l00357">LF.h:357</a></div></div>
<div class="ttc" id="aclass_t_c_s_weak_training_html_afa782ffb7650d4ace9be2ed9de346d5f"><div class="ttname"><a href="class_t_c_s_weak_training.html#afa782ffb7650d4ace9be2ed9de346d5f">TCSWeakTraining::SetEpsilon</a></div><div class="ttdeci">void SetEpsilon(double Value)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8h_source.html#l00136">LFWeak.h:136</a></div></div>
<div class="ttc" id="aclass_t_l_f_h_a_feature_html"><div class="ttname"><a href="class_t_l_f_h_a_feature.html">TLFHAFeature</a></div><div class="ttdef"><b>Definition:</b> <a href="_l_f_features_8h_source.html#l00151">LFFeatures.h:151</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_weak2_html_a1ad7f04d3ce4af8b17b5be7e3315b99a"><div class="ttname"><a href="class_t_i_e_f_s_weak2.html#a1ad7f04d3ce4af8b17b5be7e3315b99a">TIEFSWeak2::GetEpsilon</a></div><div class="ttdeci">double GetEpsilon()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8cpp_source.html#l00663">LFWeak.cpp:663</a></div></div>
<div class="ttc" id="aclass_t_l_f_object_list_html_aaebd119611fadae07d1f72ad62b03d60"><div class="ttname"><a href="class_t_l_f_object_list.html#aaebd119611fadae07d1f72ad62b03d60">TLFObjectList::Get</a></div><div class="ttdeci">TLFObject * Get(int index)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_common_8cpp_source.html#l00261">LFCommon.cpp:261</a></div></div>
<div class="ttc" id="a___l_f_8h_html"><div class="ttname"><a href="___l_f_8h.html">_LF.h</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_a39e0e089441fe4cfd4f9ddab9fb38f2f"><div class="ttname"><a href="class_t_c_s_ada_boost.html#a39e0e089441fe4cfd4f9ddab9fb38f2f">TCSAdaBoost::SaveFRRSamples</a></div><div class="ttdeci">void SaveFRRSamples(int stage)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00669">lfcsboost.cpp:669</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_a956f0e368647d923e9a245fe925a71bd"><div class="ttname"><a href="class_t_c_s_ada_boost.html#a956f0e368647d923e9a245fe925a71bd">TCSAdaBoost::SetHeightBase</a></div><div class="ttdeci">void SetHeightBase(AWPWORD value)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00342">lfcsboost.cpp:342</a></div></div>
<div class="ttc" id="aclass_t_c_s_weak_sign_html_a2c7a93e32da16b8d7b238c3961448182"><div class="ttname"><a href="class_t_c_s_weak_sign.html#a2c7a93e32da16b8d7b238c3961448182">TCSWeakSign::Classify</a></div><div class="ttdeci">virtual int Classify(TLFImage *pImage, double *value=NULL)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8cpp_source.html#l00349">LFWeak.cpp:349</a></div></div>
<div class="ttc" id="aclass_t_c_s_sample_html_a9ce5c39240fcba99b11bcf9ecd77139f"><div class="ttname"><a href="class_t_c_s_sample.html#a9ce5c39240fcba99b11bcf9ecd77139f">TCSSample::SetRating</a></div><div class="ttdeci">void SetRating(double rating)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_sample_8cpp_source.html#l00068">LFSample.cpp:68</a></div></div>
<div class="ttc" id="agroup___l_f_file_utils_html_ga44ffb6b1e2eed50aab82f624d4f4d2d8"><div class="ttname"><a href="group___l_f_file_utils.html#ga44ffb6b1e2eed50aab82f624d4f4d2d8">LFGetFileExt</a></div><div class="ttdeci">string LFGetFileExt(const string &amp;strFileName)</div></div>
<div class="ttc" id="aclass_t_l_f_d_feature_html"><div class="ttname"><a href="class_t_l_f_d_feature.html">TLFDFeature</a></div><div class="ttdef"><b>Definition:</b> <a href="_l_f_features_8h_source.html#l00208">LFFeatures.h:208</a></div></div>
<div class="ttc" id="aclass_t_l_f_c_feature_html"><div class="ttname"><a href="class_t_l_f_c_feature.html">TLFCFeature</a></div><div class="ttdef"><b>Definition:</b> <a href="_l_f_features_8h_source.html#l00248">LFFeatures.h:248</a></div></div>
<div class="ttc" id="aclass_t_c_s_weak_training_html_aaff42488f164ce6826118f121f0ef183"><div class="ttname"><a href="class_t_c_s_weak_training.html#aaff42488f164ce6826118f121f0ef183">TCSWeakTraining::AddSample</a></div><div class="ttdeci">virtual void AddSample(TCSSample *pSample, int flag, double weight, int base_widht)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8cpp_source.html#l00227">LFWeak.cpp:227</a></div></div>
<div class="ttc" id="aclass_t_l_f_h_feature_html"><div class="ttname"><a href="class_t_l_f_h_feature.html">TLFHFeature</a></div><div class="ttdef"><b>Definition:</b> <a href="_l_f_features_8h_source.html#l00131">LFFeatures.h:131</a></div></div>
<div class="ttc" id="aclass_t_l_f_image_html_a243c41e1d0e48ca6000346014892c2ab"><div class="ttname"><a href="class_t_l_f_image.html#a243c41e1d0e48ca6000346014892c2ab">TLFImage::GetSqIntegralImage</a></div><div class="ttdeci">awpImage * GetSqIntegralImage()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_image_8cpp_source.html#l00330">LFImage.cpp:330</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_af38dcafbc149c80566883cf1b7ff0d35"><div class="ttname"><a href="class_t_c_s_ada_boost.html#af38dcafbc149c80566883cf1b7ff0d35">TCSAdaBoost::GetFinishFar</a></div><div class="ttdeci">double GetFinishFar()</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00364">lfcsboost.cpp:364</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_weak_html_a2778dbc7b54cf984592d3dad573b9084"><div class="ttname"><a href="class_t_i_e_f_s_weak.html#a2778dbc7b54cf984592d3dad573b9084">TIEFSWeak::GetIndex</a></div><div class="ttdeci">int GetIndex()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8cpp_source.html#l00560">LFWeak.cpp:560</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_a7f9651836ba37c4e908ede280ebc1506"><div class="ttname"><a href="class_t_c_s_ada_boost.html#a7f9651836ba37c4e908ede280ebc1506">TCSAdaBoost::LoadSample</a></div><div class="ttdeci">bool LoadSample(TLFObjectList &amp;SampleList, int flag, std::string const &amp;path)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00405">lfcsboost.cpp:405</a></div></div>
<div class="ttc" id="astruct_t_wcl_err_info_html"><div class="ttname"><a href="struct_t_wcl_err_info.html">TWclErrInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="_l_f_c_s_boost_8h_source.html#l00054">LFCSBoost.h:54</a></div></div>
<div class="ttc" id="aclass_t_c_s_weak_sign_trainig_html_a09e6b43d893b9c43836838eaca8a7bd0"><div class="ttname"><a href="class_t_c_s_weak_sign_trainig.html#a09e6b43d893b9c43836838eaca8a7bd0">TCSWeakSignTrainig::AddSample</a></div><div class="ttdeci">virtual void AddSample(TCSSample *pSample, int flag, double weight)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8cpp_source.html#l00398">LFWeak.cpp:398</a></div></div>
<div class="ttc" id="agroup___l_f_c_s_boost_html_ga61566a81227afa5a090795b458850b90"><div class="ttname"><a href="group___l_f_c_s_boost.html#ga61566a81227afa5a090795b458850b90">TErrTrainData</a></div><div class="ttdeci">std::vector&lt; TWclErrInfo &gt; TErrTrainData</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_c_s_boost_8h_source.html#l00060">LFCSBoost.h:60</a></div></div>
<div class="ttc" id="agroup___l_f_file_utils_html_gae68de90c59402f90b8b0699aab8734b4"><div class="ttname"><a href="group___l_f_file_utils.html#gae68de90c59402f90b8b0699aab8734b4">TLFStrings</a></div><div class="ttdeci">std::vector&lt; std::string &gt; TLFStrings</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_file_utils_8h_source.html#l00053">LFFileUtils.h:53</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_sign_html_a2b4db2d26c7121ddccc861cb77857a18"><div class="ttname"><a href="class_t_c_s_ada_boost_sign.html#a2b4db2d26c7121ddccc861cb77857a18">TCSAdaBoostSign::SetLogName</a></div><div class="ttdeci">void SetLogName(char *lpLogName)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00824">lfcsboost.cpp:824</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_sign_html_aecb78e6077145b3e6ad0f77c705dc7ef"><div class="ttname"><a href="class_t_c_s_ada_boost_sign.html#aecb78e6077145b3e6ad0f77c705dc7ef">TCSAdaBoostSign::SetLog1Name</a></div><div class="ttdeci">void SetLog1Name(char *lpLog1Name)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00828">lfcsboost.cpp:828</a></div></div>
<div class="ttc" id="aclass_t_c_s_weak_sign_trainig_html"><div class="ttname"><a href="class_t_c_s_weak_sign_trainig.html">TCSWeakSignTrainig</a></div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8h_source.html#l00194">LFWeak.h:194</a></div></div>
<div class="ttc" id="aclass_t_c_s_weak_sign_trainig_html_a61eadc9ad8fb6a961faa23fbe6fb5410"><div class="ttname"><a href="class_t_c_s_weak_sign_trainig.html#a61eadc9ad8fb6a961faa23fbe6fb5410">TCSWeakSignTrainig::GetEpsilon</a></div><div class="ttdeci">double GetEpsilon()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8h_source.html#l00211">LFWeak.h:211</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_a7e51aea6cf28d6028c4e0e4d22baefed"><div class="ttname"><a href="class_t_c_s_ada_boost.html#a7e51aea6cf28d6028c4e0e4d22baefed">TCSAdaBoost::GetArtefactsBase</a></div><div class="ttdeci">std::string GetArtefactsBase()</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00310">lfcsboost.cpp:310</a></div></div>
<div class="ttc" id="aclass_t_c_s_weak_html"><div class="ttname"><a href="class_t_c_s_weak.html">TCSWeak</a></div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8h_source.html#l00083">LFWeak.h:83</a></div></div>
<div class="ttc" id="aclass_t_l_f_v_feature_html"><div class="ttname"><a href="class_t_l_f_v_feature.html">TLFVFeature</a></div><div class="ttdef"><b>Definition:</b> <a href="_l_f_features_8h_source.html#l00170">LFFeatures.h:170</a></div></div>
<div class="ttc" id="aclass_t_l_f_image_html_a5a44ea86ac3f94f530665d047f95cc69"><div class="ttname"><a href="class_t_l_f_image.html#a5a44ea86ac3f94f530665d047f95cc69">TLFImage::GetImage</a></div><div class="ttdeci">awpImage * GetImage()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_image_8cpp_source.html#l00245">LFImage.cpp:245</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_a20ff9fb59b04b96039699aea4a92e3fa"><div class="ttname"><a href="class_t_c_s_ada_boost.html#a20ff9fb59b04b96039699aea4a92e3fa">TCSAdaBoost::Boost</a></div><div class="ttdeci">bool Boost(int stage)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00137">lfcsboost.cpp:137</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_ab5d528685a6021f53e41da19a8d33e20"><div class="ttname"><a href="class_t_c_s_ada_boost.html#ab5d528685a6021f53e41da19a8d33e20">TCSAdaBoost::LoadSamples</a></div><div class="ttdeci">bool LoadSamples()</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00073">lfcsboost.cpp:73</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_weak_html_ad1a25dbee5eae597f2b13ce0c230c890"><div class="ttname"><a href="class_t_i_e_f_s_weak.html#ad1a25dbee5eae597f2b13ce0c230c890">TIEFSWeak::GetEpsilon</a></div><div class="ttdeci">double GetEpsilon()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8cpp_source.html#l00556">LFWeak.cpp:556</a></div></div>
<div class="ttc" id="aclass_t_c_s_weak_training_html"><div class="ttname"><a href="class_t_c_s_weak_training.html">TCSWeakTraining</a></div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8h_source.html#l00121">LFWeak.h:121</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_ada_boost_html_ad3c132d6e7ca1e8255090f0cbf3d3600"><div class="ttname"><a href="class_t_i_e_f_s_ada_boost.html#ad3c132d6e7ca1e8255090f0cbf3d3600">TIEFSAdaBoost::DbgMsg</a></div><div class="ttdeci">virtual void DbgMsg(std::string const &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l01288">lfcsboost.cpp:1288</a></div></div>
<div class="ttc" id="astructroc__entry_html_a82d05755e37d473a22d97e0d53188fde"><div class="ttname"><a href="structroc__entry.html#a82d05755e37d473a22d97e0d53188fde">roc_entry::frr2</a></div><div class="ttdeci">double frr2</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l01172">lfcsboost.cpp:1172</a></div></div>
<div class="ttc" id="aclass_progress_meter_html_a12b7218455754bfa62b7be8400b9fa05"><div class="ttname"><a href="class_progress_meter.html#a12b7218455754bfa62b7be8400b9fa05">ProgressMeter::ProgressMeter</a></div><div class="ttdeci">ProgressMeter()</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00009">lfcsboost.cpp:9</a></div></div>
<div class="ttc" id="aclass_t_c_s_sample_html_a6f786a436b942bf561e5e0148414de3e"><div class="ttname"><a href="class_t_c_s_sample.html#a6f786a436b942bf561e5e0148414de3e">TCSSample::GetRating</a></div><div class="ttdeci">double GetRating()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_sample_8cpp_source.html#l00064">LFSample.cpp:64</a></div></div>
<div class="ttc" id="aclass_progress_meter_html_a135acb682c55a6aed758d164aab5a0e7"><div class="ttname"><a href="class_progress_meter.html#a135acb682c55a6aed758d164aab5a0e7">ProgressMeter::Init</a></div><div class="ttdeci">void Init(int units, int count)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00021">lfcsboost.cpp:21</a></div></div>
<div class="ttc" id="aclass_progress_meter_html_ac3902e5affdd16dcec5042d24e8c3512"><div class="ttname"><a href="class_progress_meter.html#ac3902e5affdd16dcec5042d24e8c3512">ProgressMeter::Update</a></div><div class="ttdeci">bool Update()</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00011">lfcsboost.cpp:11</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_weak_html_a6b1d72a07d3847f1caf3bdf7e26cb557"><div class="ttname"><a href="class_t_i_e_f_s_weak.html#a6b1d72a07d3847f1caf3bdf7e26cb557">TIEFSWeak::Clone</a></div><div class="ttdeci">TIEFSWeak * Clone()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8cpp_source.html#l00564">LFWeak.cpp:564</a></div></div>
<div class="ttc" id="astructroc__entry_html"><div class="ttname"><a href="structroc__entry.html">roc_entry</a></div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l01167">lfcsboost.cpp:1167</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_sign_html_a429aba9cf67141d5707ce7998243bdff"><div class="ttname"><a href="class_t_c_s_ada_boost_sign.html#a429aba9cf67141d5707ce7998243bdff">TCSAdaBoostSign::SaveROC</a></div><div class="ttdeci">void SaveROC(char *lpName)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l01174">lfcsboost.cpp:1174</a></div></div>
<div class="ttc" id="aclass_t_l_f_object_list_html_a650c52eef455194f2e29d2ce066fab3b"><div class="ttname"><a href="class_t_l_f_object_list.html#a650c52eef455194f2e29d2ce066fab3b">TLFObjectList::GetCount</a></div><div class="ttdeci">int GetCount()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_common_8cpp_source.html#l00494">LFCommon.cpp:494</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_sign_html_aeb1171436bf897009e4e7122d387975d"><div class="ttname"><a href="class_t_c_s_ada_boost_sign.html#aeb1171436bf897009e4e7122d387975d">TCSAdaBoostSign::Statistics</a></div><div class="ttdeci">void Statistics()</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l01080">lfcsboost.cpp:1080</a></div></div>
<div class="ttc" id="aclass_t_c_s_weak_training_html_a937a3f22607056153e70249cb0afd743"><div class="ttname"><a href="class_t_c_s_weak_training.html#a937a3f22607056153e70249cb0afd743">TCSWeakTraining::GetEpsilon</a></div><div class="ttdeci">double GetEpsilon()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8h_source.html#l00140">LFWeak.h:140</a></div></div>
<div class="ttc" id="aclass_t_c_s_sample_html_a54a7b60e35ab30d59b750f7eb31ddfb4"><div class="ttname"><a href="class_t_c_s_sample.html#a54a7b60e35ab30d59b750f7eb31ddfb4">TCSSample::GetFlag</a></div><div class="ttdeci">int GetFlag()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_sample_8cpp_source.html#l00046">LFSample.cpp:46</a></div></div>
<div class="ttc" id="agroup___l_f_file_utils_html_gad395468232807ead548b1157992c0f77"><div class="ttname"><a href="group___l_f_file_utils.html#gad395468232807ead548b1157992c0f77">LFMakeFileName</a></div><div class="ttdeci">string LFMakeFileName(string &amp;strPath, string strName, string strExt)</div></div>
<div class="ttc" id="aclass_t_c_s_weak_sign_trainig_html_a7a2685c9e6aa4138a76d256213bf73a7"><div class="ttname"><a href="class_t_c_s_weak_sign_trainig.html#a7a2685c9e6aa4138a76d256213bf73a7">TCSWeakSignTrainig::SetEpsilon</a></div><div class="ttdeci">void SetEpsilon(double Value)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8h_source.html#l00207">LFWeak.h:207</a></div></div>
<div class="ttc" id="aclass_i_l_f_feature_html_a6cbae80d7cb7af820662e380497b5e5f"><div class="ttname"><a href="class_i_l_f_feature.html#a6cbae80d7cb7af820662e380497b5e5f">ILFFeature::GetName</a></div><div class="ttdeci">virtual const char * GetName()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_8h_source.html#l00418">LF.h:418</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_ada_boost_html_a20279b218d355bc5c84cebfc8e18354b"><div class="ttname"><a href="class_t_i_e_f_s_ada_boost.html#a20279b218d355bc5c84cebfc8e18354b">TIEFSAdaBoost::Boost</a></div><div class="ttdeci">bool Boost()</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l01295">lfcsboost.cpp:1295</a></div></div>
<div class="ttc" id="aclass_t_l_f_v_a_feature_html"><div class="ttname"><a href="class_t_l_f_v_a_feature.html">TLFVAFeature</a></div><div class="ttdef"><b>Definition:</b> <a href="_l_f_features_8h_source.html#l00190">LFFeatures.h:190</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_ada_boost_html_a35d561c823c2578532fe6cbb416f5345"><div class="ttname"><a href="class_t_i_e_f_s_ada_boost.html#a35d561c823c2578532fe6cbb416f5345">TIEFSAdaBoost::Load</a></div><div class="ttdeci">bool Load(const char *lpFileName)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l01270">lfcsboost.cpp:1270</a></div></div>
<div class="ttc" id="aclass_t_c_s_strong_html_a6d512a3f300c4d0b76e09dc752eed0ee"><div class="ttname"><a href="class_t_c_s_strong.html#a6d512a3f300c4d0b76e09dc752eed0ee">TCSStrong::Classify</a></div><div class="ttdeci">virtual int Classify(TLFImage *pImage, double &amp;err)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_strong_8cpp_source.html#l00022">LFStrong.cpp:22</a></div></div>
<div class="ttc" id="aclass_t_l_f_d_a_feature_html"><div class="ttname"><a href="class_t_l_f_d_a_feature.html">TLFDAFeature</a></div><div class="ttdef"><b>Definition:</b> <a href="_l_f_features_8h_source.html#l00229">LFFeatures.h:229</a></div></div>
<div class="ttc" id="alfcsboost_8cpp_html_a01ffedf403b9ef77767735a8ab1bffa5"><div class="ttname"><a href="lfcsboost_8cpp.html#a01ffedf403b9ef77767735a8ab1bffa5">SampleCompare</a></div><div class="ttdeci">int SampleCompare(void *Item1, void *Item2)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00658">lfcsboost.cpp:658</a></div></div>
<div class="ttc" id="aclass_i_l_f_feature_html_a76f00a5ff9fca29a6e31bcbe1ac812f6"><div class="ttname"><a href="class_i_l_f_feature.html#a76f00a5ff9fca29a6e31bcbe1ac812f6">ILFFeature::sxBase</a></div><div class="ttdeci">int sxBase()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_feature_impl_8cpp_source.html#l00110">LFFeatureImpl.cpp:110</a></div></div>
<div class="ttc" id="aclass_t_l_f_l_b_p_feature_html"><div class="ttname"><a href="class_t_l_f_l_b_p_feature.html">TLFLBPFeature</a></div><div class="ttdef"><b>Definition:</b> <a href="_l_f_features_8h_source.html#l00285">LFFeatures.h:285</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_aebbbd76efc2ef6fd037ed5182590bc4a"><div class="ttname"><a href="class_t_c_s_ada_boost.html#aebbbd76efc2ef6fd037ed5182590bc4a">TCSAdaBoost::PrintFeature</a></div><div class="ttdeci">void PrintFeature(ILFFeature *pSensor)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00546">lfcsboost.cpp:546</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_ab538a55ee5d43e8ac16635dcf80dc477"><div class="ttname"><a href="class_t_c_s_ada_boost.html#ab538a55ee5d43e8ac16635dcf80dc477">TCSAdaBoost::HeightBase</a></div><div class="ttdeci">AWPWORD HeightBase()</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00338">lfcsboost.cpp:338</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_ada_boost_html_a15290441000811ae447f96ad139c8bd0"><div class="ttname"><a href="class_t_i_e_f_s_ada_boost.html#a15290441000811ae447f96ad139c8bd0">TIEFSAdaBoost::LoadSamples</a></div><div class="ttdeci">virtual bool LoadSamples()</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l01509">lfcsboost.cpp:1509</a></div></div>
<div class="ttc" id="astructroc__entry_html_a3af1d5a128a88112f4ee87e91319d401"><div class="ttname"><a href="structroc__entry.html#a3af1d5a128a88112f4ee87e91319d401">roc_entry::far1</a></div><div class="ttdeci">double far1</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l01169">lfcsboost.cpp:1169</a></div></div>
<div class="ttc" id="a_l_f_attr_filter_8h_html_a7d9df0b08f5a808d295f7a8335151070"><div class="ttname"><a href="_l_f_attr_filter_8h.html#a7d9df0b08f5a808d295f7a8335151070">names</a></div><div class="ttdeci">names</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_attr_filter_8h_source.html#l00039">LFAttrFilter.h:39</a></div></div>
<div class="ttc" id="agroup___l_f_file_utils_html_gab674fd8c9eb4e9e30e932fb9cffe1b2c"><div class="ttname"><a href="group___l_f_file_utils.html#gab674fd8c9eb4e9e30e932fb9cffe1b2c">LFGetDirFiles</a></div><div class="ttdeci">bool LFGetDirFiles(const char *lpDir, TLFStrings &amp;names)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_file_utils_8cpp_source.html#l00274">LFFileUtils.cpp:274</a></div></div>
<div class="ttc" id="aclass_t_c_s_sample_html_ade35a9425888f07126fa206476aad40a"><div class="ttname"><a href="class_t_c_s_sample.html#ade35a9425888f07126fa206476aad40a">TCSSample::SetFlag</a></div><div class="ttdeci">void SetFlag(int Value)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_sample_8cpp_source.html#l00050">LFSample.cpp:50</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_sign_html_a4ea38c792232fe23289778c960e63213"><div class="ttname"><a href="class_t_c_s_ada_boost_sign.html#a4ea38c792232fe23289778c960e63213">TCSAdaBoostSign::DbgMsg</a></div><div class="ttdeci">void DbgMsg(std::string const &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l01071">lfcsboost.cpp:1071</a></div></div>
<div class="ttc" id="aclass_t_c_s_strong_html_a38404df012bf77098bfb7be80aadd66f"><div class="ttname"><a href="class_t_c_s_strong.html#a38404df012bf77098bfb7be80aadd66f">TCSStrong::Setup</a></div><div class="ttdeci">void Setup(awpRect const &amp;window, int det_width)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_strong_8cpp_source.html#l00009">LFStrong.cpp:9</a></div></div>
<div class="ttc" id="aclass_i_l_f_feature_html_a2abba96fbe45e8f04212830de4587b64"><div class="ttname"><a href="class_i_l_f_feature.html#a2abba96fbe45e8f04212830de4587b64">ILFFeature::wUnitBase</a></div><div class="ttdeci">int wUnitBase()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_feature_impl_8cpp_source.html#l00118">LFFeatureImpl.cpp:118</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_ad87e94ca936e2107579753545d135a00"><div class="ttname"><a href="class_t_c_s_ada_boost.html#ad87e94ca936e2107579753545d135a00">TCSAdaBoost::GetFeaturesCount</a></div><div class="ttdeci">int GetFeaturesCount()</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00355">lfcsboost.cpp:355</a></div></div>
<div class="ttc" id="aclass_i_l_f_weak_html_ac4b6b8d3a7fec9566ffc92f69631768c"><div class="ttname"><a href="class_i_l_f_weak.html#ac4b6b8d3a7fec9566ffc92f69631768c">ILFWeak::Weight</a></div><div class="ttdeci">double Weight()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_impl_8cpp_source.html#l00040">LFWeakImpl.cpp:40</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_weak2_html_a9828ebb937256e233f0f03d8072dba1f"><div class="ttname"><a href="class_t_i_e_f_s_weak2.html#a9828ebb937256e233f0f03d8072dba1f">TIEFSWeak2::IsFree</a></div><div class="ttdeci">bool IsFree()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8cpp_source.html#l00651">LFWeak.cpp:651</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_weak_html_a66ceae7f84119894b758c817f52e0d81"><div class="ttname"><a href="class_t_i_e_f_s_weak.html#a66ceae7f84119894b758c817f52e0d81">TIEFSWeak::Lock</a></div><div class="ttdeci">void Lock()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8cpp_source.html#l00548">LFWeak.cpp:548</a></div></div>
<div class="ttc" id="astruct_t_wcl_err_info_html_ae60b18d38451ebfd8f7854da38ade7a6"><div class="ttname"><a href="struct_t_wcl_err_info.html#ae60b18d38451ebfd8f7854da38ade7a6">TWclErrInfo::m_thr</a></div><div class="ttdeci">double m_thr</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_c_s_boost_8h_source.html#l00056">LFCSBoost.h:56</a></div></div>
<div class="ttc" id="aclass_t_l_f_object_list_html_a531ce97cfa683256fbd6b8cee485b799"><div class="ttname"><a href="class_t_l_f_object_list.html#a531ce97cfa683256fbd6b8cee485b799">TLFObjectList::Sort</a></div><div class="ttdeci">void Sort(TLFListSortCompare Compare)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_common_8cpp_source.html#l00482">LFCommon.cpp:482</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_sign_html_acb614ecee2a55f60cfc10f41992889e2"><div class="ttname"><a href="class_t_c_s_ada_boost_sign.html#acb614ecee2a55f60cfc10f41992889e2">TCSAdaBoostSign::Boost</a></div><div class="ttdeci">bool Boost()</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00833">lfcsboost.cpp:833</a></div></div>
<div class="ttc" id="aclass_t_l_f_image_html_a55e5fc3eca44bdb372e8da303cdc086d"><div class="ttname"><a href="class_t_l_f_image.html#a55e5fc3eca44bdb372e8da303cdc086d">TLFImage::LoadFromFile</a></div><div class="ttdeci">virtual bool LoadFromFile(const char *szFileName)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_image_8cpp_source.html#l00125">LFImage.cpp:125</a></div></div>
<div class="ttc" id="agroup___l_f_file_utils_html_ga71cdb56ac95e4b7e00de69acf2105ef1"><div class="ttname"><a href="group___l_f_file_utils.html#ga71cdb56ac95e4b7e00de69acf2105ef1">LFDirExist</a></div><div class="ttdeci">bool LFDirExist(const char *lpPath)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_file_utils_8cpp_source.html#l00086">LFFileUtils.cpp:86</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_ada_boost_html_a2052a39245426b0c5c9364e5c3823651"><div class="ttname"><a href="class_t_i_e_f_s_ada_boost.html#a2052a39245426b0c5c9364e5c3823651">TIEFSAdaBoost::InitFeatures</a></div><div class="ttdeci">bool InitFeatures(int num)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l01494">lfcsboost.cpp:1494</a></div></div>
<div class="ttc" id="aclass_t_l_f_image_html_aabefe7fad02ac79afc519d5d86a1b399"><div class="ttname"><a href="class_t_l_f_image.html#aabefe7fad02ac79afc519d5d86a1b399">TLFImage::SaveToFile</a></div><div class="ttdeci">virtual bool SaveToFile(const char *szFileName)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_image_8cpp_source.html#l00147">LFImage.cpp:147</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_ae8000e604885d5ae921d4ab35e869a0d"><div class="ttname"><a href="class_t_c_s_ada_boost.html#ae8000e604885d5ae921d4ab35e869a0d">TCSAdaBoost::GetPath</a></div><div class="ttdeci">std::string GetPath()</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00373">lfcsboost.cpp:373</a></div></div>
<div class="ttc" id="aclass_i_l_f_weak_html_a5d93bb48c8aee520695bda7af663b706"><div class="ttname"><a href="class_i_l_f_weak.html#a5d93bb48c8aee520695bda7af663b706">ILFWeak::Fetaure</a></div><div class="ttdeci">ILFFeature * Fetaure()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_impl_8cpp_source.html#l00036">LFWeakImpl.cpp:36</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_sign_html_a707982b4a3c0c0de3ed769f3c8fd75c8"><div class="ttname"><a href="class_t_c_s_ada_boost_sign.html#a707982b4a3c0c0de3ed769f3c8fd75c8">TCSAdaBoostSign::Load</a></div><div class="ttdeci">bool Load(TiXmlElement *node)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00777">lfcsboost.cpp:777</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_a702566e5657000a1487424c2a9e17ef6"><div class="ttname"><a href="class_t_c_s_ada_boost.html#a702566e5657000a1487424c2a9e17ef6">TCSAdaBoost::SetWidthBase</a></div><div class="ttdeci">void SetWidthBase(AWPWORD value)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00334">lfcsboost.cpp:334</a></div></div>
<div class="ttc" id="aclass_t_l_f_image_html_a68b8ec8cae38332cfefa664792f06c31"><div class="ttname"><a href="class_t_l_f_image.html#a68b8ec8cae38332cfefa664792f06c31">TLFImage::GetIntegralImage</a></div><div class="ttdeci">awpImage * GetIntegralImage()</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_image_8cpp_source.html#l00312">LFImage.cpp:312</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_acf0de0253caef63ac103acba0490f14b"><div class="ttname"><a href="class_t_c_s_ada_boost.html#acf0de0253caef63ac103acba0490f14b">TCSAdaBoost::WidthBase</a></div><div class="ttdeci">AWPWORD WidthBase()</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00330">lfcsboost.cpp:330</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_ada_boost_html_afb9305ff3a6cfe79b9022e7c07e68e2e"><div class="ttname"><a href="class_t_i_e_f_s_ada_boost.html#afb9305ff3a6cfe79b9022e7c07e68e2e">TIEFSAdaBoost::PrintStatistics</a></div><div class="ttdeci">double PrintStatistics()</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l01463">lfcsboost.cpp:1463</a></div></div>
<div class="ttc" id="aclass_t_i_e_f_s_weak2_html_a002afc3c989b0e090b04c9b7e9ae841c"><div class="ttname"><a href="class_t_i_e_f_s_weak2.html#a002afc3c989b0e090b04c9b7e9ae841c">TIEFSWeak2::AddSample</a></div><div class="ttdeci">void AddSample(TIEFSSample *sample)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8cpp_source.html#l00635">LFWeak.cpp:635</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_af079a2284199516e56ee77186fa370b6"><div class="ttname"><a href="class_t_c_s_ada_boost.html#af079a2284199516e56ee77186fa370b6">TCSAdaBoost::SetFeaturesCount</a></div><div class="ttdeci">void SetFeaturesCount(int value)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00359">lfcsboost.cpp:359</a></div></div>
<div class="ttc" id="astruct_t_wcl_err_info_html_abc99007c13b43797a91a70cb4e09387c"><div class="ttname"><a href="struct_t_wcl_err_info.html#abc99007c13b43797a91a70cb4e09387c">TWclErrInfo::m_far</a></div><div class="ttdeci">double m_far</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_c_s_boost_8h_source.html#l00057">LFCSBoost.h:57</a></div></div>
<div class="ttc" id="aclass_t_c_s_weak_html_aa957a2444fad37c0e35c95c858ed9565"><div class="ttname"><a href="class_t_c_s_weak.html#aa957a2444fad37c0e35c95c858ed9565">TCSWeak::Classify</a></div><div class="ttdeci">virtual int Classify(TLFImage *pImage, double *value=NULL)</div><div class="ttdef"><b>Definition:</b> <a href="_l_f_weak_8cpp_source.html#l00120">LFWeak.cpp:120</a></div></div>
<div class="ttc" id="aclass_t_c_s_ada_boost_html_a76e6ced3af8b37e19f5194a54d23010b"><div class="ttname"><a href="class_t_c_s_ada_boost.html#a76e6ced3af8b37e19f5194a54d23010b">TCSAdaBoost::SetObjectsBase</a></div><div class="ttdeci">void SetObjectsBase(std::string str)</div><div class="ttdef"><b>Definition:</b> <a href="lfcsboost_8cpp_source.html#l00323">lfcsboost.cpp:323</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
